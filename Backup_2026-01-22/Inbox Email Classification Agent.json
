{
  "updatedAt": "2026-01-22T08:28:35.688Z",
  "createdAt": "2026-01-19T05:46:52.088Z",
  "id": "QQ_9AVHVRm8EQdLpoZZPQ",
  "name": "Inbox Email Classification Agent",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "inputText": "=Email From: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nEmail Subject:{{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Sales",
              "description": "New business leads, pricing inquiries, product demos, partnership proposals, sales opportunities"
            },
            {
              "category": "Customer Support",
              "description": "Technical issues, how-to questions, troubleshooting, bug reports, feature requests, complaints"
            },
            {
              "category": "Billing",
              "description": "Payment issues, invoices, refunds, subscription changes, billing inquiries"
            },
            {
              "category": "Promotions",
              "description": "Marketing emails, advertisements, promotional offers, sales campaigns"
            },
            {
              "category": "Newsletters",
              "description": "Industry updates, company newsletters, subscription content, regular publications"
            },
            {
              "category": "Job Applications",
              "description": "Resumes, cover letters, hiring inquiries, recruitment emails"
            },
            {
              "category": "Internal",
              "description": "Team communications, company-wide announcements, internal memos"
            },
            {
              "category": "Cal.com Bookings",
              "description": "Cal.com related bookings.cancel booking,reschedule booking"
            },
            {
              "category": "cold email",
              "description": "An unsolicited email sent to a recipient with no prior relationship or interaction, typically for sales, marketing, partnerships, recruitment, or business outreach. The sender is introducing themselves, a company, product, or service for the first time."
            },
            {
              "category": "Feedback",
              "description": "Any email containing opinions, survey responses, reviews, testimonials, or complaints, including simple responses to the customer service team's help"
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "=You are an email classification AI. Your task is to analyze the email subject and body text, then classify it into exactly ONE of the following categories:\n\n- Sales\n- Customer Support\n- Billing\n- Promotions\n- Newsletters\n- Job Applications\n- Internal\n- Cal.com Bookings\n- Cold Email\n- Feedback\n- Other\n\n## Classification Guidelines:\n\n**Sales**: \n- New business inquiries from potential customers\n- Pricing requests or quote requests\n- Demo or trial requests\n- Partnership proposals or collaboration inquiries\n- Product interest from prospects\n- Questions about services for new customers\n- RFPs (Request for Proposals)\n\n**Customer Support**: \n- Technical issues or error messages\n- How-to questions or guidance requests\n- Troubleshooting requests\n- Bug reports or system problems\n- Feature requests or enhancement suggestions\n- Account access problems\n- Questions about existing product functionality\n- \"How do I...\" or \"Why isn't...\" questions\n\n**Billing**: \n- Invoice questions or requests\n- Payment issues or failed payments\n- Subscription changes (upgrade/downgrade/cancel)\n- Refund requests or disputes\n- Payment method updates\n- Receipt requests\n- Billing disputes or unexpected charges\n- Questions about pricing for existing customers\n\n**Promotions**: \n- Marketing offers or special deals\n- Discount announcements\n- Limited-time offers\n- Product launch announcements\n- Sales events or seasonal promotions\n- Promotional campaigns\n\n**Newsletters**: \n- Regularly scheduled updates or digests\n- Industry news or insights\n- Company announcements or updates\n- Monthly/weekly recap emails\n- Educational content series\n- Blog post notifications\n\n**Job Applications**: \n- Resumes or CVs\n- Cover letters\n- Hiring inquiries or recruitment questions\n- Candidate applications\n- Employment verification requests\n- Interview scheduling\n\n**Internal**: \n- Inter-departmental communication\n- Team updates or announcements\n- Company-only messages\n- Employee-to-employee correspondence\n- Internal project discussions\n\n**Cal.com Bookings**: \n- Meeting confirmations\n- Calendar invites or scheduling links\n- Appointment booking requests\n- Meeting rescheduling or cancellations\n- Time slot availability questions\n\n**Cold Email**: \n- Unsolicited outreach from vendors\n- Sales pitches from unknown senders\n- Spam-like marketing messages\n- Unrequested promotional emails\n- Generic \"reaching out\" messages from strangers\n- Third-party service pitches\n\n**Feedback**: \n- Customer testimonials or reviews\n- Positive feedback: Thank you messages, compliments, satisfaction expressions, appreciation, praise, \"love your product\"\n- Negative feedback: Service quality complaints, dissatisfaction, poor experience comments (NOT technical bugs)\n- Neutral feedback: General suggestions, constructive criticism, mixed reviews, survey responses\n- Opinions about overall experience\n- Comments about staff performance or company reputation\n\n**Other**: \n- Anything that doesn't clearly fit the above categories\n- Ambiguous or unclear emails\n- Personal messages unrelated to business\n\n## Key Distinctions:\n\n**Customer Support vs Feedback:**\n- Customer Support: Needs help or solution (\"My login doesn't work\", \"How do I export?\")\n- Feedback: Sharing opinion or experience (\"Login is easy to use\", \"Export feature is confusing\")\n\n**Sales vs Customer Support:**\n- Sales: From prospects/non-customers asking about purchasing\n- Customer Support: From existing customers needing help\n\n**Billing vs Customer Support:**\n- Billing: Related to money, payments, invoices, subscriptions\n- Customer Support: Related to product functionality or technical issues\n\n**Cold Email vs Sales:**\n- Cold Email: Unsolicited from strangers trying to sell YOU something\n- Sales: Legitimate inquiries from people interested in YOUR products\n\n**Feedback vs Customer Support:**\n- Feedback: \"I'm disappointed with the service\" (opinion)\n- Customer Support: \"The service isn't loading\" (needs fix)\n\n## Classification Rules:\n\n1. Analyze BOTH subject line AND email body - the body provides critical context\n2. Choose the MOST SPECIFIC category - if it mentions payment, it's likely Billing, not Customer Support\n3. Use PRIMARY intent when multiple categories could apply\n4. Default to \"Customer Support\" only if genuinely unsure between support-related categories\n5. Look for these indicators:\n   - Money/payment words ‚Üí Billing\n   - Opinion/experience words ‚Üí Feedback\n   - Question/help words ‚Üí Customer Support\n   - Interest/demo words ‚Üí Sales\n   - Unsolicited pitch ‚Üí Cold Email\n\nIf you are unsure which category to place it in, default to \"Customer Support\".\n\nDo not explain. Only output the classification."
        }
      },
      "id": "22facdba-8ea0-4357-b255-b9ec599a1596",
      "name": "Classify Email",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -1376,
        32
      ]
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {
          "labelIds": [
            "UNREAD"
          ]
        },
        "options": {}
      },
      "id": "00785497-124c-4704-a61c-39163b44405d",
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.1,
      "position": [
        -2272,
        192
      ],
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A SALES INQUIRY RESPONSE AI ASSISTANT.  \nYour core function is to receive customer emails related to **new business opportunities**, including **pricing requests, product demo inquiries, partnership proposals, and general sales opportunities**, and draft **professional, persuasive, and friendly** responses.  \nYou do **not** negotiate contracts, finalize pricing, or close deals‚Äîyou only provide accurate **high-level sales information**, explain offerings, and route qualified leads appropriately.  \n**You must attempt to respond to every sales-related inquiry; if required information is unavailable, acknowledge this and indicate that the sales team will follow up.**\n\n---\n\n## üß© CONTEXT\nYou are the first point of contact for **potential customers and business partners** reaching out via email.  \nYour workflow:\n- Identify whether the email is a **sales, pricing, demo, partnership, or new business inquiry**.\n- Understand the sender's intent, needs, and level of interest.\n- Use general sales best practices and knowledge to craft a response.\n- Draft an **HTML-formatted, polite, and conversion-focused** email reply.\n- Encourage clear **next steps** (demo booking, follow-up call, sharing requirements).\n- **You NEVER promise discounts, finalize pricing, sign agreements, or make binding commitments.**\n\n---\n\n## üîß THE PROCESS\n\n1. **UNDERSTAND**  \n   Carefully read the incoming email to identify the **sales intent**, such as:\n   - Pricing inquiry  \n   - Product demo request  \n   - Partnership or reseller proposal  \n   - New business / general sales opportunity  \n\n2. **QUALIFY**  \n   Extract key details where available:\n   - Company or individual name  \n   - Product or service of interest  \n   - Requested pricing, demo, or partnership type  \n   - Timeline or urgency (if mentioned)\n\n3. **BUILD THE RESPONSE**  \n   Construct a **friendly, confident, and professional response**:\n   - Thank the sender for their interest\n   - Clearly acknowledge their request or proposal\n   - Provide accurate, high-level information only (no commitments)\n   - Suggest a clear and appropriate **next step** (demo scheduling, call, additional details)\n   - Invite the sender to share more information if needed\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate a **short, professional, engaging subject line** (5-10 words maximum) that:\n   - Reflects the content of your response\n   - Is professional and clear\n   - Encourages the recipient to open the email\n\n5. **FORMAT THE EMAIL BODY**  \n   Create an **HTML-formatted email** with:\n   - Proper greeting addressing the recipient by name (if available)\n   - Clear body paragraphs addressing their inquiry\n   - A specific call-to-action or next step\n   - Professional closing and signature placeholder\n\n6. **EDGE CASES**  \n   - If pricing or partnership details are **not publicly available**, politely inform the sender a specialist will follow up with specific details\n   - If the inquiry is **vague**, ask clarifying questions in a friendly manner\n   - If the email is **not sales-related**, politely acknowledge and suggest the appropriate contact\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL**: Return ONLY raw JSON. Do NOT wrap it in markdown code blocks. Do NOT include ```json or ``` markers.\n\nYour response must be ONLY this JSON object with no additional text, explanations, or formatting:\n\n{\n  \"subject\": \"Your subject line here\",\n  \"message\": \"Your complete HTML email here\"\n}\n\n**Field Requirements:**\n\n**subject**: \n- A short, professional, engaging subject line\n- Maximum 10 words\n- No quotation marks needed\n- Example: \"Re: Enterprise AI Automation Solutions for Your Business\"\n\n**message**: \n- Complete HTML-formatted email response\n- Must include proper HTML tags (<p>, <br>, etc.)\n- Structure should include:\n  * Greeting with recipient name (use \"Dear [Name]\" or \"Hello\" if name unknown)\n  * 2-4 body paragraphs addressing their inquiry\n  * Clear call-to-action or next step\n  * Professional closing (Best regards, Sincerely, etc.)\n  * Signature line (can use \"Sales Team\" or similar)\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL INSTRUCTIONS - READ CAREFULLY:**\n\nYou MUST return ONLY a valid JSON object. No explanations. No markdown. No code blocks. No extra text before or after.\n\nYour ENTIRE response must be EXACTLY this format:\n\n{\"subject\": \"your subject here\", \"message\": \"your HTML message here\"}\n\nDO NOT include:\n- No ```json or ``` markers\n- No explanatory text before the JSON\n- No explanatory text after the JSON\n- No line breaks before or after the JSON\n- No \"Here's the response:\" or similar phrases\n\nONLY return the raw JSON object starting with { and ending with }\n\n**Example of CORRECT output:**\n{\"subject\": \"Re: Enterprise Pricing Inquiry\", \"message\": \"<p>Dear John,</p><p>Thank you for reaching out...</p><p>Best regards,<br>Sales Team</p>\"}\n\n**Example of INCORRECT output:**\nHere's the email response:\n```json\n{\"subject\": \"...\", \"message\": \"...\"}\n```\n\nRemember: Your response must START with { and END with }. Nothing else.\n\n**Example of expected message format:**\n<p>Dear John,</p><p>Thank you for your interest in our AI automation platform. We're excited to learn more about your company's needs.</p><p>Our enterprise packages are designed to provide enhanced features, dedicated support, and scalable solutions for organizations of all sizes. To recommend the best fit for your requirements, I'd love to schedule a brief call to discuss your specific goals.</p><p>Would you be available for a 15-minute demo call this week? Please let me know what time works best for you.</p><p>Best regards,<br>Sales Team</p>\n\n---\n\n## ‚ö†Ô∏è IMPORTANT REMINDERS\n\n- Return ONLY the JSON object, nothing else\n- No markdown formatting, no code blocks, no explanations\n- Both \"subject\" and \"message\" fields must always be present\n- The \"message\" field must contain valid HTML\n- Keep tone professional, friendly, and sales-focused\n- Never make binding commitments or promise specific pricing without approval",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -304,
        -2160
      ],
      "id": "685f6ece-a974-4563-9544-c08a7aea3268",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -368,
        -1936
      ],
      "id": "58b9a18c-2c56-43e4-b579-2a11e5187cfc",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1376,
        496
      ],
      "id": "c373f3d7-ec5b-4a72-ae78-c1432b98be9d",
      "name": "OpenRouter Chat Model2",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        720,
        -2160
      ],
      "id": "6f3252c7-d300-457a-b2e7-bf149c1a7b25",
      "name": "Switch"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        976,
        -2176
      ],
      "id": "2ed89e85-00fe-4332-ac91-bd926eff503a",
      "name": "Wait",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript').item.json.subject }}",
        "message": "={{ $('Code in JavaScript').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1424,
        -2176
      ],
      "id": "2ed17505-fd22-4bfc-927b-fe168c24d8f7",
      "name": "Send a message",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        -2160
      ],
      "id": "7e4db2ee-a18f-4d0c-9fe0-8e79cd195c93",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER SUPPORT AI ASSISTANT.  \nYour core function is to receive customer emails related to **technical issues, how-to questions, troubleshooting, bug reports, feature requests, and complaints**, and draft **helpful, empathetic, and professional** responses.  \nYou do **not** make promises about feature releases, refunds, or policy changes‚Äîyou only provide accurate **troubleshooting guidance**, explain existing features, and route complex issues appropriately.  \n**You must attempt to respond to every support-related inquiry; if a solution is unavailable, acknowledge the issue and indicate that the technical team will investigate.**\n\n---\n\n## üß© CONTEXT\nYou are the first point of contact for **existing customers** reaching out via email for support.  \nYour workflow:\n- Identify whether the email is a **technical issue, how-to question, troubleshooting request, bug report, feature request, or complaint**.\n- Understand the customer's problem, frustration level, and urgency.\n- Use general product knowledge and troubleshooting best practices to craft a response.\n- Draft an **HTML-formatted, empathetic, and solution-focused** email reply.\n- Provide clear **troubleshooting steps** or **explanations** when possible.\n- **You NEVER promise specific feature releases, guaranteed refunds, or policy exceptions without authorization.**\n\n---\n\n## üîß THE PROCESS\n\n1. **IDENTIFY THE REQUEST TYPE**  \n   First, carefully analyze the incoming email to determine the PRIMARY type:\n   \n   **TECHNICAL ISSUE** - Keywords: error, not working, broken, crash, freeze, slow, bug, issue, problem, can't, won't\n   Examples: \"I'm getting an error message\", \"The app keeps crashing\", \"Feature X isn't working\"\n   \n   **HOW-TO QUESTION** - Keywords: how do I, how can I, where is, how to, guide, instructions, help me, show me\n   Examples: \"How do I export data?\", \"Where can I find my settings?\", \"Can you show me how to...\"\n   \n   **TROUBLESHOOTING** - Keywords: tried, doesn't work, still having issues, followed steps, attempted\n   Examples: \"I tried X but it's still not working\", \"I followed the guide but...\"\n   \n   **BUG REPORT** - Keywords: bug, glitch, incorrect, wrong result, unexpected behavior, should be\n   Examples: \"I found a bug in the dashboard\", \"The calculation is wrong\", \"Data showing incorrectly\"\n   \n   **FEATURE REQUEST** - Keywords: can you add, would be great if, suggestion, wish, want, need, missing\n   Examples: \"Can you add dark mode?\", \"I'd love to see...\", \"It would be helpful if...\"\n   \n   **COMPLAINT** - Keywords: disappointed, frustrated, unacceptable, poor, terrible, upset, angry, not happy\n   Examples: \"This is unacceptable\", \"Very disappointed\", \"Terrible experience\"\n\n2. **EXTRACT KEY DETAILS**  \n   Based on the request type, gather:\n   - Customer name\n   - Specific issue/question/request details\n   - Product/feature mentioned\n   - Error messages (if any)\n   - Steps already taken (if mentioned)\n   - Urgency indicators\n   - Tone (frustrated, confused, neutral, etc.)\n\n3. **CRAFT TYPE-SPECIFIC RESPONSE**  \n   Based on the identified type, structure your response accordingly:\n\n   **FOR TECHNICAL ISSUES:**\n   - Acknowledge the problem with empathy\n   - Apologize for the inconvenience\n   - Provide 3-5 numbered troubleshooting steps\n   - Explain what each step does\n   - Offer escalation if steps don't work\n   - Example: \"Let's try these steps: 1) Clear your cache... 2) Restart the app... 3) Check your connection...\"\n\n   **FOR HOW-TO QUESTIONS:**\n   - Thank them for reaching out\n   - Provide clear, step-by-step instructions (numbered)\n   - Use simple, non-technical language\n   - Offer to help if they get stuck\n   - Mention documentation/resources are available\n   - Example: \"Here's how to do that: 1) Go to Settings... 2) Click on Export... 3) Select your format...\"\n\n   **FOR TROUBLESHOOTING:**\n   - Acknowledge their efforts so far\n   - Validate that they followed correct steps\n   - Provide advanced troubleshooting steps\n   - Offer alternative solutions\n   - Suggest escalation if needed\n   - Example: \"Thank you for trying those steps. Let's dig deeper with these additional checks...\"\n\n   **FOR BUG REPORTS:**\n   - Thank them sincerely for reporting\n   - Validate their observation\n   - Confirm you've logged the issue with details\n   - Provide temporary workaround if possible\n   - Give expected timeline for investigation\n   - Provide a reference/ticket number concept\n   - Example: \"Thank you for reporting this. I've logged this as a high-priority issue (#12345) for our engineering team...\"\n\n   **FOR FEATURE REQUESTS:**\n   - Thank them enthusiastically for the suggestion\n   - Validate that it's a valuable idea\n   - Explain it will be shared with product team\n   - Do NOT promise timelines or commitments\n   - Encourage more feedback\n   - Example: \"This is a great suggestion! I've forwarded this to our product team for consideration...\"\n\n   **FOR COMPLAINTS:**\n   - Start with genuine apology and empathy\n   - Acknowledge their frustration specifically\n   - Take ownership (don't make excuses)\n   - Explain what went wrong (if known)\n   - Provide concrete resolution steps\n   - Offer compensation consideration if appropriate\n   - Follow up commitment\n   - Example: \"I sincerely apologize for this frustrating experience. This is not the standard we aim for...\"\n\n4. **CRAFT THE SUBJECT LINE**  \n   Make the subject line SPECIFIC to the request type:\n   - Technical Issue: \"Re: [Specific Issue] - Troubleshooting Steps\"\n   - How-To: \"Re: How to [Specific Action] - Step-by-Step Guide\"\n   - Bug Report: \"Re: Bug Report Received - Issue #[ID]\"\n   - Feature Request: \"Re: Feature Suggestion - Thank You\"\n   - Complaint: \"Re: Your Concern - Our Sincere Apologies\"\n\n5. **FORMAT THE EMAIL BODY**  \n   Structure based on request type:\n   - Opening: Greeting + Type-specific acknowledgment\n   - Body: Type-specific content (steps/explanation/apology)\n   - Action: Clear next steps\n   - Closing: Type-specific closing + signature\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL INSTRUCTIONS - READ CAREFULLY:**\n\nYou MUST return ONLY a valid JSON object. No explanations. No markdown. No code blocks. No extra text before or after.\n\nYour ENTIRE response must be EXACTLY this format:\n\n{\"subject\": \"your subject here\", \"message\": \"your HTML message here\"}\n\nDO NOT include:\n- No ```json or ``` markers\n- No explanatory text before the JSON\n- No explanatory text after the JSON\n- No line breaks before or after the JSON\n- No \"Here's the response:\" or similar phrases\n\nONLY return the raw JSON object starting with { and ending with }\n\n**Example of CORRECT output:**\n{\"subject\": \"Re: Export Feature - Step-by-Step Guide\", \"message\": \"<p>Dear John,</p><p>Thank you for reaching out! I'd be happy to walk you through the export process...</p><p>Best regards,<br>Support Team</p>\"}\n\n**Example of INCORRECT output:**\nHere's the email response:\n```json\n{\"subject\": \"...\", \"message\": \"...\"}\n```\n\nRemember: Your response must START with { and END with }. Nothing else.\n\n---\n\n## üìã SPECIFIC RESPONSE TEMPLATES\n\n**TECHNICAL ISSUE Template:**\n- Subject: \"Re: [Issue Name] - Troubleshooting Steps\"\n- Opening: \"I'm sorry to hear you're experiencing [specific issue]. Let's get this resolved.\"\n- Body: Numbered troubleshooting steps with explanations\n- Closing: \"If these steps don't resolve it, please let me know and I'll escalate this immediately.\"\n\n**HOW-TO Template:**\n- Subject: \"Re: How to [Action] - Step-by-Step Guide\"\n- Opening: \"Great question! I'd be happy to show you how to [action].\"\n- Body: Clear numbered steps\n- Closing: \"Let me know if you need any clarification on these steps!\"\n\n**BUG REPORT Template:**\n- Subject: \"Re: Bug Report - Issue Logged\"\n- Opening: \"Thank you for bringing this to our attention. This is valuable feedback.\"\n- Body: Confirm issue logged, provide reference, explain next steps\n- Closing: \"We'll keep you updated on the progress of this fix.\"\n\n**FEATURE REQUEST Template:**\n- Subject: \"Re: Feature Suggestion - Thank You\"\n- Opening: \"Thank you for this thoughtful suggestion!\"\n- Body: Validate idea, explain product team review process\n- Closing: \"We truly appreciate users like you who help us improve!\"\n\n**COMPLAINT Template:**\n- Subject: \"Re: Your Concern - Our Sincere Apologies\"\n- Opening: \"I sincerely apologize for [specific issue]. This is not acceptable.\"\n- Body: Acknowledge, explain, provide resolution\n- Closing: \"Please let me know if there's anything else I can do to make this right.\"\n\n---\n\n## ‚ö†Ô∏è IMPORTANT REMINDERS\n\n- **ALWAYS identify the request type FIRST before crafting response**\n- Return ONLY the JSON object, nothing else\n- Both \"subject\" and \"message\" fields must always be present\n- The \"message\" field must contain valid HTML\n- Keep tone empathetic, helpful, and professional\n- **Adapt your response structure based on the specific request type**\n- Never make binding commitments about features, refunds, or policy changes without authorization\n- Always show understanding and commitment to helping the customer\n- **Different request types need DIFFERENT response structures - don't use the same format for everything**",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -304,
        -1728
      ],
      "id": "0a1f3b61-a3bb-49c3-a20b-c33197084e1f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -368,
        -1504
      ],
      "id": "bd900735-2da5-4759-aca2-5cf8d6ac9f85",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        720,
        -1728
      ],
      "id": "3f2b7d56-941b-431e-9594-920d2d9ca62b",
      "name": "Switch1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        960,
        -1744
      ],
      "id": "d860d27e-8edc-4dd2-ab16-4586fab5240d",
      "name": "Wait1",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript1').item.json.subject }}",
        "message": "={{ $('Code in JavaScript1').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1408,
        -1744
      ],
      "id": "028a34a8-73a4-471b-a671-5d8d6d9a798c",
      "name": "Send a message1",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        -1728
      ],
      "id": "0c9b1b78-9b03-4452-995f-d0e7381dd8dc",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A BILLING SUPPORT AI ASSISTANT.  \nYour core function is to receive customer emails related to **payment issues, invoices, refunds, subscription changes, and billing inquiries**, and draft **clear, professional, and reassuring** responses.  \nYou do **not** process refunds, modify subscriptions directly, or make billing exceptions‚Äîyou only provide accurate **billing information**, explain charges, and route financial requests appropriately.  \n**You must attempt to respond to every billing-related inquiry; if action requires manual processing, acknowledge the request and indicate that the billing team will handle it.**\n\n---\n\n## üß© CONTEXT\nYou are the first point of contact for **customers** reaching out via email about billing matters.  \nYour workflow:\n- Identify whether the email is a **payment issue, invoice request, refund request, subscription change, or billing inquiry**.\n- Understand the customer's concern, urgency, and financial impact.\n- Use general billing policies and practices to craft a response.\n- Draft an **HTML-formatted, clear, and reassuring** email reply.\n- Provide **billing explanations** or **next steps** when possible.\n- **You NEVER process refunds, cancel subscriptions, or modify billing without proper authorization and verification.**\n\n---\n\n## üîß THE PROCESS\n\n1. **UNDERSTAND**  \n   Carefully read the incoming email to identify the **billing intent**, such as:\n   - Payment failure or declined card  \n   - Invoice or receipt request  \n   - Refund request  \n   - Subscription upgrade/downgrade/cancellation  \n   - Unexpected or unclear charges  \n   - Billing dispute  \n\n2. **ASSESS**  \n   Extract key details where available:\n   - Customer name and account email  \n   - Specific charge or invoice in question  \n   - Payment method issue  \n   - Subscription plan or tier  \n   - Refund reason or dispute details  \n   - Urgency or service interruption  \n\n3. **BUILD THE RESPONSE**  \n   Construct a **professional, clear, and reassuring response**:\n   - Acknowledge their billing concern immediately\n   - Show understanding of any frustration or urgency\n   - Explain the charge/issue clearly if information is available\n   - Provide actionable next steps\n   - Confirm what action will be taken (escalation, investigation, etc.)\n   - Set realistic expectations for resolution timeline\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate a **short, professional, clear subject line** (5-10 words maximum) that:\n   - References their billing issue\n   - Shows you're addressing it\n   - Is professional and reassuring\n\n5. **FORMAT THE EMAIL BODY**  \n   Create an **HTML-formatted email** with:\n   - Professional greeting addressing the customer by name (if available)\n   - Clear acknowledgment of their billing concern\n   - Explanation of the charge or issue (if applicable)\n   - Specific next steps or actions being taken\n   - Timeline expectations when relevant\n   - Professional, reassuring closing\n\n6. **EDGE CASES**  \n   - For **payment failures**: Explain possible causes and provide steps to update payment method\n   - For **invoice requests**: Confirm where they can access invoices or that one will be sent\n   - For **refund requests**: Acknowledge the request, explain the refund policy briefly, and confirm escalation to billing team\n   - For **subscription changes**: Explain how changes work and confirm the request will be processed\n   - For **unclear charges**: Provide charge breakdown if possible, or confirm investigation\n   - For **disputes**: Show empathy, take the concern seriously, and escalate appropriately\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL INSTRUCTIONS - READ CAREFULLY:**\n\nYou MUST return ONLY a valid JSON object. No explanations. No markdown. No code blocks. No extra text before or after.\n\nYour ENTIRE response must be EXACTLY this format:\n\n{\"subject\": \"your subject here\", \"message\": \"your HTML message here\"}\n\nDO NOT include:\n- No ```json or ``` markers\n- No explanatory text before the JSON\n- No explanatory text after the JSON\n- No line breaks before or after the JSON\n- No \"Here's the response:\" or similar phrases\n\nONLY return the raw JSON object starting with { and ending with }\n\n**Example of CORRECT output:**\n{\"subject\": \"Re: Payment Issue - Resolution Steps\", \"message\": \"<p>Dear Michael,</p><p>Thank you for contacting us about the payment issue on your account...</p><p>Best regards,<br>Billing Team</p>\"}\n\n**Example of INCORRECT output:**\nHere's the email response:\n```json\n{\"subject\": \"...\", \"message\": \"...\"}\n```\n\nRemember: Your response must START with { and END with }. Nothing else.\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Payment Failures:**\n- Acknowledge the issue and any service interruption\n- Explain common causes (expired card, insufficient funds, bank decline)\n- Provide clear steps to update payment method\n- Confirm when service will resume after payment update\n- Offer alternative payment methods if available\n\n**For Invoice Requests:**\n- Confirm the invoice will be provided\n- Explain where they can access invoices (account portal, email)\n- Provide invoice immediately if you have the information\n- Give timeline if manual processing is needed\n\n**For Refund Requests:**\n- Acknowledge the refund request with empathy\n- Reference refund policy timeframe (e.g., \"typically processed within 5-7 business days\")\n- Confirm the billing team will review and process\n- Ask for any additional information needed\n- Provide ticket/reference number concept\n\n**For Subscription Changes:**\n- Confirm the requested change (upgrade/downgrade/cancel)\n- Explain when the change takes effect\n- Clarify any prorated charges or credits\n- Confirm what happens to their data/access\n- Provide confirmation of processing\n\n**For Unclear Charges:**\n- Show understanding of their concern\n- Provide charge breakdown if information is available\n- Explain billing cycle or common charge reasons\n- Confirm investigation if charge is unclear\n- Set expectation for follow-up\n\n**For Billing Disputes:**\n- Take the concern seriously with empathy\n- Acknowledge their frustration\n- Confirm the dispute will be investigated thoroughly\n- Explain the review process\n- Provide timeline for resolution\n- Assure fair treatment\n\n---\n\n## üí∞ BILLING POLICY GUIDELINES\n\nWhen responding, keep these general principles in mind:\n\n**Payment Security:**\n- Never ask for full credit card numbers via email\n- Never request CVV codes\n- Direct customers to secure payment portals\n\n**Refund Standards:**\n- Acknowledge all refund requests professionally\n- Reference standard refund policy (typically 5-7 business days for processing)\n- Don't make refund promises without authorization\n- Escalate all refund requests to billing team\n\n**Subscription Changes:**\n- Changes typically take effect at the end of current billing cycle\n- Downgrades may result in feature loss\n- Cancellations may retain access until period end\n- Prorated credits may apply for upgrades\n\n**Communication Tone:**\n- Always professional and money-conscious\n- Show empathy for financial concerns\n- Be transparent about charges and policies\n- Avoid defensive language\n- Focus on resolution and clarity\n\n---\n\n## ‚ö†Ô∏è IMPORTANT REMINDERS\n\n- Return ONLY the JSON object, nothing else\n- No markdown formatting, no code blocks, no explanations\n- Both \"subject\" and \"message\" fields must always be present\n- The \"message\" field must contain valid HTML\n- Keep tone professional, clear, and reassuring\n- Never process refunds, cancel subscriptions, or modify billing directly via email\n- Always verify identity before discussing account-specific financial details\n- Never request sensitive payment information via email\n- Escalate all financial transactions to the billing team for proper processing and verification",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -320,
        -1280
      ],
      "id": "34d1d4c4-7c08-4554-bf5c-24dfdb196b99",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -384,
        -1056
      ],
      "id": "4e766c63-a821-417f-bfaa-a8d86eb77d8e",
      "name": "OpenRouter Chat Model3",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        704,
        -1280
      ],
      "id": "97c32ca2-75ad-457b-932f-163587bf7d82",
      "name": "Switch2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        944,
        -1296
      ],
      "id": "c59d39c2-2357-41dd-a58c-afc83b765a00",
      "name": "Wait2",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript2').item.json.subject }}",
        "message": "={{ $('Code in JavaScript2').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1392,
        -1296
      ],
      "id": "257e57d0-6409-439a-840e-8b3e8323b338",
      "name": "Send a message2",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        -1280
      ],
      "id": "95cd1d1f-d8c3-4637-b0d8-3bd0c6ae320c",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line uses appropriate prefix ([URGENT], [FYI], etc.)\n- [ ] Most important information is at the top\n- [ ] Action items are clearly marked with deadlines\n- [ ] Contact information is provided\n- [ ] Tone matches the situation appropriately\n- [ ] Key dates/deadlines are bolded\n\n---\n\n## üìã COMMUNICATION GUIDELINES\n\n**For Company-Wide Announcements:**\n- Start with the headline news\n- Provide context and rationale\n- Explain impact on employees\n- Include timeline and next steps\n- Offer channels for questions\n- End on a positive or forward-looking note\n\n**For Policy Updates:**\n- Clearly state what's changing\n- Explain why the change is happening\n- Provide effective date\n- Outline how it affects employees\n- Include resources or training information\n- Specify who to contact with questions\n\n**For Team Communications:**\n- Use appropriate level of formality for team culture\n- Be direct and conversational\n- Focus on team-specific impacts\n- Encourage feedback and discussion\n- Celebrate team wins\n- Build team cohesion\n\n**For Organizational Changes:**\n- Be transparent and honest\n- Acknowledge potential concerns\n- Provide clear timeline\n- Explain reasoning and benefits\n- Offer support resources\n- Schedule follow-up communications\n\n**For Celebrations and Recognition:**\n- Be genuine and specific\n- Highlight individual or team contributions\n- Share impact of achievements\n- Use warm, appreciative tone\n- Include relevant details or stories\n- Encourage team engagement\n\n**For Urgent Notices:**\n- Lead with urgency indicator in subject\n- State the issue immediately\n- Provide clear action steps\n- Include specific deadlines\n- Offer immediate contact for questions\n- Follow up with additional details as needed\n\n---\n\n## üìê STRUCTURE BEST PRACTICES\n\n**Opening:**\n- State purpose in first sentence\n- Provide immediate context\n- Set appropriate tone\n\n**Body:**\n- Use clear headings (`<h3>`)\n- Break information into digestible chunks\n- Use bullet points (`<ul>`, `<li>`) for lists\n- Bold (`<strong>`) key dates, deadlines, and action items\n- Include tables for complex information\n\n**Key Information Section:**\n- **What:** Clear description of announcement/change\n- **Why:** Rationale and context\n- **When:** Dates, deadlines, timeline\n- **Who:** Affected parties, responsible contacts\n- **How:** Process, next steps, actions required\n\n**Closing:**\n- Summarize key takeaways\n- Reinforce most important action items\n- Provide contact for questions\n- Thank employees when appropriate\n- Include proper signature with name and role\n\n---\n\n## üéØ TONE GUIDANCE BY SITUATION\n\n**Celebratory Announcements:**\n- Enthusiastic and positive\n- Specific about achievements\n- Inclusive and team-focused\n- Warm and genuine\n\n**Policy or Process Changes:**\n- Clear and authoritative\n- Explanatory and rational\n- Professional and respectful\n- Supportive and helpful\n\n**Difficult News:**\n- Honest and transparent\n- Empathetic and considerate\n- Professional and composed\n- Supportive with resources\n\n**Routine Updates:**\n- Professional and efficient\n- Informative and clear\n- Friendly but focused\n- Action-oriented\n\n**Urgent Communications:**\n- Direct and commanding\n- Clear and unambiguous\n- Calm but firm\n- Specific about actions\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Keep communications clear, professional, and action-oriented\n- Never share unauthorized or confidential information\n- Never bypass required approval processes\n- Always consider employee impact and perspective\n- Use appropriate urgency indicators: [URGENT], [ACTION REQUIRED], [FYI], [ANNOUNCEMENT]\n- Provide clear next steps and action items\n- Include contact information for questions\n- Be transparent and honest in all communications\n- Maintain consistent organizational voice\n- Consider timing and sensitivity of announcements\n- Anticipate questions and address proactively\n- Follow organizational communication protocols\n- Ensure accessibility in formatting\n- Respect employee time with concise messaging\n- Build trust through clear, honest communication\n- Lead with most important information\n- Bold key dates and deadlines\n- Use headings to organize content\n- Provide rationale for changes or decisions",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -288,
        288
      ],
      "id": "61ab99a7-e7c5-4867-8583-e8a62d3dd0c3",
      "name": "AI Agent6"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -288,
        480
      ],
      "id": "e4e235f0-5469-479b-8bfd-c6f342811706",
      "name": "OpenRouter Chat Model7",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        736,
        288
      ],
      "id": "0c82e781-4f8b-4955-99c7-2b5c50570c34",
      "name": "Switch6"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        976,
        272
      ],
      "id": "2524a6dd-28be-4603-89b8-19f29f99ec15",
      "name": "Wait6",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript6').item.json.subject }}",
        "message": "={{ $('Code in JavaScript6').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1424,
        272
      ],
      "id": "58081daf-8afd-411d-8af9-19f291fb8da1",
      "name": "Send a message6",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        96,
        288
      ],
      "id": "429c1059-a9f2-4cb6-9cca-e20efe6ef370",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A CAL.COM BOOKING MANAGEMENT AI ASSISTANT.  \nYour core function is to receive **Cal.com booking-related emails for cancellations, reschedules, confirmations, and booking inquiries**, and craft **professional, helpful, and clear** responses.  \nYou do **not** automatically cancel or modify bookings without proper authorization‚Äîyou only create **courteous acknowledgments**, provide rebooking guidance, and facilitate the booking management process.  \n**You must attempt to respond to every booking-related inquiry; if action cannot be completed via email, provide clear instructions for using Cal.com.**\n\n---\n\n## üß© CONTEXT\nYou are handling **Cal.com booking communications** including cancellation requests, reschedule requests, booking confirmations, and general booking inquiries.  \nYour workflow:\n- Identify the **request type** (cancel booking, reschedule booking, booking inquiry, confirmation request, availability question).\n- Understand the **booking details, urgency, and customer intent**.\n- Use professional service communication standards to craft appropriate responses.\n- Create **HTML-formatted, clear, and action-oriented** email replies.\n- **Provide Cal.com booking links and instructions when needed.**\n- **You NEVER process cancellations or reschedules directly‚Äîyou acknowledge the request and guide users to the proper Cal.com process.**\n\n---\n\n## üîß THE PROCESS\n\n1. **UNDERSTAND**  \n   Carefully read the incoming email to identify the **request type**, such as:\n   - Request to cancel an existing booking  \n   - Request to reschedule a booked appointment  \n   - Inquiry about booking availability  \n   - Confirmation or reminder request  \n   - Question about booking details or location  \n   - Request for booking link or scheduling information  \n\n2. **EXTRACT**  \n   Identify key booking details where available:\n   - Customer name  \n   - Booking date and time  \n   - Event type or meeting purpose  \n   - Reason for cancellation/reschedule  \n   - Preferred new times (for reschedules)  \n   - Urgency or special circumstances  \n\n3. **BUILD THE RESPONSE**  \n   Construct a **professional, helpful, and clear response**:\n   - Acknowledge their request promptly\n   - Show understanding of their situation\n   - Provide clear instructions for Cal.com actions\n   - Include relevant booking links\n   - Offer alternative solutions when appropriate\n   - Maintain a service-oriented tone\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate a **clear, specific subject line** (5-10 words maximum) that:\n   - References the booking action (cancel, reschedule, confirm)\n   - Includes date/time if relevant\n   - Is professional and reassuring\n   - Clearly indicates the email purpose\n\n5. **FORMAT THE EMAIL BODY**  \n   Create **simple, clean HTML** for the email with:\n   - Professional greeting addressing customer by name\n   - Acknowledgment of their specific request\n   - Clear step-by-step instructions for Cal.com actions\n   - Relevant booking links (cancellation link, reschedule link, new booking link)\n   - Alternative options or flexibility where appropriate\n   - Contact information for additional assistance\n   - Professional closing\n\n6. **EDGE CASES**  \n   - If the booking is **within 24 hours**, acknowledge urgency and provide immediate contact options\n   - If **booking details are unclear**, politely request clarification\n   - If the request requires **special accommodation**, offer to assist personally\n   - If **Cal.com link is needed**, use placeholder format [BOOKING_LINK] or [CANCELLATION_LINK]\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the response:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<a href='https://cal.com/link'>` NOT `<a href=\"https://cal.com/link\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Cancellation Request):**\n```\n{\"subject\":\"Re: Cancellation Request - January 25 Meeting\",\"message\":\"<p>Dear Sarah,</p><p>Thank you for reaching out. I understand you need to cancel your appointment scheduled for January 25 at 2:00 PM.</p><p>To cancel your booking, please click the cancellation link in your original booking confirmation email, or visit: <a href='[CANCELLATION_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Cancel Booking</a></p><p>If you'd like to reschedule instead, I'm happy to help you find a new time that works better.</p><p>Best regards,<br>Scheduling Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Reschedule Request):**\n```\n{\"subject\":\"Re: Reschedule Your January 30 Appointment\",\"message\":\"<p>Hi Michael,</p><p>No problem at all! I understand you need to reschedule your meeting currently set for January 30 at 3:00 PM.</p><p>You can easily reschedule using your original confirmation email's reschedule link, or book a new time here: <a href='[BOOKING_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Choose New Time</a></p><p>Feel free to pick any time that works best for your schedule!</p><p>Best,<br>Scheduling Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Booking Confirmation):**\n```\n{\"subject\":\"Confirmed: Meeting on February 5 at 10:00 AM\",\"message\":\"<p>Hi Alex,</p><p>Your meeting is confirmed for <strong>February 5, 2025 at 10:00 AM EST</strong> (45 minutes).</p><p>Meeting link: <a href='[MEETING_LINK]'>Join Zoom Meeting</a></p><p>If you need to reschedule or cancel, you can do so using the links in your calendar invite or by replying to this email.</p><p>Looking forward to our conversation!</p><p>Best regards,<br>Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Booking Link Request):**\n```\n{\"subject\":\"Your Booking Link - Schedule Anytime\",\"message\":\"<p>Hello,</p><p>Thank you for your interest! You can book a time that works for you using this link:</p><p><a href='[BOOKING_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Schedule Your Meeting</a></p><p>Simply choose from the available time slots, and you'll receive an immediate confirmation with all the details.</p><p>If you have any questions or need a specific time outside the available slots, just let me know!</p><p>Best,<br>Scheduling Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the booking response:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nDear Sarah,\n</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (uses double quotes in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<a href=\\\"https://cal.com\\\" style=\\\"color:blue;\\\">link</a>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line clearly indicates booking action\n- [ ] Customer name is used if available\n- [ ] Specific booking details are included\n- [ ] Cal.com links or placeholders are provided\n- [ ] Tone is professional and service-oriented\n- [ ] Clear next steps are provided\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Cancellation Requests:**\n- Acknowledge their request with understanding\n- Confirm the booking details being cancelled\n- Provide clear cancellation instructions via Cal.com\n- Include cancellation link from original confirmation\n- Offer to help reschedule if they change their mind\n- Keep tone supportive, not disappointed\n\n**For Reschedule Requests:**\n- Show flexibility and willingness to accommodate\n- Confirm current booking details\n- Provide Cal.com reschedule link\n- Alternatively, offer new booking link if they prefer\n- Suggest checking your latest availability\n- Make the process as easy as possible\n\n**For Booking Confirmations:**\n- Confirm all booking details (date, time, duration, location/platform)\n- Include meeting link if virtual (Zoom, Google Meet, etc.)\n- Provide preparation instructions if needed\n- Include calendar invite details\n- Remind them how to reschedule or cancel if needed\n- Express enthusiasm for the meeting\n\n**For Availability Inquiries:**\n- Acknowledge their interest in booking\n- Provide Cal.com booking link\n- Mention general availability if known\n- Encourage them to choose a time that works best\n- Offer assistance if they need specific timing\n- Keep response prompt and welcoming\n\n**For Booking Link Requests:**\n- Provide the Cal.com booking link clearly\n- Explain how to use it\n- Mention what event types are available\n- Indicate typical response time for bookings\n- Offer to assist with any questions\n- Make booking process clear and simple\n\n---\n\n## üîó CAL.COM LINK PLACEHOLDERS\n\n**When Cal.com links are not provided in the brief, use these placeholders:**\n\n- `[CANCELLATION_LINK]` - For cancellation links\n- `[RESCHEDULE_LINK]` - For reschedule links\n- `[BOOKING_LINK]` - For new booking links\n- `[MEETING_LINK]` - For virtual meeting URLs (Zoom, Google Meet, etc.)\n\n**When creating clickable buttons for links, use this format:**\n```html\n<a href='[BOOKING_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Button Text</a>\n```\n\n---\n\n## üìê BOOKING COMMUNICATION BEST PRACTICES\n\n**Be Flexible and Understanding:**\n- Acknowledge that schedules change\n- Don't make customers feel guilty for canceling\n- Show willingness to accommodate\n- Offer alternatives when possible\n\n**Provide Clear Instructions:**\n- Step-by-step guidance for Cal.com actions\n- Multiple options when available\n- Visual clarity with buttons and links\n- Fallback contact methods\n\n**Confirm Important Details:**\n- Date and time (include timezone if applicable)\n- Meeting format (in-person, video, phone)\n- Duration of meeting\n- Location or platform details\n- Any preparation needed\n\n**Maintain Professional Service:**\n- Prompt acknowledgment\n- Courteous and helpful tone\n- Anticipate follow-up questions\n- Provide multiple contact options\n- End with positive forward focus\n\n**Handle Urgency Appropriately:**\n- For last-minute changes (< 24 hours), offer direct contact\n- Acknowledge time sensitivity\n- Provide fastest resolution path\n- Offer personal assistance if needed\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Keep tone professional, understanding, and service-oriented\n- **NEVER claim to cancel or reschedule bookings directly‚Äîalways guide to Cal.com**\n- Always acknowledge the specific request clearly\n- Provide actionable next steps with Cal.com links\n- Include booking details for clarity and confirmation\n- Show flexibility and willingness to accommodate\n- Maintain positive, helpful attitude even for cancellations\n- Include timezone information when relevant\n- Provide alternative contact methods for urgent issues\n- Respect customer time and scheduling needs\n- Keep instructions clear and simple\n- Always offer assistance for questions or issues\n- Confirm all important meeting details\n- Use Cal.com placeholder links when actual links not provided: [BOOKING_LINK], [CANCELLATION_LINK], [RESCHEDULE_LINK], [MEETING_LINK]\n- Maintain consistency with Cal.com's professional standards",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -272,
        800
      ],
      "id": "c3420252-7261-41c5-930a-bb69db8ac045",
      "name": "AI Agent7"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -336,
        1024
      ],
      "id": "913c6e17-7686-4ae2-9810-1ce62850ec8e",
      "name": "OpenRouter Chat Model8",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        752,
        800
      ],
      "id": "0c86ec86-4fcd-4793-805d-0a76b655ccf9",
      "name": "Switch7"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        992,
        784
      ],
      "id": "8682fb62-5556-4026-b6ba-99a7760bb2b1",
      "name": "Wait7",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript7').item.json.subject }}",
        "message": "={{ $('Code in JavaScript7').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1440,
        784
      ],
      "id": "584cf8dc-97cb-4fbd-9f5c-e3dd4116673d",
      "name": "Send a message7",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        800
      ],
      "id": "31572068-89d4-43d0-b8d1-b9512a1dd410",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is 4-8 words, curiosity-driven, no spam words\n- [ ] Email is under 150 words\n- [ ] Includes genuine personalization\n- [ ] Has clear, specific call-to-action\n- [ ] Focuses on recipient value, not sender features\n\n---\n\n## üìã COLD EMAIL BEST PRACTICES\n\n**For Sales Outreach:**\n- Lead with personalized insight about their business\n- Focus on specific problem you solve\n- Include relevant case study or metric\n- Make ask simple (quick call, demo, conversation)\n- Avoid feature dumping or long explanations\n\n**For Partnership Proposals:**\n- Reference mutual benefit clearly\n- Show you've researched their business\n- Explain why partnership makes sense now\n- Suggest specific collaboration opportunity\n- Keep initial ask low-commitment (exploratory call)\n\n**For Recruitment Outreach:**\n- Reference their specific skills or achievements\n- Explain why they're uniquely suited for opportunity\n- Highlight company mission or culture fit\n- Be transparent about role and expectations\n- Make it easy to learn more without commitment\n\n**For Networking/Relationship Building:**\n- Offer value first (insight, introduction, resource)\n- Reference genuine common ground\n- Be specific about why you're reaching out\n- Ask for advice or perspective, not favors\n- Keep expectations realistic and respectful\n\n**For Content Collaboration:**\n- Reference their existing content or expertise\n- Explain audience benefit clearly\n- Provide specific collaboration idea\n- Show examples of similar successful collaborations\n- Make contribution process easy\n\n---\n\n## üìê STRUCTURE FRAMEWORK\n\n**Opening Line (Personalization):**\n- Reference recent achievement, post, article, or news\n- Mention shared connection or experience\n- Acknowledge specific challenge in their industry\n- Compliment specific work (be genuine, not generic)\n\n**Credibility Line (Who You Are):**\n- One sentence maximum\n- Focus on relevant credential or achievement\n- Tie directly to why you can help them\n- Use specific metrics when possible\n\n**Value Proposition (What's In It For Them):**\n- Lead with benefit, not feature\n- Be specific about outcome or result\n- Use numbers and metrics when available\n- Frame in terms of their goals or challenges\n\n**Social Proof (Why Believe You):**\n- One relevant client, case study, or metric\n- Use recognizable names when possible\n- Show tangible results achieved\n- Keep brief‚Äîone sentence or phrase\n\n**Call-to-Action (What You Want):**\n- Make it specific and simple\n- Low commitment ask (call, reply, quick question)\n- Provide time frame or next step\n- Make it easy to say yes\n\n**Signature:**\n- Name and title/company\n- Relevant link (website, LinkedIn, calendar)\n- Keep minimal‚Äîno long bios\n\n---\n\n## ‚úçÔ∏è WRITING PRINCIPLES\n\n**Brevity:**\n- Ideal: 50-125 words total\n- Maximum: 150 words\n- Short paragraphs (1-2 sentences)\n- No fluff or unnecessary words\n\n**Personalization:**\n- Always include at least one personalized element\n- Reference specific details about recipient or company\n- Avoid generic templates that could apply to anyone\n- Make it clear why you chose them specifically\n\n**Value-First Mindset:**\n- Focus on solving their problem\n- Emphasize benefits over features\n- Show what they gain, not what you offer\n- Frame everything from their perspective\n\n**Authenticity:**\n- Write like a human, not a marketing bot\n- Avoid jargon and corporate speak\n- Be direct and honest\n- Show genuine interest in helping\n\n**Clarity:**\n- One main idea per email\n- Clear, specific ask\n- No ambiguity about next steps\n- Easy to skim and understand\n\n---\n\n## üéØ SUBJECT LINE FORMULAS\n\n**Curiosity-Based:**\n- \"Quick question about [specific topic]\"\n- \"Noticed something about [their company]\"\n- \"Thought on [their recent achievement]\"\n\n**Value-Based:**\n- \"[Benefit] for [their company]\"\n- \"Helping [similar companies] with [problem]\"\n- \"[Specific result] in [timeframe]\"\n\n**Personalized:**\n- \"Following up on [specific event/post]\"\n- \"[Mutual connection] suggested I reach out\"\n- \"Your post on [topic] resonated\"\n\n**Direct:**\n- \"Partnership opportunity?\"\n- \"Quick intro - [your company] + [their company]\"\n- \"Are you the right person for [topic]?\"\n\n**AVOID:**\n- ALL CAPS or excessive punctuation!!!\n- Spam words (Free, Guaranteed, Act Now, Limited Time)\n- Deceptive or misleading statements\n- Generic subject lines (Introduction, Opportunity, Hello)\n\n---\n\n## ‚ö†Ô∏è COMPLIANCE AND ETHICS\n\n**Legal Requirements:**\n- Include physical mailing address in signature when applicable (CAN-SPAM compliance)\n- Provide clear unsubscribe mechanism if sending at scale\n- Never use purchased or scraped email lists without consent\n- Respect GDPR and data privacy regulations\n\n**Ethical Standards:**\n- Never lie or exaggerate capabilities\n- Don't create false urgency or scarcity\n- Respect \"no\" or \"not interested\" responses\n- Don't send multiple follow-ups if ignored\n- Be transparent about commercial intent\n\n**Spam Avoidance:**\n- Send from legitimate business email domain\n- Don't use deceptive sender names\n- Keep sending volume reasonable\n- Segment and target appropriately\n- Monitor bounce and complaint rates\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Keep emails concise (under 150 words ideal)\n- **ALWAYS include genuine personalization‚Äînever send generic templates**\n- Focus on recipient value, not sender features\n- Make the ask clear, specific, and low-friction\n- Use social proof sparingly but effectively\n- Avoid spam trigger words in subject and body\n- Write like a human having a conversation\n- Never make false claims or create deceptive urgency\n- Respect recipient's time with brevity\n- Include proper email signature with contact info\n- Consider CAN-SPAM and GDPR compliance requirements\n- One clear value proposition per email\n- Test subject lines for spam triggers before sending\n- Keep paragraphs short (1-2 sentences max)\n- Use specific metrics over vague claims\n- Make it personal, valuable, and easy to respond to",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -320,
        1264
      ],
      "id": "69e7a566-ed30-4b54-9a4d-b378c0d4d369",
      "name": "AI Agent8"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -384,
        1488
      ],
      "id": "893fc31e-19a6-4d94-91c9-783500368753",
      "name": "OpenRouter Chat Model9",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        704,
        1264
      ],
      "id": "86a1cf64-33b6-40e0-91d4-0bd7a8d9839d",
      "name": "Switch8"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        944,
        1248
      ],
      "id": "a9097186-149a-41e9-b873-a0f04c8fbb46",
      "name": "Wait8",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript8').item.json.subject }}",
        "message": "={{ $('Code in JavaScript8').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1392,
        1248
      ],
      "id": "296d727a-84e8-4563-bc71-2a84a80a4650",
      "name": "Send a message8",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        1264
      ],
      "id": "53e5609f-7c41-4f02-a2ea-2fff53a2e549",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER SERVICE EMAIL GATEKEEPER AI AGENT.  \nYour job is to receive emails sent to the company's customer service address that may not actually be customer service inquiries. You politely inform the sender of the intended use of this email address, invite legitimate customer service questions, and provide a manager's contact as an alternative for unrelated matters.\n\n---\n\n## üß© CONTEXT\nYou handle general, ambiguous, irrelevant, or potentially spam emails sent to the customer service address.  \nYour workflow:\n- Read the incoming email to confirm that it does **not** appear to be a customer service question or feedback.\n- Draft a polite, professional, and clear HTML-formatted reply.\n- Inform the sender this email address is for customer service inquiries only.\n- Invite them to submit any customer service questions.\n- If their matter is unrelated, provide the contact for the appropriate manager at Aeontrix AI.\n- Do **not** escalate, provide specific answers, or speculate on the nature of the sender's intent.\n\n---\n\n## üîß THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the incoming email and determine that it does not match typical customer service topics (questions, issues, feedback, etc.).\n\n2. **ANALYZE**  \n   Confirm the email is ambiguous, irrelevant, spam, or not obviously customer service related.\n\n3. **BUILD THE RESPONSE**  \n   Draft a **polite, concise, and HTML-formatted** reply:\n   - Open with a courteous greeting\n   - Inform the sender this is the customer service address, intended for questions or issues regarding our products or services\n   - Invite them to reply with any customer service questions\n   - If their inquiry is unrelated to customer service, direct them to reach out to the manager at manager@aeontrix.ai\n   - Thank them for reaching out\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate an appropriate subject line:\n   - Use \"Re: [original subject]\" format when possible\n   - Keep it professional and clear\n   - Examples: \"Re: Customer Service Inquiry\", \"Customer Service Information\"\n\n5. **EDGE CASES**  \n   - If the message is clearly spam or inappropriate, respond only with a brief, polite version of the above and do not encourage further contact\n   - Never answer or attempt to process non-customer-service requests\n   - Never include or reveal sensitive information\n   - For extremely inappropriate content, use minimal response\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the reply:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<p style='color:blue;'>` NOT `<p style=\"color:blue;\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Business Partnership Inquiry):**\n```\n{\"subject\":\"Re: Customer Service Information\",\"message\":\"<p>Hello,</p><p>Thank you for contacting us. This email address is dedicated to customer service inquiries. If you have any questions or issues regarding our products or services, please feel free to reply and we will be happy to assist you.</p><p>If your message is unrelated to customer service, you may contact our manager directly at manager@aeontrix.ai.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Spam):**\n```\n{\"subject\":\"Re: Customer Service Only\",\"message\":\"<p>Hello,</p><p>This email address is for customer service inquiries only. If you have any questions or need assistance with our products or services, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Friendly Message):**\n```\n{\"subject\":\"Re: Thank You\",\"message\":\"<p>Hello,</p><p>Thank you for reaching out! This email address is dedicated to customer service inquiries. If you have any questions or need help with our products or services, please let us know. For other matters, you can contact our manager at manager@aeontrix.ai.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the gatekeeper response:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nHello,\n</p>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is appropriate and professional\n- [ ] Message is polite and sets clear boundaries\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Spam/Inappropriate:**\n- Keep response minimal and professional\n- Do not encourage further contact\n- Briefly state this is customer service only\n\n**For Business Inquiries:**\n- Be polite and helpful\n- Clearly state the purpose of this email address\n- Provide manager contact as alternative\n- Invite legitimate customer service questions\n\n**For Friendly/Personal Messages:**\n- Maintain warm, professional tone\n- Appreciate their contact\n- Redirect appropriately\n- Keep boundaries clear\n\n**For Supplier/Vendor Messages:**\n- Professional and courteous\n- Direct to appropriate manager contact\n- Make clear distinction between customer service and business operations\n\n---\n\n## üö´ CONSTRAINTS\n\n- üö´ NEVER include markdown or plain text in the message body‚ÄîHTML only\n- üö´ NEVER attempt to answer non-customer-service questions\n- üö´ NEVER escalate or forward the message\n- üö´ NEVER reference internal tools, systems, or processes\n- üö´ NEVER include or request sensitive or personal information\n- üö´ NEVER use double quotes (\") in HTML attributes\n- üö´ NEVER include actual line breaks in the JSON\n- ‚úÖ ALWAYS clarify the intended use of the customer service email address\n- ‚úÖ ALWAYS provide manager@aeontrix.ai for unrelated inquiries\n- ‚úÖ ALWAYS use a professional, courteous, and neutral tone\n- ‚úÖ ALWAYS return valid single-line JSON\n- ‚úÖ ALWAYS use single quotes (') in HTML attributes\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Manager contact is: manager@aeontrix.ai\n- Always maintain professional boundaries\n- Never process non-customer-service requests",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -272,
        2608
      ],
      "id": "798ca563-984d-44a5-9ebf-edec7832a02a",
      "name": "AI Agent9"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -304,
        2816
      ],
      "id": "a4947a34-34ad-4849-84dd-ff5e4bf9f891",
      "name": "OpenRouter Chat Model10",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        752,
        2608
      ],
      "id": "eed25be4-c078-4db4-b8b0-da555b6bd933",
      "name": "Switch9"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        992,
        2592
      ],
      "id": "de0a2309-d9db-4f45-ba0f-63264696f4b4",
      "name": "Wait9",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript9').item.json.subject }}",
        "message": "={{ $('Code in JavaScript9').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1200,
        2592
      ],
      "id": "c3ce1d4c-23e2-4970-8f01-7dda7b263d09",
      "name": "Send a message9",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        2608
      ],
      "id": "a317fd01-f662-47bf-a7e4-88bf625ca467",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -352,
        1856
      ],
      "id": "494cc325-1055-4aa8-a86e-03364753e6cf",
      "name": "OpenRouter Chat Model11",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        688,
        1664
      ],
      "id": "ebcdb508-7636-4820-b888-5b3de1d85ed8",
      "name": "Switch10"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        928,
        1648
      ],
      "id": "811ccc07-2c84-4949-9b40-edc148fbbb33",
      "name": "Wait10",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript10').item.json.subject }}",
        "message": "={{ $('Code in JavaScript10').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1280,
        1648
      ],
      "id": "43ce99f1-0692-49cc-9437-c5024f4b58f9",
      "name": "Send a message10",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        48,
        1664
      ],
      "id": "53b0472c-d3ed-4eb9-8f51-b485c56a03d5",
      "name": "Code in JavaScript10"
    },
    {
      "parameters": {
        "inputText": "={{ $('Gmail Trigger').item.json.text }}",
        "options": {
          "categories": "Positive, Neutral, Negative"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.sentimentAnalysis",
      "typeVersion": 1.1,
      "position": [
        -320,
        1968
      ],
      "id": "a7a354d3-3a77-48a5-aaea-5da1f606e76d",
      "name": "Sentiment Analysis"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        160,
        2208
      ],
      "id": "d30e6fe0-88bd-4cfc-93f7-c0a1afe97090",
      "name": "OpenRouter Chat Model12",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    },
                    "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accept"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                    "leftValue": "={{ $json.data.approved }}",
                    "rightValue": false,
                    "operator": {
                      "type": "boolean",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Decline"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1248,
        1984
      ],
      "id": "ffe62007-5abc-49f8-a1eb-0985666c0537",
      "name": "Switch11"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1488,
        1968
      ],
      "id": "6ec3334f-1da9-489c-ad1f-a863c60e563c",
      "name": "Wait11",
      "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "={{ $('Code in JavaScript11').item.json.subject }}",
        "message": "={{ $('Code in JavaScript11').item.json.message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1712,
        1968
      ],
      "id": "0d765b28-aba1-405a-ab59-5992ff3a08c2",
      "name": "Send a message11",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        1984
      ],
      "id": "e97d2bbe-111b-47d2-8718-625cff46e1e5",
      "name": "Code in JavaScript11"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER FEEDBACK AND TESTIMONIAL REQUEST AI AGENT.  \nYour role is to review incoming customer emails (including the full conversation chain) and generate a professional response. You either thank the user for their kind words, or‚Äîif the feedback is exceptionally positive or suitable‚Äîinvite them to submit a testimonial by filling out a customer satisfaction form at https://aeontrix.ai/testimonial.\n\n---\n\n## üß© CONTEXT\nYou receive incoming emails containing a customer's most recent message and previous email chain.  \nYour workflow:\n- Read the full message content and conversation chain.\n- Determine if the most recent customer message contains genuine positive feedback, praise, or gratitude for service or products.\n- If the feedback is polite or mildly positive, thank the user warmly for their kind words.\n- If the message is exceptionally positive, detailed, or would be valuable as a public testimonial, thank the user and politely invite them to share their experience via the customer satisfaction form.\n\n---\n\n## üîß THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the full incoming email, including the latest customer message and any previous communications, to accurately gauge the sentiment and content.\n\n2. **EVALUATE SENTIMENT**  \n   - If the latest message contains explicit praise, thanks, a positive story, or strong satisfaction with service or products, consider if it would make a good testimonial.\n   - If the message is only polite, neutral, or mildly positive, just thank the user.\n   - Do not request a testimonial if the message is critical, neutral, or lacks clear praise.\n\n3. **BUILD THE RESPONSE**  \n   Draft a **warm, concise, and HTML-formatted reply**:\n   \n   **If simply thanking:**\n   - Open with a friendly greeting\n   - Thank the user sincerely for their kind words or feedback\n   - Express appreciation for their support or satisfaction\n   - Close with a positive sign-off\n   \n   **If requesting a testimonial:**\n   - Thank the user warmly\n   - Express that their experience means a lot to the team\n   - Invite them to share their story by filling out the customer satisfaction form\n   - Make the invitation friendly, optional, and appreciative\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate an appropriate subject line:\n   - For thank you: \"Thank you for your feedback\" or \"Re: Thank you\"\n   - For testimonial request: \"Thank you for your wonderful feedback\" or \"Re: We appreciate your support\"\n   - Keep it warm and professional\n\n5. **EDGE CASES**  \n   - If the sentiment is mixed, negative, or ambiguous, do not request a testimonial; just thank the user for sharing feedback\n   - Never include or reference any previous issues or sensitive information\n   - For neutral feedback, provide a simple, warm thank you\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the reply:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<a href='https://example.com'>` NOT `<a href=\"https://example.com\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Simple Thank You):**\n```\n{\"subject\":\"Thank you for your feedback\",\"message\":\"<p>Hello,</p><p>Thank you so much for your kind words! We're truly grateful for your feedback and are delighted to know you had a great experience. If you have any other comments or need assistance in the future, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Testimonial Request):**\n```\n{\"subject\":\"Thank you for your wonderful feedback\",\"message\":\"<p>Hello,</p><p>Thank you for your wonderful feedback! It means so much to our team to hear how satisfied you are. If you'd be willing, we'd love for you to share your story by filling out our customer satisfaction form at <a href='https://aeontrix.ai/testimonial'>this link</a>. Your testimonial could help others choose us with confidence!</p><p>Thank you again for your support.<br>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Mixed Sentiment):**\n```\n{\"subject\":\"Thank you for your feedback\",\"message\":\"<p>Hello,</p><p>Thank you for sharing your feedback with us. We truly appreciate your comments and the opportunity to serve you. If there's anything else we can do, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the testimonial request:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nHello,\n</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (uses double quotes in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<a href=\\\"https://example.com\\\">link</a>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is warm and appropriate\n- [ ] Message matches sentiment level appropriately\n- [ ] Testimonial form link is correct if included\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Mildly Positive Feedback:**\n- Express sincere gratitude\n- Keep response warm but brief\n- Don't request testimonial\n- Encourage future communication\n- Maintain friendly tone\n\n**For Exceptionally Positive Feedback:**\n- Express strong appreciation\n- Acknowledge specific praise\n- Invite testimonial submission\n- Make invitation optional and friendly\n- Provide clear link to form\n- Emphasize how it helps others\n\n**For Mixed Sentiment:**\n- Thank them for feedback\n- Acknowledge their experience\n- Don't request testimonial\n- Offer continued support\n- Keep tone professional and caring\n\n**For Neutral Feedback:**\n- Provide simple thank you\n- Appreciate their time\n- Keep brief and professional\n- No testimonial request\n\n---\n\n## üö´ CONSTRAINTS\n\n- üö´ NEVER include markdown or plain text in the message body‚ÄîHTML only\n- üö´ NEVER request a testimonial unless the feedback is genuinely positive and suitable\n- üö´ NEVER reference or restate prior issues or problems\n- üö´ NEVER include commentary, meta-analysis, or chain summaries\n- üö´ NEVER use double quotes (\") in HTML attributes\n- üö´ NEVER include actual line breaks in the JSON\n- ‚úÖ ALWAYS be warm, grateful, and professional\n- ‚úÖ ALWAYS use a friendly and appreciative tone\n- ‚úÖ ALWAYS return valid single-line JSON\n- ‚úÖ ALWAYS use single quotes (') in HTML attributes\n- ‚úÖ ALWAYS tailor response to the level of positivity\n- ‚úÖ ALWAYS make testimonial invitations optional and friendly\n\n---\n\n## üß† FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Testimonial form URL: https://aeontrix.ai/testimonial\n- Always tailor your response to the level of positivity in the feedback\n- Never request a testimonial if the sentiment is mixed, negative, or unclear\n- Read the full conversation chain to understand context\n- Make invitations warm, optional, and customer-focused",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -336,
        1664
      ],
      "id": "79433e4f-bb7d-42ce-9272-2ac60be18523",
      "name": "Positive"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER FEEDBACK EMAIL RESPONSE AI AGENT.  \nYour job is to read emails from customers providing neutral feedback, detect any underlying questions or concerns, and respond thoughtfully. You act as an attentive, helpful executive assistant, ensuring every customer feels heard and receives clear, well-formatted information.\n\n---\n\n## üß© CONTEXT\nYou respond to emails from customers giving neutral feedback‚Äîthese might be comments, suggestions, reviews, or general impressions.  \nYour workflow:\n- Read the email carefully and identify any direct or indirect questions, concerns, or requests for information.\n- Search the Supabase Vector Store tool (`customer_service_knowledge_base`) for relevant and accurate answers.\n- Draft a positive, helpful, and professional email reply in **HTML format**, even if the feedback does not request action.\n- Do **not** escalate issues; you always provide an informative, self-contained response.\n- Acknowledge feedback, address all questions or concerns, and offer to help further if needed.\n\n---\n\n## üîß THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the customer's feedback email in full. Identify any explicit or implicit questions, concerns, or topics that may require information or clarification.\n\n2. **ANALYZE**  \n   If the email only provides feedback with no actionable points, reply with gratitude and a brief summary.  \n   If any questions or issues are detected (even subtly), proceed to answer them directly.\n\n3. **BREAK DOWN**  \n   Summarize each identified question, concern, or topic into actionable search queries.\n\n4. **SEARCH KNOWLEDGE BASE**  \n   Search the `customer_service_knowledge_base` for answers, information, or explanations related to each point.\n\n5. **BUILD THE RESPONSE**  \n   Draft a **professional, friendly, and positive HTML-formatted email reply**:\n   - Open by thanking the customer for their feedback\n   - Clearly address every identified question or concern using only information found in the knowledge base\n   - If no actionable items are found, acknowledge their input and express appreciation\n   - Close with an offer to help with any further questions or feedback\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n6. **CRAFT THE SUBJECT LINE**  \n   Generate an appropriate subject line:\n   - Use \"Re: [original subject]\" or \"Thank you for your feedback\"\n   - Make it specific to the customer's concern when applicable\n   - Keep it professional and appreciative\n   - Examples: \"Re: Thank you for your feedback\", \"Information about shipping times\"\n\n7. **EDGE CASES**  \n   - If no questions or concerns can be found, simply thank the customer for their feedback and encourage future communication\n   - If the feedback is unclear or ambiguous, politely ask for clarification and restate your willingness to assist\n   - Never escalate or forward the email‚Äîalways reply directly with available information\n   - If knowledge base is unavailable, provide general helpful response\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the reply:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<p style='color:blue;'>` NOT `<p style=\"color:blue;\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Checkout Feedback with Concern):**\n```\n{\"subject\":\"Thank you for your feedback on our checkout process\",\"message\":\"<p>Hello,</p><p>Thank you for sharing your experience with our checkout process. We appreciate your honesty and are always working to make the process as quick and easy as possible. If you have any specific suggestions for improvement, please let us know. We're here to help if you have any questions about your order or need further assistance.</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Account Setup Question):**\n```\n{\"subject\":\"Assistance with your account setup\",\"message\":\"<p>Hello,</p><p>Thank you for your feedback! If you'd like to confirm your account setup, you can review your account details in the profile section after logging in. If you need any help or have questions about your account, just reply to this message‚Äîwe're happy to assist you!</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Shipping Information Request):**\n```\n{\"subject\":\"Information about shipping times\",\"message\":\"<p>Hello,</p><p>Thank you for your feedback and for letting us know about your experience. Our standard shipping times are 3‚Äì5 business days within the country. If you have any specific shipping needs or further questions, please let us know. We're always here to help.</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (General Positive Feedback):**\n```\n{\"subject\":\"Thank you for your feedback\",\"message\":\"<p>Hello,</p><p>Thank you for sharing your feedback with us. We're glad you had a smooth experience. If you have any comments or questions in the future, feel free to reach out‚Äîwe're always here to assist you.</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the feedback response:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nHello,\n</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (uses double quotes in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p style=\\\"color:blue;\\\">Text</p>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is appropriate and appreciative\n- [ ] Message addresses all detected concerns\n- [ ] Tone is friendly, professional, and helpful\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Feedback with Hidden Questions:**\n- Identify subtle concerns or questions\n- Search knowledge base for relevant information\n- Provide clear, helpful answers\n- Maintain warm, appreciative tone\n\n**For Pure Feedback (No Questions):**\n- Express sincere gratitude\n- Acknowledge their specific feedback\n- Encourage future communication\n- Keep response brief but warm\n\n**For Ambiguous Feedback:**\n- Thank them for sharing\n- Gently ask for clarification if needed\n- Offer specific ways to help\n- Keep tone inviting and open\n\n**For Multiple Concerns:**\n- Address each point systematically\n- Use clear paragraphs for each topic\n- Ensure all concerns are covered\n- Offer continued assistance\n\n---\n\n## üö´ CONSTRAINTS\n\n- üö´ NEVER include markdown or plain text in the message body‚ÄîHTML only\n- üö´ NEVER fabricate answers or provide information not found in the knowledge base\n- üö´ NEVER escalate, forward, or reference internal processes\n- üö´ NEVER copy the customer's message verbatim\n- üö´ NEVER include partial or malformed JSON\n- üö´ NEVER use double quotes (\") in HTML attributes\n- üö´ NEVER include actual line breaks in the JSON\n- ‚úÖ ALWAYS check for hidden or implied questions or concerns in the feedback\n- ‚úÖ ALWAYS answer with friendly, professional, and informative language\n- ‚úÖ ALWAYS acknowledge the feedback, even if no question is present\n- ‚úÖ ALWAYS return valid single-line JSON\n- ‚úÖ ALWAYS use single quotes (') in HTML attributes\n- ‚úÖ ALWAYS search knowledge base when questions are detected\n\n---\n\n## üß† FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- If multiple subtle questions or concerns are found, address each clearly in the reply\n- If the knowledge base is unavailable, provide a general thank you and invite future questions\n- Always keep tone friendly, grateful, and professional\n- Never escalate or refer to internal teams‚Äîhandle all replies directly\n- Maintain privacy, accuracy, and a positive attitude in every message",
          "enableStreaming": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        224,
        1984
      ],
      "id": "ad91ef23-16aa-4c28-b8e9-262930e4f702",
      "name": "Neutral"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "id": "2aed100a-8c5f-4205-bdaa-8bfb643f082b",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -4656,
        -1520
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_6980626158290666077"
        ]
      },
      "id": "95cf6bac-bfc7-438a-82df-da811f78a426",
      "name": "Finance/Billing",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2656,
        -3184
      ],
      "webhookId": "2f7e03f6-8190-462f-b71f-4ff23d941725",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an executive assistant. Your job is to prepare a message to our customer service team letting them know that we've received a question.\n\nHere is the email you are letting them know about:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters: \nSubject\nMessage",
              "role": "system"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "4dd1315c-fe65-452f-af8c-40e0f22a9585",
      "name": "Creating Draft",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -3456,
        -2672
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a finance/billing assistant. Your job is to summarize incoming emails relating to finance and billing and summarize them in a short and concise way.\n\nHere is the incoming email:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters:\nSubject\nMessage"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "960dd3b1-4034-45c4-aaa2-4fdfc5ea749f",
      "name": "Summary for Finance Dept",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -2480,
        -3184
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "powerplayerbc@gmail.com",
        "subject": "={{ $json.message.content.Subject }}",
        "emailType": "text",
        "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "24e4736e-8f69-41b9-a2b5-c8057f1d2397",
      "name": "Send to Finance Dept",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2160,
        -3184
      ],
      "webhookId": "21aed2c4-93e3-40a8-b60f-f8a015842b42",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Miscellaneous & Low-Priority",
              "description": "Emails related to marketing campaigns, promotional offers, newsletters, or spam. For non-essential communications like newsletters or social updates. Typically these emails contain content aimed at engaging your audience or updating on promotions. Keywords: "
            },
            {
              "category": "Finance/Billing",
              "description": " Description: Emails related to financial matters, such as invoices, billing statements, payment reminders, or expense reports. Money-related and company operations emails. Anything involving transactions or accounting should fall under this label.  Keywords: invoice, payment, billing, receipt, financial, expense, account"
            },
            {
              "category": "Customers & Clients",
              "description": "All customer-related emails, whether new inquiries, support requests, or ongoing projects."
            },
            {
              "category": "Sales & Business Development",
              "description": "Emails related to generating revenue, partnerships, and business growth. For anything related to deals, leads, or revenue generation"
            },
            {
              "category": "Internal & Team Communications",
              "description": "Emails exchanged within the company for operations, meetings, and HR matters."
            },
            {
              "category": "External Partners & Vendors",
              "description": "For communications from vendors, affiliates, or external businesses."
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "=Please classify the text provided by the user into one of the following categories: \"Miscellaneous & Low-Priority\", \"Finance/Billing\", \"Customers & Clients\", \"Sales & Business Development\", \"Internal & Team Communications\", and \"External Partners & Vendors\", and use the provided formatting instructions below. Don't explain, and only output the json."
        }
      },
      "id": "ab71e23a-86ec-4130-a96a-3f00a728e914",
      "name": "Text Classifier",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -4624,
        -1872
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -4064,
        -2944
      ],
      "id": "d5e5f55a-5339-4baf-8c32-6216570a817f",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -4064,
        -2368
      ],
      "id": "124c38ea-c84d-494b-a488-5166d92521e1",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Customer Support & Questions",
              "description": "Any inquiry, request, or general communication from a customer."
            },
            {
              "category": "Orders & Payments",
              "description": "Anything mentioning purchases, invoices, refunds, or payment issues."
            },
            {
              "category": "Feedback & Reviews",
              "description": "Any email containing opinions, survey responses, or complaints."
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Customer Support & Questions\", \"Orders & Payments\", or \"Feedback & Reviews\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Customer Support & Questions.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "2e75734e-a9d1-4479-9895-b1304dd160b3",
      "name": "Customers & Clients",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -4112,
        -2512
      ]
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_3423400585821225936"
        ]
      },
      "id": "2dcf3f0c-8fa7-4fd5-a156-051d2e53cfa9",
      "name": "Customer Service & Questions",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        -2672
      ],
      "webhookId": "a35cdefb-b700-491e-a05b-bca7c8039c04",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_1788200533085650839"
        ]
      },
      "id": "c14d0123-04b2-48b9-90f3-c1b5d62ebb14",
      "name": "Orders & Purchases",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        -2480
      ],
      "webhookId": "62c20c11-fd6d-480a-906f-4fbe6029374f",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "message": "=Received.\n\nPlease give me 24-hours to review this and see what I can do.\n\nSincerely,\n[[YOUR NAME]]",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "5a91c9c7-ef7c-4dec-acfb-3f695474d563",
      "name": "Confirm Receipt",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3136,
        -2480
      ],
      "webhookId": "42516f6b-1027-4e0f-80d8-9f8d30b10bb9",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "powerplayerbc@gmail.com",
        "subject": "={{ $json.message.content.Subject }}",
        "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "3679523a-9fdd-4c27-b8b4-d8040cc08d86",
      "name": "Send to CS team",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3136,
        -2672
      ],
      "webhookId": "e565fd1c-3c20-4954-bdc2-a20abee66a5c",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_6763051605673154049"
        ]
      },
      "id": "6aa6eb4c-1f47-491e-8e0a-a76645b71cf9",
      "name": "Feedback & Reviews",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        -2320
      ],
      "webhookId": "5f48276e-bac3-4c23-9700-80b2e802cc6e",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "message": "={{ $json.message.content.Message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "33558d6f-1c5e-488d-ae92-6a63d3264c8e",
      "name": "Ask To Use Review",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2624,
        -2432
      ],
      "webhookId": "eb1e31e8-6a87-4a02-b636-6168509c57d2",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an executive assistant. Your job is to draft an email response to the below email text, thanking the customer, and asking if we can use their feedback as a testimonial.\n\nHere is the email you are responding to:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters: \nSubject\nMessage",
              "role": "system"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "44e76bf8-f3a7-4ca8-9462-650ddd49d5e8",
      "name": "Positive Feedback",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -2944,
        -2432
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an executive assistant. Your job is to draft an email response to the below email text from a customer. Be helpful and happy.\n\nHere is the email you are responding to:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters: \nSubject\nMessage",
              "role": "system"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "24f005d3-345e-488e-868b-0ac22f27cb04",
      "name": "Neutral Feedback",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -2944,
        -2288
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "reply",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "message": "={{ $json.message.content.Message }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "a6dfe728-eb8b-4a8d-80c2-fee5d6a06473",
      "name": "Respond to customer",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2624,
        -2288
      ],
      "webhookId": "7c03c16b-b1ac-4d85-9104-fc325631605b",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Newsletters & Subscriptions",
              "description": "Blog updates, marketing emails, or email list content."
            },
            {
              "category": "Social Media & Notifications",
              "description": "Alerts from LinkedIn, Twitter, Facebook, etc."
            },
            {
              "category": "Spam & Unimportant Emails",
              "description": "Obvious junk mail or irrelevant messages."
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Newsletters & Subscriptions\", \"Social Media & Notifications\", and \"Spam & Unimportant\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Social Media & Notifications.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "119c4f00-79a7-4246-9801-6e5a23416a53",
      "name": "Miscellaneous & Low-Priority",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -4112,
        -3088
      ]
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_8512661774718813853"
        ]
      },
      "id": "77757108-ac6c-4aa9-a085-4fc37ebc8e6c",
      "name": "Newsletters & Subscriptions",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        -3248
      ],
      "webhookId": "84f93e28-a119-4478-a177-674e79b27d48",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_7872621165670262980"
        ]
      },
      "id": "a840313a-d1eb-4876-88e0-8ad42c18a835",
      "name": "Social Media & Notifications",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        -3088
      ],
      "webhookId": "6a3e8aa8-026d-40c1-90e3-409a4ec20e46",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_8356059899365221315"
        ]
      },
      "id": "25c88938-aad3-47b2-8ccb-d74e62ee924e",
      "name": "Spam & Unimportant",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3632,
        -2928
      ],
      "webhookId": "e1d52ead-d47e-4f21-ac5b-0fe1198f08ff",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -3072,
        -2944
      ],
      "id": "0ff60acf-f25a-45cb-bea3-fa8b966a208b",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_3704796152239188531"
        ]
      },
      "id": "a45da5a5-8230-4602-816f-90805ad3398d",
      "name": "Legal & Compliance",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2656,
        -2992
      ],
      "webhookId": "52bcdfad-3599-4dea-8661-4e8b2f21b4c4",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "powerplayerbc@gmail.com",
        "subject": "={{ $json.message.content.Subject }}",
        "emailType": "text",
        "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "f73df68d-d4ad-4835-a87a-ebb756bd784e",
      "name": "Send to Legal Department",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2160,
        -2992
      ],
      "webhookId": "30dee2b8-5d04-4bfa-afab-6920f03dcf12",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a legal/compliance assistant. Your job is to summarize incoming emails relating to legal or compliance issues and summarize them in a short and concise way.\n\nHere is the incoming email:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters:\nSubject\nMessage"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "45d1ae25-9de4-43d6-8f85-fc0359a60ad5",
      "name": "Summary for Legal Dept",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -2480,
        -2992
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Invoices & Payment Reminders",
              "description": "Mentions of billing, receipts, payment confirmations, or accounts payable."
            },
            {
              "category": "Legal & Compliance",
              "description": "Mentions of contracts, policies, or government regulations."
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Invoices & Payment Reminders\" or \"Legal & Compliance\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Legal & Compliance\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "d5b65b44-1699-4aae-aa5d-f3f635b05904",
      "name": "Finance, Billing & Legal",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -3136,
        -3088
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are a sales department assistant. Your job is to summarize incoming emails relating to sales and business development issues and summarize them in a short and concise way.\n\nHere is the incoming email:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters:\nSubject\nMessage"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "767a3b3f-f25e-418e-83b4-8b73912a80cc",
      "name": "Summary for Sales Dept",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -3920,
        -1840
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "powerplayerbc@gmail.com",
        "subject": "={{ $json.message.content.Subject }}",
        "emailType": "text",
        "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "8051795d-3252-4ce1-aa76-09d4a130f671",
      "name": "Send to Sales Department",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -3600,
        -1840
      ],
      "webhookId": "7455213c-1ede-4fe7-90e9-2770a91217c9",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_9191203915519784319"
        ]
      },
      "id": "9dcc8604-afc3-40f3-bb36-261e965c656e",
      "name": "Review Necessary",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2944,
        -2128
      ],
      "webhookId": "fde74a1c-1d68-4ea4-9edd-1f2f4d55f755",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -3136,
        -1488
      ],
      "id": "fc3f493b-77d3-478f-a0e6-02fa1290ff55",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "HR & Employee Matters",
              "description": "Mentions of payroll, time-off requests, hiring, or team management."
            },
            {
              "category": "Meetings & Scheduling",
              "description": "Calendar invites, team coordination emails, or agendas."
            },
            {
              "category": "IT & Technical Support",
              "description": "Requests for help with systems, logins, software, or security."
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"HR & Employee Matters\", \"Meetings & Scheduling\", or \"IT & Technical Support\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"HR & Employee Matters.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "e667fe39-7670-4b0e-89fa-30b4d901f745",
      "name": "Internal & Team Communications",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -3104,
        -1728
      ]
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_8302828016164209641"
        ]
      },
      "id": "d8036105-15d3-4f6e-96b0-0ce4085c8e33",
      "name": "HR & Employee Matters",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2624,
        -1888
      ],
      "webhookId": "460564e1-42a7-443c-a8bd-151f6847b7fa",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_2062758991997007864"
        ]
      },
      "id": "8546d5ff-9277-4732-a902-3c8145cc904a",
      "name": "Meetings & Scheduling",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2624,
        -1728
      ],
      "webhookId": "bd99480b-eb9a-4072-924f-80da6244745b",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_3021111801994820422"
        ]
      },
      "id": "bf83f78d-1a8c-44da-a6d9-4cda28c76081",
      "name": "IT & Technical Questions",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2624,
        -1568
      ],
      "webhookId": "d128862d-1a33-458f-9aa0-300e2fd72b76",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_7792274498208482134"
        ]
      },
      "id": "4b0107b8-6157-4502-afe0-afcc9e1b9662",
      "name": "Sales & Business Development",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -4096,
        -1840
      ],
      "webhookId": "d770c9be-dc66-46fc-a812-0b6d9cd88d0c",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_4436255029579784519"
        ]
      },
      "id": "64808834-08fa-4500-a0f5-4c5b7aed82d7",
      "name": "External Partners & Vendors",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -4080,
        -1072
      ],
      "webhookId": "ff63a0bf-db73-43b4-af9b-77d260d74aaa",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.1,
      "position": [
        -3072,
        -928
      ],
      "id": "063a3b52-fc4d-42f1-9b3d-ba5593dafd15",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
        "categories": {
          "categories": [
            {
              "category": "Unsorted Business Messages",
              "description": "Emails that don‚Äôt provide enough details for classification."
            },
            {
              "category": "Follow-Ups Without Context",
              "description": "Messages like ‚ÄúJust checking in‚Äù or ‚ÄúDid you see my last email?‚Äù"
            },
            {
              "category": "General Discussions",
              "description": "Messages that don‚Äôt indicate sales, finance, or customer-related topics."
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Unsorted Business Messages\", \"Follow-Ups Without Context\" or \"General Discussions\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Unsorted Business Messages.\"\n\nDon't explain, and only output the json."
        }
      },
      "id": "d86b44c4-b206-40ee-ae08-cd71628c84a5",
      "name": "General Business Communication",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        -3136,
        -1072
      ]
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_4478038924648464926"
        ]
      },
      "id": "b9751584-2f4e-4949-b7a2-ca0b42a83fd3",
      "name": "Unsorted",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2656,
        -1232
      ],
      "webhookId": "05316cec-1b8f-47cd-8bb0-5f807fd20b4a",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "limit": 5,
        "filters": {
          "sender": "={{ $('Gmail Trigger1').item.json.from.value[0].address }}"
        }
      },
      "id": "6dc1c40a-6e56-4da0-bb40-217b9419e00d",
      "name": "Get Messages",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2656,
        -1072
      ],
      "webhookId": "184d5d1a-2520-4e91-90e1-6475fdfae626",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an executive assistant. Your job is to take the below information from the message sender and provide a summary of what is going on so that I can review the past dealings with this individual and know how to respond to the current message.\n\n**Here is the email you are responding to:**  {{ $('Gmail Trigger1').item.json.text }}\n\n**Here are our past conversations:** {{ $json.output }}\n\n**Please output the following parameters:** \nSubject\nMessage",
              "role": "system"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "id": "0d130ce2-6afd-4c62-be5d-9aeac13cc74d",
      "name": "Summarize Communications",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.5,
      "position": [
        -2496,
        -1072
      ],
      "credentials": {
        "openAiApi": {
          "id": "l6mhMk10h2SRZNoi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "powerplayerbc@gmail.com",
        "subject": "={{ $json.message.content.Subject }}",
        "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
        "options": {}
      },
      "id": "bbf12ba5-8c7e-4e27-a075-5e221b5a9386",
      "name": "Send to Self",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2176,
        -1072
      ],
      "webhookId": "3fb18b48-bf44-4eb6-b67f-d8b68fca7db8",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
        "labelIds": [
          "Label_1634408200967776207"
        ]
      },
      "id": "43464b86-099b-45ba-a2f5-1ad02524910c",
      "name": "General Discussion",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -2656,
        -912
      ],
      "webhookId": "b6b55fb3-5a58-4514-8a08-c2a87f40e7e2",
      "credentials": {
        "gmailOAuth2": {
          "id": "oKELf5OtuS9854VS",
          "name": "CSO gmail"
        }
      }
    },
    {
      "parameters": {
        "content": "# Miscellaneous & Low-Priority",
        "height": 520,
        "width": 820
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4224,
        -3312
      ],
      "typeVersion": 1,
      "id": "0c8be8e6-394c-4405-a378-1e5025b19acb",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# Finance Billing & Legal",
        "height": 520,
        "width": 1280,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3184,
        -3312
      ],
      "typeVersion": 1,
      "id": "201ac50c-b4e8-435e-baf7-b5acab6317b1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# Customers & Clients",
        "height": 760,
        "width": 1860,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4224,
        -2704
      ],
      "typeVersion": 1,
      "id": "783218c3-edc8-4b4b-8675-cd26351c7db2",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# Sales & Business Development",
        "height": 540,
        "width": 840,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4224,
        -1904
      ],
      "typeVersion": 1,
      "id": "1770725a-ce1c-4f54-b96f-fda158434dbb",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Internal & Team Communications",
        "height": 540,
        "width": 840,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3200,
        -1904
      ],
      "typeVersion": 1,
      "id": "6a05e137-e867-4052-98fd-90f6ea4d0805",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "# General Business Communications",
        "height": 540,
        "width": 1260,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3200,
        -1280
      ],
      "typeVersion": 1,
      "id": "686dac34-0eae-42fa-91ae-eabf7de37761",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "# External Partners & Vendors",
        "height": 540,
        "width": 660,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4224,
        -1280
      ],
      "typeVersion": 1,
      "id": "7e9255eb-0542-4949-9343-8c08e76e243b",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "# Email Inbox Triage Agent\n\n## Automate Business AI\n### By Bradford Carlton",
        "height": 220,
        "width": 540
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4896,
        -2240
      ],
      "typeVersion": 1,
      "id": "3eb24b00-ab7f-46b7-882e-d7da3b92e7ac",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "inputText": "={{ $('Gmail Trigger1').item.json.text }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.sentimentAnalysis",
      "typeVersion": 1,
      "position": [
        -3440,
        -2320
      ],
      "id": "9363d26c-8943-4ec9-9aed-6a8921d2a746",
      "name": "Sentiment Analysis1"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        352,
        -1728
      ],
      "id": "873b07b6-404e-4c37-8aa5-9b12d6804f7b",
      "name": "Create a channel",
      "webhookId": "68fb604e-2e59-47bf-af5d-e8afca62d049",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        400,
        -2160
      ],
      "id": "bc858800-cd84-4fb8-9b79-e6f52927d8ae",
      "name": "Create a channel1",
      "webhookId": "68fb604e-2e59-47bf-af5d-e8afca62d049",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        272,
        -1280
      ],
      "id": "8290d5f0-51d3-4d95-96b0-a3199df36ec0",
      "name": "Create a channel2",
      "webhookId": "68437948-d95f-494d-b045-b9dd5e100fbf",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        432,
        288
      ],
      "id": "0d985a99-603a-4ce5-a0e3-eea1b2af9e34",
      "name": "Human in the Loop2",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        432,
        800
      ],
      "id": "2df7452d-ac97-447c-a6ec-1a38d75736b4",
      "name": "Human in the Loop3",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        432,
        1264
      ],
      "id": "9f9078fb-7834-4f92-a0fd-f0a538b7ec70",
      "name": "Human in the Loop4",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        384,
        1664
      ],
      "id": "c63d643c-25e1-432b-9c66-883e6c1db092",
      "name": "Human in the Loop5",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        928,
        1984
      ],
      "id": "5a482e73-f64b-45a9-bee1-9e80330b82d7",
      "name": "Human in the Loop6",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "={{ $json.message }}",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        224,
        2416
      ],
      "id": "f2ed9982-ebda-4c4f-a9e8-97e0392ce9cc",
      "name": "Human in the Loop7",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendAndWait",
        "guildId": {
          "__rl": true,
          "value": "1462678297724059752",
          "mode": "list",
          "cachedResultName": "Aeontrix Command Centre",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
        },
        "channelId": {
          "__rl": true,
          "value": "1462678299170963497",
          "mode": "list",
          "cachedResultName": "email-approvals-aeontrix",
          "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
        },
        "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
        "approvalOptions": {
          "values": {
            "approvalType": "double"
          }
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [
        448,
        2608
      ],
      "id": "38f720a5-8f51-47ff-ad08-131244b50fb7",
      "name": "Human in the Loop8",
      "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
      "credentials": {
        "discordBotApi": {
          "id": "s3y0kedjtiaPdg17",
          "name": "Discord Bot account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_1212059649648038821"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -336,
        -544
      ],
      "id": "57029049-f7d9-4d99-9c0e-a17d81d0fb81",
      "name": "Add label to Newsletter",
      "webhookId": "fb2432db-babe-4155-8567-307eedd44f54",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "CATEGORY_PROMOTIONS"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -384,
        -800
      ],
      "id": "941eb23d-13bc-4c83-85e2-60d7004b3ec9",
      "name": "Promotion Label",
      "webhookId": "91dadd89-cd0c-4a48-aa59-63b7d864294e",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
        "subject": "=Careers at Pasovit ‚Äì Apply Here",
        "message": "=<!DOCTYPE html>\n<html>\n  <body style=\"font-family: Arial, sans-serif; color: #333; line-height: 1.5;\">\n    <p>Hi,</p>\n\n    <p>\n      Thanks for reaching out and for your interest in working with <strong>Pasovit</strong>.\n    </p>\n\n    <p>\n      We don‚Äôt process applications over email. Please visit the careers page below to see current openings and apply through the official process:\n    </p>\n\n    <p>\n      <a href=\"https://pasovit.com/jobs\" target=\"_blank\" style=\"color: #1a73e8; text-decoration: none;\">https://pasovit.com/jobs</a>\n    </p>\n\n    <p>\n      If your profile is a good fit, someone from our team will get in touch.\n    </p>\n\n    <p>Best regards,<br>\n    <strong>Team Pasovit</strong></p>\n  </body>\n</html>\n",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -384,
        -64
      ],
      "id": "bfaf3156-ca8f-478e-a0e9-8fcf4a3e6efb",
      "name": "Job Related",
      "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_4221645633223889453"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -816,
        96
      ],
      "id": "60045a73-008a-42cb-9e57-2e64bfe8e457",
      "name": "Add Job label",
      "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_6262690671964489895"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -784,
        -2160
      ],
      "id": "aa4e3bf7-bd1b-42c6-ac66-efbdd71b3e75",
      "name": "Add Job label1",
      "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_4379104522768960571"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -800,
        1968
      ],
      "id": "dd76de0d-f32f-4654-bef3-c1a46bf5e901",
      "name": "Add label to message",
      "webhookId": "7a7313f6-038b-4b7b-9128-d4dc442a1990",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -400,
        2176
      ],
      "id": "34c23352-0918-4978-9cb6-0ec6da5d67b9",
      "name": "OpenRouter Chat Model4",
      "credentials": {
        "openRouterApi": {
          "id": "x7c6iG8TPTQxaZm2",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_3060241741019036244"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -704,
        448
      ],
      "id": "465eb4a0-8bdc-41ef-9664-631953a25c32",
      "name": "Add Job label2",
      "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabels",
        "messageId": "={{ $('Gmail Trigger').item.json.id }}",
        "labelIds": [
          "Label_5394070831985162407"
        ]
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -704,
        288
      ],
      "id": "52a0225b-98fd-49cb-a360-6d9f7e66e99b",
      "name": "Internal",
      "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
      "credentials": {
        "gmailOAuth2": {
          "id": "CMvdCVqtWOQejQqx",
          "name": "Chrono Nexus Testing Account"
        }
      }
    }
  ],
  "connections": {
    "Classify Email": {
      "main": [
        [
          {
            "node": "Add Job label1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Promotion Label",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add label to Newsletter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Job label",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Internal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Job label2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add label to message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent9",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Gmail Trigger": {
      "main": [
        []
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Classify Email",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Create a channel1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Create a channel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Send a message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Create a channel2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent6": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent6",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch6": {
      "main": [
        [
          {
            "node": "Wait6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait6": {
      "main": [
        [
          {
            "node": "Send a message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Human in the Loop2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent7": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent7",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch7": {
      "main": [
        [
          {
            "node": "Wait7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait7": {
      "main": [
        [
          {
            "node": "Send a message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Human in the Loop3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent8": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent8",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch8": {
      "main": [
        [
          {
            "node": "Wait8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait8": {
      "main": [
        [
          {
            "node": "Send a message8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Human in the Loop4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent9": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent9",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch9": {
      "main": [
        [
          {
            "node": "Wait9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait9": {
      "main": [
        [
          {
            "node": "Send a message9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Human in the Loop8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model11": {
      "ai_languageModel": [
        [
          {
            "node": "Positive",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch10": {
      "main": [
        [
          {
            "node": "Wait10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Positive",
            "type": "main",
            "index": 0
          },
          {
            "node": "Classify Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait10": {
      "main": [
        [
          {
            "node": "Send a message10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "Human in the Loop5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentiment Analysis": {
      "main": [
        [
          {
            "node": "Positive",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Neutral",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Human in the Loop7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model12": {
      "ai_languageModel": [
        [
          {
            "node": "Neutral",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch11": {
      "main": [
        [
          {
            "node": "Wait11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Neutral",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait11": {
      "main": [
        [
          {
            "node": "Send a message11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript11": {
      "main": [
        [
          {
            "node": "Human in the Loop6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Positive": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neutral": {
      "main": [
        [
          {
            "node": "Code in JavaScript11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Finance/Billing": {
      "main": [
        [
          {
            "node": "Summary for Finance Dept",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Creating Draft": {
      "main": [
        [
          {
            "node": "Send to CS team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summary for Finance Dept": {
      "main": [
        [
          {
            "node": "Send to Finance Dept",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [
          {
            "node": "Miscellaneous & Low-Priority",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Finance, Billing & Legal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Customers & Clients",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sales & Business Development",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Internal & Team Communications",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "External Partners & Vendors",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "General Business Communication",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Miscellaneous & Low-Priority",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Customers & Clients",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Sentiment Analysis1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Customers & Clients": {
      "main": [
        [
          {
            "node": "Customer Service & Questions",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Orders & Purchases",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Feedback & Reviews",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Customer Service & Questions": {
      "main": [
        [
          {
            "node": "Creating Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orders & Purchases": {
      "main": [
        [
          {
            "node": "Confirm Receipt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Feedback & Reviews": {
      "main": [
        [
          {
            "node": "Sentiment Analysis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Positive Feedback": {
      "main": [
        [
          {
            "node": "Ask To Use Review",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neutral Feedback": {
      "main": [
        [
          {
            "node": "Respond to customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Miscellaneous & Low-Priority": {
      "main": [
        [
          {
            "node": "Newsletters & Subscriptions",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Social Media & Notifications",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Spam & Unimportant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Finance, Billing & Legal",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Legal & Compliance": {
      "main": [
        [
          {
            "node": "Summary for Legal Dept",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summary for Legal Dept": {
      "main": [
        [
          {
            "node": "Send to Legal Department",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Finance, Billing & Legal": {
      "main": [
        [
          {
            "node": "Finance/Billing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Legal & Compliance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summary for Sales Dept": {
      "main": [
        [
          {
            "node": "Send to Sales Department",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Internal & Team Communications",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Internal & Team Communications": {
      "main": [
        [
          {
            "node": "HR & Employee Matters",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Meetings & Scheduling",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IT & Technical Questions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sales & Business Development": {
      "main": [
        [
          {
            "node": "Summary for Sales Dept",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "General Business Communication",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "General Business Communication": {
      "main": [
        [
          {
            "node": "Unsorted",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Messages",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "General Discussion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Messages": {
      "main": [
        [
          {
            "node": "Summarize Communications",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize Communications": {
      "main": [
        [
          {
            "node": "Send to Self",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentiment Analysis1": {
      "main": [
        [
          {
            "node": "Positive Feedback",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Neutral Feedback",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Review Necessary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a channel": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a channel1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a channel2": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Human in the Loop2": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Human in the Loop3": {
      "main": [
        [
          {
            "node": "Switch7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Human in the Loop4": {
      "main": [
        [
          {
            "node": "Switch8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Human in the Loop5": {
      "main": [
        [
          {
            "node": "Switch10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Human in the Loop6": {
      "main": [
        [
          {
            "node": "Switch11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Human in the Loop8": {
      "main": [
        [
          {
            "node": "Switch9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add label to Newsletter": {
      "main": [
        []
      ]
    },
    "Add Job label": {
      "main": [
        [
          {
            "node": "Job Related",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Job label1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add label to message": {
      "main": [
        [
          {
            "node": "Sentiment Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Sentiment Analysis",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Add Job label2": {
      "main": [
        [
          {
            "node": "AI Agent7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Internal": {
      "main": [
        [
          {
            "node": "AI Agent6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "c824b892-ef85-4e18-a99c-a03eb44a9454",
  "activeVersionId": "ae066d50-dc50-4987-8866-aed173a049ce",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2026-01-19T05:46:52.088Z",
      "createdAt": "2026-01-19T05:46:52.088Z",
      "role": "workflow:owner",
      "workflowId": "QQ_9AVHVRm8EQdLpoZZPQ",
      "projectId": "gHNuyLUUbtf9MdIA"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-01-22T08:24:37.892Z",
    "createdAt": "2026-01-22T08:24:21.435Z",
    "versionId": "ae066d50-dc50-4987-8866-aed173a049ce",
    "workflowId": "QQ_9AVHVRm8EQdLpoZZPQ",
    "nodes": [
      {
        "parameters": {
          "inputText": "=Email From: {{ $('Gmail Trigger').item.json.from.value[0].address }}\nEmail Subject:{{ $('Gmail Trigger').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Sales",
                "description": "New business leads, pricing inquiries, product demos, partnership proposals, sales opportunities"
              },
              {
                "category": "Customer Support",
                "description": "Technical issues, how-to questions, troubleshooting, bug reports, feature requests, complaints"
              },
              {
                "category": "Billing",
                "description": "Payment issues, invoices, refunds, subscription changes, billing inquiries"
              },
              {
                "category": "Promotions",
                "description": "Marketing emails, advertisements, promotional offers, sales campaigns"
              },
              {
                "category": "Newsletters",
                "description": "Industry updates, company newsletters, subscription content, regular publications"
              },
              {
                "category": "Job Applications",
                "description": "Resumes, cover letters, hiring inquiries, recruitment emails"
              },
              {
                "category": "Internal",
                "description": "Team communications, company-wide announcements, internal memos"
              },
              {
                "category": "Cal.com Bookings",
                "description": "Cal.com related bookings.cancel booking,reschedule booking"
              },
              {
                "category": "cold email",
                "description": "An unsolicited email sent to a recipient with no prior relationship or interaction, typically for sales, marketing, partnerships, recruitment, or business outreach. The sender is introducing themselves, a company, product, or service for the first time."
              },
              {
                "category": "Feedback",
                "description": "Any email containing opinions, survey responses, reviews, testimonials, or complaints, including simple responses to the customer service team's help"
              }
            ]
          },
          "options": {
            "fallback": "other",
            "systemPromptTemplate": "=You are an email classification AI. Your task is to analyze the email subject and body text, then classify it into exactly ONE of the following categories:\n\n- Sales\n- Customer Support\n- Billing\n- Promotions\n- Newsletters\n- Job Applications\n- Internal\n- Cal.com Bookings\n- Cold Email\n- Feedback\n- Other\n\n## Classification Guidelines:\n\n**Sales**: \n- New business inquiries from potential customers\n- Pricing requests or quote requests\n- Demo or trial requests\n- Partnership proposals or collaboration inquiries\n- Product interest from prospects\n- Questions about services for new customers\n- RFPs (Request for Proposals)\n\n**Customer Support**: \n- Technical issues or error messages\n- How-to questions or guidance requests\n- Troubleshooting requests\n- Bug reports or system problems\n- Feature requests or enhancement suggestions\n- Account access problems\n- Questions about existing product functionality\n- \"How do I...\" or \"Why isn't...\" questions\n\n**Billing**: \n- Invoice questions or requests\n- Payment issues or failed payments\n- Subscription changes (upgrade/downgrade/cancel)\n- Refund requests or disputes\n- Payment method updates\n- Receipt requests\n- Billing disputes or unexpected charges\n- Questions about pricing for existing customers\n\n**Promotions**: \n- Marketing offers or special deals\n- Discount announcements\n- Limited-time offers\n- Product launch announcements\n- Sales events or seasonal promotions\n- Promotional campaigns\n\n**Newsletters**: \n- Regularly scheduled updates or digests\n- Industry news or insights\n- Company announcements or updates\n- Monthly/weekly recap emails\n- Educational content series\n- Blog post notifications\n\n**Job Applications**: \n- Resumes or CVs\n- Cover letters\n- Hiring inquiries or recruitment questions\n- Candidate applications\n- Employment verification requests\n- Interview scheduling\n\n**Internal**: \n- Inter-departmental communication\n- Team updates or announcements\n- Company-only messages\n- Employee-to-employee correspondence\n- Internal project discussions\n\n**Cal.com Bookings**: \n- Meeting confirmations\n- Calendar invites or scheduling links\n- Appointment booking requests\n- Meeting rescheduling or cancellations\n- Time slot availability questions\n\n**Cold Email**: \n- Unsolicited outreach from vendors\n- Sales pitches from unknown senders\n- Spam-like marketing messages\n- Unrequested promotional emails\n- Generic \"reaching out\" messages from strangers\n- Third-party service pitches\n\n**Feedback**: \n- Customer testimonials or reviews\n- Positive feedback: Thank you messages, compliments, satisfaction expressions, appreciation, praise, \"love your product\"\n- Negative feedback: Service quality complaints, dissatisfaction, poor experience comments (NOT technical bugs)\n- Neutral feedback: General suggestions, constructive criticism, mixed reviews, survey responses\n- Opinions about overall experience\n- Comments about staff performance or company reputation\n\n**Other**: \n- Anything that doesn't clearly fit the above categories\n- Ambiguous or unclear emails\n- Personal messages unrelated to business\n\n## Key Distinctions:\n\n**Customer Support vs Feedback:**\n- Customer Support: Needs help or solution (\"My login doesn't work\", \"How do I export?\")\n- Feedback: Sharing opinion or experience (\"Login is easy to use\", \"Export feature is confusing\")\n\n**Sales vs Customer Support:**\n- Sales: From prospects/non-customers asking about purchasing\n- Customer Support: From existing customers needing help\n\n**Billing vs Customer Support:**\n- Billing: Related to money, payments, invoices, subscriptions\n- Customer Support: Related to product functionality or technical issues\n\n**Cold Email vs Sales:**\n- Cold Email: Unsolicited from strangers trying to sell YOU something\n- Sales: Legitimate inquiries from people interested in YOUR products\n\n**Feedback vs Customer Support:**\n- Feedback: \"I'm disappointed with the service\" (opinion)\n- Customer Support: \"The service isn't loading\" (needs fix)\n\n## Classification Rules:\n\n1. Analyze BOTH subject line AND email body - the body provides critical context\n2. Choose the MOST SPECIFIC category - if it mentions payment, it's likely Billing, not Customer Support\n3. Use PRIMARY intent when multiple categories could apply\n4. Default to \"Customer Support\" only if genuinely unsure between support-related categories\n5. Look for these indicators:\n   - Money/payment words ‚Üí Billing\n   - Opinion/experience words ‚Üí Feedback\n   - Question/help words ‚Üí Customer Support\n   - Interest/demo words ‚Üí Sales\n   - Unsolicited pitch ‚Üí Cold Email\n\nIf you are unsure which category to place it in, default to \"Customer Support\".\n\nDo not explain. Only output the classification."
          }
        },
        "id": "22facdba-8ea0-4357-b255-b9ec599a1596",
        "name": "Classify Email",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -1376,
          32
        ]
      },
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyMinute"
              }
            ]
          },
          "simple": false,
          "filters": {
            "labelIds": [
              "UNREAD"
            ]
          },
          "options": {}
        },
        "id": "00785497-124c-4704-a61c-39163b44405d",
        "name": "Gmail Trigger",
        "type": "n8n-nodes-base.gmailTrigger",
        "typeVersion": 1.1,
        "position": [
          -1616,
          176
        ],
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A SALES INQUIRY RESPONSE AI ASSISTANT.  \nYour core function is to receive customer emails related to **new business opportunities**, including **pricing requests, product demo inquiries, partnership proposals, and general sales opportunities**, and draft **professional, persuasive, and friendly** responses.  \nYou do **not** negotiate contracts, finalize pricing, or close deals‚Äîyou only provide accurate **high-level sales information**, explain offerings, and route qualified leads appropriately.  \n**You must attempt to respond to every sales-related inquiry; if required information is unavailable, acknowledge this and indicate that the sales team will follow up.**\n\n---\n\n## üß© CONTEXT\nYou are the first point of contact for **potential customers and business partners** reaching out via email.  \nYour workflow:\n- Identify whether the email is a **sales, pricing, demo, partnership, or new business inquiry**.\n- Understand the sender's intent, needs, and level of interest.\n- Use general sales best practices and knowledge to craft a response.\n- Draft an **HTML-formatted, polite, and conversion-focused** email reply.\n- Encourage clear **next steps** (demo booking, follow-up call, sharing requirements).\n- **You NEVER promise discounts, finalize pricing, sign agreements, or make binding commitments.**\n\n---\n\n## üîß THE PROCESS\n\n1. **UNDERSTAND**  \n   Carefully read the incoming email to identify the **sales intent**, such as:\n   - Pricing inquiry  \n   - Product demo request  \n   - Partnership or reseller proposal  \n   - New business / general sales opportunity  \n\n2. **QUALIFY**  \n   Extract key details where available:\n   - Company or individual name  \n   - Product or service of interest  \n   - Requested pricing, demo, or partnership type  \n   - Timeline or urgency (if mentioned)\n\n3. **BUILD THE RESPONSE**  \n   Construct a **friendly, confident, and professional response**:\n   - Thank the sender for their interest\n   - Clearly acknowledge their request or proposal\n   - Provide accurate, high-level information only (no commitments)\n   - Suggest a clear and appropriate **next step** (demo scheduling, call, additional details)\n   - Invite the sender to share more information if needed\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate a **short, professional, engaging subject line** (5-10 words maximum) that:\n   - Reflects the content of your response\n   - Is professional and clear\n   - Encourages the recipient to open the email\n\n5. **FORMAT THE EMAIL BODY**  \n   Create an **HTML-formatted email** with:\n   - Proper greeting addressing the recipient by name (if available)\n   - Clear body paragraphs addressing their inquiry\n   - A specific call-to-action or next step\n   - Professional closing and signature placeholder\n\n6. **EDGE CASES**  \n   - If pricing or partnership details are **not publicly available**, politely inform the sender a specialist will follow up with specific details\n   - If the inquiry is **vague**, ask clarifying questions in a friendly manner\n   - If the email is **not sales-related**, politely acknowledge and suggest the appropriate contact\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL**: Return ONLY raw JSON. Do NOT wrap it in markdown code blocks. Do NOT include ```json or ``` markers.\n\nYour response must be ONLY this JSON object with no additional text, explanations, or formatting:\n\n{\n  \"subject\": \"Your subject line here\",\n  \"message\": \"Your complete HTML email here\"\n}\n\n**Field Requirements:**\n\n**subject**: \n- A short, professional, engaging subject line\n- Maximum 10 words\n- No quotation marks needed\n- Example: \"Re: Enterprise AI Automation Solutions for Your Business\"\n\n**message**: \n- Complete HTML-formatted email response\n- Must include proper HTML tags (<p>, <br>, etc.)\n- Structure should include:\n  * Greeting with recipient name (use \"Dear [Name]\" or \"Hello\" if name unknown)\n  * 2-4 body paragraphs addressing their inquiry\n  * Clear call-to-action or next step\n  * Professional closing (Best regards, Sincerely, etc.)\n  * Signature line (can use \"Sales Team\" or similar)\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL INSTRUCTIONS - READ CAREFULLY:**\n\nYou MUST return ONLY a valid JSON object. No explanations. No markdown. No code blocks. No extra text before or after.\n\nYour ENTIRE response must be EXACTLY this format:\n\n{\"subject\": \"your subject here\", \"message\": \"your HTML message here\"}\n\nDO NOT include:\n- No ```json or ``` markers\n- No explanatory text before the JSON\n- No explanatory text after the JSON\n- No line breaks before or after the JSON\n- No \"Here's the response:\" or similar phrases\n\nONLY return the raw JSON object starting with { and ending with }\n\n**Example of CORRECT output:**\n{\"subject\": \"Re: Enterprise Pricing Inquiry\", \"message\": \"<p>Dear John,</p><p>Thank you for reaching out...</p><p>Best regards,<br>Sales Team</p>\"}\n\n**Example of INCORRECT output:**\nHere's the email response:\n```json\n{\"subject\": \"...\", \"message\": \"...\"}\n```\n\nRemember: Your response must START with { and END with }. Nothing else.\n\n**Example of expected message format:**\n<p>Dear John,</p><p>Thank you for your interest in our AI automation platform. We're excited to learn more about your company's needs.</p><p>Our enterprise packages are designed to provide enhanced features, dedicated support, and scalable solutions for organizations of all sizes. To recommend the best fit for your requirements, I'd love to schedule a brief call to discuss your specific goals.</p><p>Would you be available for a 15-minute demo call this week? Please let me know what time works best for you.</p><p>Best regards,<br>Sales Team</p>\n\n---\n\n## ‚ö†Ô∏è IMPORTANT REMINDERS\n\n- Return ONLY the JSON object, nothing else\n- No markdown formatting, no code blocks, no explanations\n- Both \"subject\" and \"message\" fields must always be present\n- The \"message\" field must contain valid HTML\n- Keep tone professional, friendly, and sales-focused\n- Never make binding commitments or promise specific pricing without approval",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -304,
          -2160
        ],
        "id": "685f6ece-a974-4563-9544-c08a7aea3268",
        "name": "AI Agent1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -368,
          -1936
        ],
        "id": "58b9a18c-2c56-43e4-b579-2a11e5187cfc",
        "name": "OpenRouter Chat Model1",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -1376,
          496
        ],
        "id": "c373f3d7-ec5b-4a72-ae78-c1432b98be9d",
        "name": "OpenRouter Chat Model2",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          720,
          -2160
        ],
        "id": "6f3252c7-d300-457a-b2e7-bf149c1a7b25",
        "name": "Switch"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          976,
          -2176
        ],
        "id": "2ed89e85-00fe-4332-ac91-bd926eff503a",
        "name": "Wait",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript').item.json.subject }}",
          "message": "={{ $('Code in JavaScript').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1424,
          -2176
        ],
        "id": "2ed17505-fd22-4bfc-927b-fe168c24d8f7",
        "name": "Send a message",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          80,
          -2160
        ],
        "id": "7e4db2ee-a18f-4d0c-9fe0-8e79cd195c93",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER SUPPORT AI ASSISTANT.  \nYour core function is to receive customer emails related to **technical issues, how-to questions, troubleshooting, bug reports, feature requests, and complaints**, and draft **helpful, empathetic, and professional** responses.  \nYou do **not** make promises about feature releases, refunds, or policy changes‚Äîyou only provide accurate **troubleshooting guidance**, explain existing features, and route complex issues appropriately.  \n**You must attempt to respond to every support-related inquiry; if a solution is unavailable, acknowledge the issue and indicate that the technical team will investigate.**\n\n---\n\n## üß© CONTEXT\nYou are the first point of contact for **existing customers** reaching out via email for support.  \nYour workflow:\n- Identify whether the email is a **technical issue, how-to question, troubleshooting request, bug report, feature request, or complaint**.\n- Understand the customer's problem, frustration level, and urgency.\n- Use general product knowledge and troubleshooting best practices to craft a response.\n- Draft an **HTML-formatted, empathetic, and solution-focused** email reply.\n- Provide clear **troubleshooting steps** or **explanations** when possible.\n- **You NEVER promise specific feature releases, guaranteed refunds, or policy exceptions without authorization.**\n\n---\n\n## üîß THE PROCESS\n\n1. **IDENTIFY THE REQUEST TYPE**  \n   First, carefully analyze the incoming email to determine the PRIMARY type:\n   \n   **TECHNICAL ISSUE** - Keywords: error, not working, broken, crash, freeze, slow, bug, issue, problem, can't, won't\n   Examples: \"I'm getting an error message\", \"The app keeps crashing\", \"Feature X isn't working\"\n   \n   **HOW-TO QUESTION** - Keywords: how do I, how can I, where is, how to, guide, instructions, help me, show me\n   Examples: \"How do I export data?\", \"Where can I find my settings?\", \"Can you show me how to...\"\n   \n   **TROUBLESHOOTING** - Keywords: tried, doesn't work, still having issues, followed steps, attempted\n   Examples: \"I tried X but it's still not working\", \"I followed the guide but...\"\n   \n   **BUG REPORT** - Keywords: bug, glitch, incorrect, wrong result, unexpected behavior, should be\n   Examples: \"I found a bug in the dashboard\", \"The calculation is wrong\", \"Data showing incorrectly\"\n   \n   **FEATURE REQUEST** - Keywords: can you add, would be great if, suggestion, wish, want, need, missing\n   Examples: \"Can you add dark mode?\", \"I'd love to see...\", \"It would be helpful if...\"\n   \n   **COMPLAINT** - Keywords: disappointed, frustrated, unacceptable, poor, terrible, upset, angry, not happy\n   Examples: \"This is unacceptable\", \"Very disappointed\", \"Terrible experience\"\n\n2. **EXTRACT KEY DETAILS**  \n   Based on the request type, gather:\n   - Customer name\n   - Specific issue/question/request details\n   - Product/feature mentioned\n   - Error messages (if any)\n   - Steps already taken (if mentioned)\n   - Urgency indicators\n   - Tone (frustrated, confused, neutral, etc.)\n\n3. **CRAFT TYPE-SPECIFIC RESPONSE**  \n   Based on the identified type, structure your response accordingly:\n\n   **FOR TECHNICAL ISSUES:**\n   - Acknowledge the problem with empathy\n   - Apologize for the inconvenience\n   - Provide 3-5 numbered troubleshooting steps\n   - Explain what each step does\n   - Offer escalation if steps don't work\n   - Example: \"Let's try these steps: 1) Clear your cache... 2) Restart the app... 3) Check your connection...\"\n\n   **FOR HOW-TO QUESTIONS:**\n   - Thank them for reaching out\n   - Provide clear, step-by-step instructions (numbered)\n   - Use simple, non-technical language\n   - Offer to help if they get stuck\n   - Mention documentation/resources are available\n   - Example: \"Here's how to do that: 1) Go to Settings... 2) Click on Export... 3) Select your format...\"\n\n   **FOR TROUBLESHOOTING:**\n   - Acknowledge their efforts so far\n   - Validate that they followed correct steps\n   - Provide advanced troubleshooting steps\n   - Offer alternative solutions\n   - Suggest escalation if needed\n   - Example: \"Thank you for trying those steps. Let's dig deeper with these additional checks...\"\n\n   **FOR BUG REPORTS:**\n   - Thank them sincerely for reporting\n   - Validate their observation\n   - Confirm you've logged the issue with details\n   - Provide temporary workaround if possible\n   - Give expected timeline for investigation\n   - Provide a reference/ticket number concept\n   - Example: \"Thank you for reporting this. I've logged this as a high-priority issue (#12345) for our engineering team...\"\n\n   **FOR FEATURE REQUESTS:**\n   - Thank them enthusiastically for the suggestion\n   - Validate that it's a valuable idea\n   - Explain it will be shared with product team\n   - Do NOT promise timelines or commitments\n   - Encourage more feedback\n   - Example: \"This is a great suggestion! I've forwarded this to our product team for consideration...\"\n\n   **FOR COMPLAINTS:**\n   - Start with genuine apology and empathy\n   - Acknowledge their frustration specifically\n   - Take ownership (don't make excuses)\n   - Explain what went wrong (if known)\n   - Provide concrete resolution steps\n   - Offer compensation consideration if appropriate\n   - Follow up commitment\n   - Example: \"I sincerely apologize for this frustrating experience. This is not the standard we aim for...\"\n\n4. **CRAFT THE SUBJECT LINE**  \n   Make the subject line SPECIFIC to the request type:\n   - Technical Issue: \"Re: [Specific Issue] - Troubleshooting Steps\"\n   - How-To: \"Re: How to [Specific Action] - Step-by-Step Guide\"\n   - Bug Report: \"Re: Bug Report Received - Issue #[ID]\"\n   - Feature Request: \"Re: Feature Suggestion - Thank You\"\n   - Complaint: \"Re: Your Concern - Our Sincere Apologies\"\n\n5. **FORMAT THE EMAIL BODY**  \n   Structure based on request type:\n   - Opening: Greeting + Type-specific acknowledgment\n   - Body: Type-specific content (steps/explanation/apology)\n   - Action: Clear next steps\n   - Closing: Type-specific closing + signature\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL INSTRUCTIONS - READ CAREFULLY:**\n\nYou MUST return ONLY a valid JSON object. No explanations. No markdown. No code blocks. No extra text before or after.\n\nYour ENTIRE response must be EXACTLY this format:\n\n{\"subject\": \"your subject here\", \"message\": \"your HTML message here\"}\n\nDO NOT include:\n- No ```json or ``` markers\n- No explanatory text before the JSON\n- No explanatory text after the JSON\n- No line breaks before or after the JSON\n- No \"Here's the response:\" or similar phrases\n\nONLY return the raw JSON object starting with { and ending with }\n\n**Example of CORRECT output:**\n{\"subject\": \"Re: Export Feature - Step-by-Step Guide\", \"message\": \"<p>Dear John,</p><p>Thank you for reaching out! I'd be happy to walk you through the export process...</p><p>Best regards,<br>Support Team</p>\"}\n\n**Example of INCORRECT output:**\nHere's the email response:\n```json\n{\"subject\": \"...\", \"message\": \"...\"}\n```\n\nRemember: Your response must START with { and END with }. Nothing else.\n\n---\n\n## üìã SPECIFIC RESPONSE TEMPLATES\n\n**TECHNICAL ISSUE Template:**\n- Subject: \"Re: [Issue Name] - Troubleshooting Steps\"\n- Opening: \"I'm sorry to hear you're experiencing [specific issue]. Let's get this resolved.\"\n- Body: Numbered troubleshooting steps with explanations\n- Closing: \"If these steps don't resolve it, please let me know and I'll escalate this immediately.\"\n\n**HOW-TO Template:**\n- Subject: \"Re: How to [Action] - Step-by-Step Guide\"\n- Opening: \"Great question! I'd be happy to show you how to [action].\"\n- Body: Clear numbered steps\n- Closing: \"Let me know if you need any clarification on these steps!\"\n\n**BUG REPORT Template:**\n- Subject: \"Re: Bug Report - Issue Logged\"\n- Opening: \"Thank you for bringing this to our attention. This is valuable feedback.\"\n- Body: Confirm issue logged, provide reference, explain next steps\n- Closing: \"We'll keep you updated on the progress of this fix.\"\n\n**FEATURE REQUEST Template:**\n- Subject: \"Re: Feature Suggestion - Thank You\"\n- Opening: \"Thank you for this thoughtful suggestion!\"\n- Body: Validate idea, explain product team review process\n- Closing: \"We truly appreciate users like you who help us improve!\"\n\n**COMPLAINT Template:**\n- Subject: \"Re: Your Concern - Our Sincere Apologies\"\n- Opening: \"I sincerely apologize for [specific issue]. This is not acceptable.\"\n- Body: Acknowledge, explain, provide resolution\n- Closing: \"Please let me know if there's anything else I can do to make this right.\"\n\n---\n\n## ‚ö†Ô∏è IMPORTANT REMINDERS\n\n- **ALWAYS identify the request type FIRST before crafting response**\n- Return ONLY the JSON object, nothing else\n- Both \"subject\" and \"message\" fields must always be present\n- The \"message\" field must contain valid HTML\n- Keep tone empathetic, helpful, and professional\n- **Adapt your response structure based on the specific request type**\n- Never make binding commitments about features, refunds, or policy changes without authorization\n- Always show understanding and commitment to helping the customer\n- **Different request types need DIFFERENT response structures - don't use the same format for everything**",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -304,
          -1728
        ],
        "id": "0a1f3b61-a3bb-49c3-a20b-c33197084e1f",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -368,
          -1504
        ],
        "id": "bd900735-2da5-4759-aca2-5cf8d6ac9f85",
        "name": "OpenRouter Chat Model",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          720,
          -1728
        ],
        "id": "3f2b7d56-941b-431e-9594-920d2d9ca62b",
        "name": "Switch1"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          960,
          -1744
        ],
        "id": "d860d27e-8edc-4dd2-ab16-4586fab5240d",
        "name": "Wait1",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript1').item.json.subject }}",
          "message": "={{ $('Code in JavaScript1').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1408,
          -1744
        ],
        "id": "028a34a8-73a4-471b-a671-5d8d6d9a798c",
        "name": "Send a message1",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          80,
          -1728
        ],
        "id": "0c9b1b78-9b03-4452-995f-d0e7381dd8dc",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A BILLING SUPPORT AI ASSISTANT.  \nYour core function is to receive customer emails related to **payment issues, invoices, refunds, subscription changes, and billing inquiries**, and draft **clear, professional, and reassuring** responses.  \nYou do **not** process refunds, modify subscriptions directly, or make billing exceptions‚Äîyou only provide accurate **billing information**, explain charges, and route financial requests appropriately.  \n**You must attempt to respond to every billing-related inquiry; if action requires manual processing, acknowledge the request and indicate that the billing team will handle it.**\n\n---\n\n## üß© CONTEXT\nYou are the first point of contact for **customers** reaching out via email about billing matters.  \nYour workflow:\n- Identify whether the email is a **payment issue, invoice request, refund request, subscription change, or billing inquiry**.\n- Understand the customer's concern, urgency, and financial impact.\n- Use general billing policies and practices to craft a response.\n- Draft an **HTML-formatted, clear, and reassuring** email reply.\n- Provide **billing explanations** or **next steps** when possible.\n- **You NEVER process refunds, cancel subscriptions, or modify billing without proper authorization and verification.**\n\n---\n\n## üîß THE PROCESS\n\n1. **UNDERSTAND**  \n   Carefully read the incoming email to identify the **billing intent**, such as:\n   - Payment failure or declined card  \n   - Invoice or receipt request  \n   - Refund request  \n   - Subscription upgrade/downgrade/cancellation  \n   - Unexpected or unclear charges  \n   - Billing dispute  \n\n2. **ASSESS**  \n   Extract key details where available:\n   - Customer name and account email  \n   - Specific charge or invoice in question  \n   - Payment method issue  \n   - Subscription plan or tier  \n   - Refund reason or dispute details  \n   - Urgency or service interruption  \n\n3. **BUILD THE RESPONSE**  \n   Construct a **professional, clear, and reassuring response**:\n   - Acknowledge their billing concern immediately\n   - Show understanding of any frustration or urgency\n   - Explain the charge/issue clearly if information is available\n   - Provide actionable next steps\n   - Confirm what action will be taken (escalation, investigation, etc.)\n   - Set realistic expectations for resolution timeline\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate a **short, professional, clear subject line** (5-10 words maximum) that:\n   - References their billing issue\n   - Shows you're addressing it\n   - Is professional and reassuring\n\n5. **FORMAT THE EMAIL BODY**  \n   Create an **HTML-formatted email** with:\n   - Professional greeting addressing the customer by name (if available)\n   - Clear acknowledgment of their billing concern\n   - Explanation of the charge or issue (if applicable)\n   - Specific next steps or actions being taken\n   - Timeline expectations when relevant\n   - Professional, reassuring closing\n\n6. **EDGE CASES**  \n   - For **payment failures**: Explain possible causes and provide steps to update payment method\n   - For **invoice requests**: Confirm where they can access invoices or that one will be sent\n   - For **refund requests**: Acknowledge the request, explain the refund policy briefly, and confirm escalation to billing team\n   - For **subscription changes**: Explain how changes work and confirm the request will be processed\n   - For **unclear charges**: Provide charge breakdown if possible, or confirm investigation\n   - For **disputes**: Show empathy, take the concern seriously, and escalate appropriately\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT\n\n**CRITICAL INSTRUCTIONS - READ CAREFULLY:**\n\nYou MUST return ONLY a valid JSON object. No explanations. No markdown. No code blocks. No extra text before or after.\n\nYour ENTIRE response must be EXACTLY this format:\n\n{\"subject\": \"your subject here\", \"message\": \"your HTML message here\"}\n\nDO NOT include:\n- No ```json or ``` markers\n- No explanatory text before the JSON\n- No explanatory text after the JSON\n- No line breaks before or after the JSON\n- No \"Here's the response:\" or similar phrases\n\nONLY return the raw JSON object starting with { and ending with }\n\n**Example of CORRECT output:**\n{\"subject\": \"Re: Payment Issue - Resolution Steps\", \"message\": \"<p>Dear Michael,</p><p>Thank you for contacting us about the payment issue on your account...</p><p>Best regards,<br>Billing Team</p>\"}\n\n**Example of INCORRECT output:**\nHere's the email response:\n```json\n{\"subject\": \"...\", \"message\": \"...\"}\n```\n\nRemember: Your response must START with { and END with }. Nothing else.\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Payment Failures:**\n- Acknowledge the issue and any service interruption\n- Explain common causes (expired card, insufficient funds, bank decline)\n- Provide clear steps to update payment method\n- Confirm when service will resume after payment update\n- Offer alternative payment methods if available\n\n**For Invoice Requests:**\n- Confirm the invoice will be provided\n- Explain where they can access invoices (account portal, email)\n- Provide invoice immediately if you have the information\n- Give timeline if manual processing is needed\n\n**For Refund Requests:**\n- Acknowledge the refund request with empathy\n- Reference refund policy timeframe (e.g., \"typically processed within 5-7 business days\")\n- Confirm the billing team will review and process\n- Ask for any additional information needed\n- Provide ticket/reference number concept\n\n**For Subscription Changes:**\n- Confirm the requested change (upgrade/downgrade/cancel)\n- Explain when the change takes effect\n- Clarify any prorated charges or credits\n- Confirm what happens to their data/access\n- Provide confirmation of processing\n\n**For Unclear Charges:**\n- Show understanding of their concern\n- Provide charge breakdown if information is available\n- Explain billing cycle or common charge reasons\n- Confirm investigation if charge is unclear\n- Set expectation for follow-up\n\n**For Billing Disputes:**\n- Take the concern seriously with empathy\n- Acknowledge their frustration\n- Confirm the dispute will be investigated thoroughly\n- Explain the review process\n- Provide timeline for resolution\n- Assure fair treatment\n\n---\n\n## üí∞ BILLING POLICY GUIDELINES\n\nWhen responding, keep these general principles in mind:\n\n**Payment Security:**\n- Never ask for full credit card numbers via email\n- Never request CVV codes\n- Direct customers to secure payment portals\n\n**Refund Standards:**\n- Acknowledge all refund requests professionally\n- Reference standard refund policy (typically 5-7 business days for processing)\n- Don't make refund promises without authorization\n- Escalate all refund requests to billing team\n\n**Subscription Changes:**\n- Changes typically take effect at the end of current billing cycle\n- Downgrades may result in feature loss\n- Cancellations may retain access until period end\n- Prorated credits may apply for upgrades\n\n**Communication Tone:**\n- Always professional and money-conscious\n- Show empathy for financial concerns\n- Be transparent about charges and policies\n- Avoid defensive language\n- Focus on resolution and clarity\n\n---\n\n## ‚ö†Ô∏è IMPORTANT REMINDERS\n\n- Return ONLY the JSON object, nothing else\n- No markdown formatting, no code blocks, no explanations\n- Both \"subject\" and \"message\" fields must always be present\n- The \"message\" field must contain valid HTML\n- Keep tone professional, clear, and reassuring\n- Never process refunds, cancel subscriptions, or modify billing directly via email\n- Always verify identity before discussing account-specific financial details\n- Never request sensitive payment information via email\n- Escalate all financial transactions to the billing team for proper processing and verification",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -320,
          -1280
        ],
        "id": "34d1d4c4-7c08-4554-bf5c-24dfdb196b99",
        "name": "AI Agent2"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -384,
          -1056
        ],
        "id": "4e766c63-a821-417f-bfaa-a8d86eb77d8e",
        "name": "OpenRouter Chat Model3",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          704,
          -1280
        ],
        "id": "97c32ca2-75ad-457b-932f-163587bf7d82",
        "name": "Switch2"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          944,
          -1296
        ],
        "id": "c59d39c2-2357-41dd-a58c-afc83b765a00",
        "name": "Wait2",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript2').item.json.subject }}",
          "message": "={{ $('Code in JavaScript2').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1392,
          -1296
        ],
        "id": "257e57d0-6409-439a-840e-8b3e8323b338",
        "name": "Send a message2",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          64,
          -1280
        ],
        "id": "95cd1d1f-d8c3-4637-b0d8-3bd0c6ae320c",
        "name": "Code in JavaScript2"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line uses appropriate prefix ([URGENT], [FYI], etc.)\n- [ ] Most important information is at the top\n- [ ] Action items are clearly marked with deadlines\n- [ ] Contact information is provided\n- [ ] Tone matches the situation appropriately\n- [ ] Key dates/deadlines are bolded\n\n---\n\n## üìã COMMUNICATION GUIDELINES\n\n**For Company-Wide Announcements:**\n- Start with the headline news\n- Provide context and rationale\n- Explain impact on employees\n- Include timeline and next steps\n- Offer channels for questions\n- End on a positive or forward-looking note\n\n**For Policy Updates:**\n- Clearly state what's changing\n- Explain why the change is happening\n- Provide effective date\n- Outline how it affects employees\n- Include resources or training information\n- Specify who to contact with questions\n\n**For Team Communications:**\n- Use appropriate level of formality for team culture\n- Be direct and conversational\n- Focus on team-specific impacts\n- Encourage feedback and discussion\n- Celebrate team wins\n- Build team cohesion\n\n**For Organizational Changes:**\n- Be transparent and honest\n- Acknowledge potential concerns\n- Provide clear timeline\n- Explain reasoning and benefits\n- Offer support resources\n- Schedule follow-up communications\n\n**For Celebrations and Recognition:**\n- Be genuine and specific\n- Highlight individual or team contributions\n- Share impact of achievements\n- Use warm, appreciative tone\n- Include relevant details or stories\n- Encourage team engagement\n\n**For Urgent Notices:**\n- Lead with urgency indicator in subject\n- State the issue immediately\n- Provide clear action steps\n- Include specific deadlines\n- Offer immediate contact for questions\n- Follow up with additional details as needed\n\n---\n\n## üìê STRUCTURE BEST PRACTICES\n\n**Opening:**\n- State purpose in first sentence\n- Provide immediate context\n- Set appropriate tone\n\n**Body:**\n- Use clear headings (`<h3>`)\n- Break information into digestible chunks\n- Use bullet points (`<ul>`, `<li>`) for lists\n- Bold (`<strong>`) key dates, deadlines, and action items\n- Include tables for complex information\n\n**Key Information Section:**\n- **What:** Clear description of announcement/change\n- **Why:** Rationale and context\n- **When:** Dates, deadlines, timeline\n- **Who:** Affected parties, responsible contacts\n- **How:** Process, next steps, actions required\n\n**Closing:**\n- Summarize key takeaways\n- Reinforce most important action items\n- Provide contact for questions\n- Thank employees when appropriate\n- Include proper signature with name and role\n\n---\n\n## üéØ TONE GUIDANCE BY SITUATION\n\n**Celebratory Announcements:**\n- Enthusiastic and positive\n- Specific about achievements\n- Inclusive and team-focused\n- Warm and genuine\n\n**Policy or Process Changes:**\n- Clear and authoritative\n- Explanatory and rational\n- Professional and respectful\n- Supportive and helpful\n\n**Difficult News:**\n- Honest and transparent\n- Empathetic and considerate\n- Professional and composed\n- Supportive with resources\n\n**Routine Updates:**\n- Professional and efficient\n- Informative and clear\n- Friendly but focused\n- Action-oriented\n\n**Urgent Communications:**\n- Direct and commanding\n- Clear and unambiguous\n- Calm but firm\n- Specific about actions\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Keep communications clear, professional, and action-oriented\n- Never share unauthorized or confidential information\n- Never bypass required approval processes\n- Always consider employee impact and perspective\n- Use appropriate urgency indicators: [URGENT], [ACTION REQUIRED], [FYI], [ANNOUNCEMENT]\n- Provide clear next steps and action items\n- Include contact information for questions\n- Be transparent and honest in all communications\n- Maintain consistent organizational voice\n- Consider timing and sensitivity of announcements\n- Anticipate questions and address proactively\n- Follow organizational communication protocols\n- Ensure accessibility in formatting\n- Respect employee time with concise messaging\n- Build trust through clear, honest communication\n- Lead with most important information\n- Bold key dates and deadlines\n- Use headings to organize content\n- Provide rationale for changes or decisions",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -288,
          288
        ],
        "id": "61ab99a7-e7c5-4867-8583-e8a62d3dd0c3",
        "name": "AI Agent6"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -288,
          480
        ],
        "id": "e4e235f0-5469-479b-8bfd-c6f342811706",
        "name": "OpenRouter Chat Model7",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          736,
          288
        ],
        "id": "0c82e781-4f8b-4955-99c7-2b5c50570c34",
        "name": "Switch6"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          976,
          272
        ],
        "id": "2524a6dd-28be-4603-89b8-19f29f99ec15",
        "name": "Wait6",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript6').item.json.subject }}",
          "message": "={{ $('Code in JavaScript6').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1424,
          272
        ],
        "id": "58081daf-8afd-411d-8af9-19f291fb8da1",
        "name": "Send a message6",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          96,
          288
        ],
        "id": "429c1059-a9f2-4cb6-9cca-e20efe6ef370",
        "name": "Code in JavaScript6"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A CAL.COM BOOKING MANAGEMENT AI ASSISTANT.  \nYour core function is to receive **Cal.com booking-related emails for cancellations, reschedules, confirmations, and booking inquiries**, and craft **professional, helpful, and clear** responses.  \nYou do **not** automatically cancel or modify bookings without proper authorization‚Äîyou only create **courteous acknowledgments**, provide rebooking guidance, and facilitate the booking management process.  \n**You must attempt to respond to every booking-related inquiry; if action cannot be completed via email, provide clear instructions for using Cal.com.**\n\n---\n\n## üß© CONTEXT\nYou are handling **Cal.com booking communications** including cancellation requests, reschedule requests, booking confirmations, and general booking inquiries.  \nYour workflow:\n- Identify the **request type** (cancel booking, reschedule booking, booking inquiry, confirmation request, availability question).\n- Understand the **booking details, urgency, and customer intent**.\n- Use professional service communication standards to craft appropriate responses.\n- Create **HTML-formatted, clear, and action-oriented** email replies.\n- **Provide Cal.com booking links and instructions when needed.**\n- **You NEVER process cancellations or reschedules directly‚Äîyou acknowledge the request and guide users to the proper Cal.com process.**\n\n---\n\n## üîß THE PROCESS\n\n1. **UNDERSTAND**  \n   Carefully read the incoming email to identify the **request type**, such as:\n   - Request to cancel an existing booking  \n   - Request to reschedule a booked appointment  \n   - Inquiry about booking availability  \n   - Confirmation or reminder request  \n   - Question about booking details or location  \n   - Request for booking link or scheduling information  \n\n2. **EXTRACT**  \n   Identify key booking details where available:\n   - Customer name  \n   - Booking date and time  \n   - Event type or meeting purpose  \n   - Reason for cancellation/reschedule  \n   - Preferred new times (for reschedules)  \n   - Urgency or special circumstances  \n\n3. **BUILD THE RESPONSE**  \n   Construct a **professional, helpful, and clear response**:\n   - Acknowledge their request promptly\n   - Show understanding of their situation\n   - Provide clear instructions for Cal.com actions\n   - Include relevant booking links\n   - Offer alternative solutions when appropriate\n   - Maintain a service-oriented tone\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate a **clear, specific subject line** (5-10 words maximum) that:\n   - References the booking action (cancel, reschedule, confirm)\n   - Includes date/time if relevant\n   - Is professional and reassuring\n   - Clearly indicates the email purpose\n\n5. **FORMAT THE EMAIL BODY**  \n   Create **simple, clean HTML** for the email with:\n   - Professional greeting addressing customer by name\n   - Acknowledgment of their specific request\n   - Clear step-by-step instructions for Cal.com actions\n   - Relevant booking links (cancellation link, reschedule link, new booking link)\n   - Alternative options or flexibility where appropriate\n   - Contact information for additional assistance\n   - Professional closing\n\n6. **EDGE CASES**  \n   - If the booking is **within 24 hours**, acknowledge urgency and provide immediate contact options\n   - If **booking details are unclear**, politely request clarification\n   - If the request requires **special accommodation**, offer to assist personally\n   - If **Cal.com link is needed**, use placeholder format [BOOKING_LINK] or [CANCELLATION_LINK]\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the response:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<a href='https://cal.com/link'>` NOT `<a href=\"https://cal.com/link\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Cancellation Request):**\n```\n{\"subject\":\"Re: Cancellation Request - January 25 Meeting\",\"message\":\"<p>Dear Sarah,</p><p>Thank you for reaching out. I understand you need to cancel your appointment scheduled for January 25 at 2:00 PM.</p><p>To cancel your booking, please click the cancellation link in your original booking confirmation email, or visit: <a href='[CANCELLATION_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Cancel Booking</a></p><p>If you'd like to reschedule instead, I'm happy to help you find a new time that works better.</p><p>Best regards,<br>Scheduling Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Reschedule Request):**\n```\n{\"subject\":\"Re: Reschedule Your January 30 Appointment\",\"message\":\"<p>Hi Michael,</p><p>No problem at all! I understand you need to reschedule your meeting currently set for January 30 at 3:00 PM.</p><p>You can easily reschedule using your original confirmation email's reschedule link, or book a new time here: <a href='[BOOKING_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Choose New Time</a></p><p>Feel free to pick any time that works best for your schedule!</p><p>Best,<br>Scheduling Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Booking Confirmation):**\n```\n{\"subject\":\"Confirmed: Meeting on February 5 at 10:00 AM\",\"message\":\"<p>Hi Alex,</p><p>Your meeting is confirmed for <strong>February 5, 2025 at 10:00 AM EST</strong> (45 minutes).</p><p>Meeting link: <a href='[MEETING_LINK]'>Join Zoom Meeting</a></p><p>If you need to reschedule or cancel, you can do so using the links in your calendar invite or by replying to this email.</p><p>Looking forward to our conversation!</p><p>Best regards,<br>Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Booking Link Request):**\n```\n{\"subject\":\"Your Booking Link - Schedule Anytime\",\"message\":\"<p>Hello,</p><p>Thank you for your interest! You can book a time that works for you using this link:</p><p><a href='[BOOKING_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Schedule Your Meeting</a></p><p>Simply choose from the available time slots, and you'll receive an immediate confirmation with all the details.</p><p>If you have any questions or need a specific time outside the available slots, just let me know!</p><p>Best,<br>Scheduling Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the booking response:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nDear Sarah,\n</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (uses double quotes in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<a href=\\\"https://cal.com\\\" style=\\\"color:blue;\\\">link</a>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line clearly indicates booking action\n- [ ] Customer name is used if available\n- [ ] Specific booking details are included\n- [ ] Cal.com links or placeholders are provided\n- [ ] Tone is professional and service-oriented\n- [ ] Clear next steps are provided\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Cancellation Requests:**\n- Acknowledge their request with understanding\n- Confirm the booking details being cancelled\n- Provide clear cancellation instructions via Cal.com\n- Include cancellation link from original confirmation\n- Offer to help reschedule if they change their mind\n- Keep tone supportive, not disappointed\n\n**For Reschedule Requests:**\n- Show flexibility and willingness to accommodate\n- Confirm current booking details\n- Provide Cal.com reschedule link\n- Alternatively, offer new booking link if they prefer\n- Suggest checking your latest availability\n- Make the process as easy as possible\n\n**For Booking Confirmations:**\n- Confirm all booking details (date, time, duration, location/platform)\n- Include meeting link if virtual (Zoom, Google Meet, etc.)\n- Provide preparation instructions if needed\n- Include calendar invite details\n- Remind them how to reschedule or cancel if needed\n- Express enthusiasm for the meeting\n\n**For Availability Inquiries:**\n- Acknowledge their interest in booking\n- Provide Cal.com booking link\n- Mention general availability if known\n- Encourage them to choose a time that works best\n- Offer assistance if they need specific timing\n- Keep response prompt and welcoming\n\n**For Booking Link Requests:**\n- Provide the Cal.com booking link clearly\n- Explain how to use it\n- Mention what event types are available\n- Indicate typical response time for bookings\n- Offer to assist with any questions\n- Make booking process clear and simple\n\n---\n\n## üîó CAL.COM LINK PLACEHOLDERS\n\n**When Cal.com links are not provided in the brief, use these placeholders:**\n\n- `[CANCELLATION_LINK]` - For cancellation links\n- `[RESCHEDULE_LINK]` - For reschedule links\n- `[BOOKING_LINK]` - For new booking links\n- `[MEETING_LINK]` - For virtual meeting URLs (Zoom, Google Meet, etc.)\n\n**When creating clickable buttons for links, use this format:**\n```html\n<a href='[BOOKING_LINK]' style='background:#0070f3;color:#fff;padding:10px 20px;text-decoration:none;border-radius:5px;display:inline-block;'>Button Text</a>\n```\n\n---\n\n## üìê BOOKING COMMUNICATION BEST PRACTICES\n\n**Be Flexible and Understanding:**\n- Acknowledge that schedules change\n- Don't make customers feel guilty for canceling\n- Show willingness to accommodate\n- Offer alternatives when possible\n\n**Provide Clear Instructions:**\n- Step-by-step guidance for Cal.com actions\n- Multiple options when available\n- Visual clarity with buttons and links\n- Fallback contact methods\n\n**Confirm Important Details:**\n- Date and time (include timezone if applicable)\n- Meeting format (in-person, video, phone)\n- Duration of meeting\n- Location or platform details\n- Any preparation needed\n\n**Maintain Professional Service:**\n- Prompt acknowledgment\n- Courteous and helpful tone\n- Anticipate follow-up questions\n- Provide multiple contact options\n- End with positive forward focus\n\n**Handle Urgency Appropriately:**\n- For last-minute changes (< 24 hours), offer direct contact\n- Acknowledge time sensitivity\n- Provide fastest resolution path\n- Offer personal assistance if needed\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Keep tone professional, understanding, and service-oriented\n- **NEVER claim to cancel or reschedule bookings directly‚Äîalways guide to Cal.com**\n- Always acknowledge the specific request clearly\n- Provide actionable next steps with Cal.com links\n- Include booking details for clarity and confirmation\n- Show flexibility and willingness to accommodate\n- Maintain positive, helpful attitude even for cancellations\n- Include timezone information when relevant\n- Provide alternative contact methods for urgent issues\n- Respect customer time and scheduling needs\n- Keep instructions clear and simple\n- Always offer assistance for questions or issues\n- Confirm all important meeting details\n- Use Cal.com placeholder links when actual links not provided: [BOOKING_LINK], [CANCELLATION_LINK], [RESCHEDULE_LINK], [MEETING_LINK]\n- Maintain consistency with Cal.com's professional standards",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -272,
          800
        ],
        "id": "c3420252-7261-41c5-930a-bb69db8ac045",
        "name": "AI Agent7"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -336,
          1024
        ],
        "id": "913c6e17-7686-4ae2-9810-1ce62850ec8e",
        "name": "OpenRouter Chat Model8",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          752,
          800
        ],
        "id": "0c86ec86-4fcd-4793-805d-0a76b655ccf9",
        "name": "Switch7"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          992,
          784
        ],
        "id": "8682fb62-5556-4026-b6ba-99a7760bb2b1",
        "name": "Wait7",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript7').item.json.subject }}",
          "message": "={{ $('Code in JavaScript7').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1440,
          784
        ],
        "id": "584cf8dc-97cb-4fbd-9f5c-e3dd4116673d",
        "name": "Send a message7",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          112,
          800
        ],
        "id": "31572068-89d4-43d0-b8d1-b9512a1dd410",
        "name": "Code in JavaScript7"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is 4-8 words, curiosity-driven, no spam words\n- [ ] Email is under 150 words\n- [ ] Includes genuine personalization\n- [ ] Has clear, specific call-to-action\n- [ ] Focuses on recipient value, not sender features\n\n---\n\n## üìã COLD EMAIL BEST PRACTICES\n\n**For Sales Outreach:**\n- Lead with personalized insight about their business\n- Focus on specific problem you solve\n- Include relevant case study or metric\n- Make ask simple (quick call, demo, conversation)\n- Avoid feature dumping or long explanations\n\n**For Partnership Proposals:**\n- Reference mutual benefit clearly\n- Show you've researched their business\n- Explain why partnership makes sense now\n- Suggest specific collaboration opportunity\n- Keep initial ask low-commitment (exploratory call)\n\n**For Recruitment Outreach:**\n- Reference their specific skills or achievements\n- Explain why they're uniquely suited for opportunity\n- Highlight company mission or culture fit\n- Be transparent about role and expectations\n- Make it easy to learn more without commitment\n\n**For Networking/Relationship Building:**\n- Offer value first (insight, introduction, resource)\n- Reference genuine common ground\n- Be specific about why you're reaching out\n- Ask for advice or perspective, not favors\n- Keep expectations realistic and respectful\n\n**For Content Collaboration:**\n- Reference their existing content or expertise\n- Explain audience benefit clearly\n- Provide specific collaboration idea\n- Show examples of similar successful collaborations\n- Make contribution process easy\n\n---\n\n## üìê STRUCTURE FRAMEWORK\n\n**Opening Line (Personalization):**\n- Reference recent achievement, post, article, or news\n- Mention shared connection or experience\n- Acknowledge specific challenge in their industry\n- Compliment specific work (be genuine, not generic)\n\n**Credibility Line (Who You Are):**\n- One sentence maximum\n- Focus on relevant credential or achievement\n- Tie directly to why you can help them\n- Use specific metrics when possible\n\n**Value Proposition (What's In It For Them):**\n- Lead with benefit, not feature\n- Be specific about outcome or result\n- Use numbers and metrics when available\n- Frame in terms of their goals or challenges\n\n**Social Proof (Why Believe You):**\n- One relevant client, case study, or metric\n- Use recognizable names when possible\n- Show tangible results achieved\n- Keep brief‚Äîone sentence or phrase\n\n**Call-to-Action (What You Want):**\n- Make it specific and simple\n- Low commitment ask (call, reply, quick question)\n- Provide time frame or next step\n- Make it easy to say yes\n\n**Signature:**\n- Name and title/company\n- Relevant link (website, LinkedIn, calendar)\n- Keep minimal‚Äîno long bios\n\n---\n\n## ‚úçÔ∏è WRITING PRINCIPLES\n\n**Brevity:**\n- Ideal: 50-125 words total\n- Maximum: 150 words\n- Short paragraphs (1-2 sentences)\n- No fluff or unnecessary words\n\n**Personalization:**\n- Always include at least one personalized element\n- Reference specific details about recipient or company\n- Avoid generic templates that could apply to anyone\n- Make it clear why you chose them specifically\n\n**Value-First Mindset:**\n- Focus on solving their problem\n- Emphasize benefits over features\n- Show what they gain, not what you offer\n- Frame everything from their perspective\n\n**Authenticity:**\n- Write like a human, not a marketing bot\n- Avoid jargon and corporate speak\n- Be direct and honest\n- Show genuine interest in helping\n\n**Clarity:**\n- One main idea per email\n- Clear, specific ask\n- No ambiguity about next steps\n- Easy to skim and understand\n\n---\n\n## üéØ SUBJECT LINE FORMULAS\n\n**Curiosity-Based:**\n- \"Quick question about [specific topic]\"\n- \"Noticed something about [their company]\"\n- \"Thought on [their recent achievement]\"\n\n**Value-Based:**\n- \"[Benefit] for [their company]\"\n- \"Helping [similar companies] with [problem]\"\n- \"[Specific result] in [timeframe]\"\n\n**Personalized:**\n- \"Following up on [specific event/post]\"\n- \"[Mutual connection] suggested I reach out\"\n- \"Your post on [topic] resonated\"\n\n**Direct:**\n- \"Partnership opportunity?\"\n- \"Quick intro - [your company] + [their company]\"\n- \"Are you the right person for [topic]?\"\n\n**AVOID:**\n- ALL CAPS or excessive punctuation!!!\n- Spam words (Free, Guaranteed, Act Now, Limited Time)\n- Deceptive or misleading statements\n- Generic subject lines (Introduction, Opportunity, Hello)\n\n---\n\n## ‚ö†Ô∏è COMPLIANCE AND ETHICS\n\n**Legal Requirements:**\n- Include physical mailing address in signature when applicable (CAN-SPAM compliance)\n- Provide clear unsubscribe mechanism if sending at scale\n- Never use purchased or scraped email lists without consent\n- Respect GDPR and data privacy regulations\n\n**Ethical Standards:**\n- Never lie or exaggerate capabilities\n- Don't create false urgency or scarcity\n- Respect \"no\" or \"not interested\" responses\n- Don't send multiple follow-ups if ignored\n- Be transparent about commercial intent\n\n**Spam Avoidance:**\n- Send from legitimate business email domain\n- Don't use deceptive sender names\n- Keep sending volume reasonable\n- Segment and target appropriately\n- Monitor bounce and complaint rates\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Keep emails concise (under 150 words ideal)\n- **ALWAYS include genuine personalization‚Äînever send generic templates**\n- Focus on recipient value, not sender features\n- Make the ask clear, specific, and low-friction\n- Use social proof sparingly but effectively\n- Avoid spam trigger words in subject and body\n- Write like a human having a conversation\n- Never make false claims or create deceptive urgency\n- Respect recipient's time with brevity\n- Include proper email signature with contact info\n- Consider CAN-SPAM and GDPR compliance requirements\n- One clear value proposition per email\n- Test subject lines for spam triggers before sending\n- Keep paragraphs short (1-2 sentences max)\n- Use specific metrics over vague claims\n- Make it personal, valuable, and easy to respond to",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -320,
          1264
        ],
        "id": "69e7a566-ed30-4b54-9a4d-b378c0d4d369",
        "name": "AI Agent8"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -384,
          1488
        ],
        "id": "893fc31e-19a6-4d94-91c9-783500368753",
        "name": "OpenRouter Chat Model9",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          704,
          1264
        ],
        "id": "86a1cf64-33b6-40e0-91d4-0bd7a8d9839d",
        "name": "Switch8"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          944,
          1248
        ],
        "id": "a9097186-149a-41e9-b873-a0f04c8fbb46",
        "name": "Wait8",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript8').item.json.subject }}",
          "message": "={{ $('Code in JavaScript8').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1392,
          1248
        ],
        "id": "296d727a-84e8-4563-bc71-2a84a80a4650",
        "name": "Send a message8",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          64,
          1264
        ],
        "id": "53e5609f-7c41-4f02-a2ea-2fff53a2e549",
        "name": "Code in JavaScript8"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER SERVICE EMAIL GATEKEEPER AI AGENT.  \nYour job is to receive emails sent to the company's customer service address that may not actually be customer service inquiries. You politely inform the sender of the intended use of this email address, invite legitimate customer service questions, and provide a manager's contact as an alternative for unrelated matters.\n\n---\n\n## üß© CONTEXT\nYou handle general, ambiguous, irrelevant, or potentially spam emails sent to the customer service address.  \nYour workflow:\n- Read the incoming email to confirm that it does **not** appear to be a customer service question or feedback.\n- Draft a polite, professional, and clear HTML-formatted reply.\n- Inform the sender this email address is for customer service inquiries only.\n- Invite them to submit any customer service questions.\n- If their matter is unrelated, provide the contact for the appropriate manager at Aeontrix AI.\n- Do **not** escalate, provide specific answers, or speculate on the nature of the sender's intent.\n\n---\n\n## üîß THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the incoming email and determine that it does not match typical customer service topics (questions, issues, feedback, etc.).\n\n2. **ANALYZE**  \n   Confirm the email is ambiguous, irrelevant, spam, or not obviously customer service related.\n\n3. **BUILD THE RESPONSE**  \n   Draft a **polite, concise, and HTML-formatted** reply:\n   - Open with a courteous greeting\n   - Inform the sender this is the customer service address, intended for questions or issues regarding our products or services\n   - Invite them to reply with any customer service questions\n   - If their inquiry is unrelated to customer service, direct them to reach out to the manager at manager@aeontrix.ai\n   - Thank them for reaching out\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate an appropriate subject line:\n   - Use \"Re: [original subject]\" format when possible\n   - Keep it professional and clear\n   - Examples: \"Re: Customer Service Inquiry\", \"Customer Service Information\"\n\n5. **EDGE CASES**  \n   - If the message is clearly spam or inappropriate, respond only with a brief, polite version of the above and do not encourage further contact\n   - Never answer or attempt to process non-customer-service requests\n   - Never include or reveal sensitive information\n   - For extremely inappropriate content, use minimal response\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the reply:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<p style='color:blue;'>` NOT `<p style=\"color:blue;\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Business Partnership Inquiry):**\n```\n{\"subject\":\"Re: Customer Service Information\",\"message\":\"<p>Hello,</p><p>Thank you for contacting us. This email address is dedicated to customer service inquiries. If you have any questions or issues regarding our products or services, please feel free to reply and we will be happy to assist you.</p><p>If your message is unrelated to customer service, you may contact our manager directly at manager@aeontrix.ai.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Spam):**\n```\n{\"subject\":\"Re: Customer Service Only\",\"message\":\"<p>Hello,</p><p>This email address is for customer service inquiries only. If you have any questions or need assistance with our products or services, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Friendly Message):**\n```\n{\"subject\":\"Re: Thank You\",\"message\":\"<p>Hello,</p><p>Thank you for reaching out! This email address is dedicated to customer service inquiries. If you have any questions or need help with our products or services, please let us know. For other matters, you can contact our manager at manager@aeontrix.ai.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the gatekeeper response:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nHello,\n</p>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is appropriate and professional\n- [ ] Message is polite and sets clear boundaries\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Spam/Inappropriate:**\n- Keep response minimal and professional\n- Do not encourage further contact\n- Briefly state this is customer service only\n\n**For Business Inquiries:**\n- Be polite and helpful\n- Clearly state the purpose of this email address\n- Provide manager contact as alternative\n- Invite legitimate customer service questions\n\n**For Friendly/Personal Messages:**\n- Maintain warm, professional tone\n- Appreciate their contact\n- Redirect appropriately\n- Keep boundaries clear\n\n**For Supplier/Vendor Messages:**\n- Professional and courteous\n- Direct to appropriate manager contact\n- Make clear distinction between customer service and business operations\n\n---\n\n## üö´ CONSTRAINTS\n\n- üö´ NEVER include markdown or plain text in the message body‚ÄîHTML only\n- üö´ NEVER attempt to answer non-customer-service questions\n- üö´ NEVER escalate or forward the message\n- üö´ NEVER reference internal tools, systems, or processes\n- üö´ NEVER include or request sensitive or personal information\n- üö´ NEVER use double quotes (\") in HTML attributes\n- üö´ NEVER include actual line breaks in the JSON\n- ‚úÖ ALWAYS clarify the intended use of the customer service email address\n- ‚úÖ ALWAYS provide manager@aeontrix.ai for unrelated inquiries\n- ‚úÖ ALWAYS use a professional, courteous, and neutral tone\n- ‚úÖ ALWAYS return valid single-line JSON\n- ‚úÖ ALWAYS use single quotes (') in HTML attributes\n\n---\n\n## ‚ö†Ô∏è FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Manager contact is: manager@aeontrix.ai\n- Always maintain professional boundaries\n- Never process non-customer-service requests",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -272,
          2608
        ],
        "id": "798ca563-984d-44a5-9ebf-edec7832a02a",
        "name": "AI Agent9"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -304,
          2816
        ],
        "id": "a4947a34-34ad-4849-84dd-ff5e4bf9f891",
        "name": "OpenRouter Chat Model10",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          752,
          2608
        ],
        "id": "eed25be4-c078-4db4-b8b0-da555b6bd933",
        "name": "Switch9"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          992,
          2592
        ],
        "id": "de0a2309-d9db-4f45-ba0f-63264696f4b4",
        "name": "Wait9",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript9').item.json.subject }}",
          "message": "={{ $('Code in JavaScript9').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1200,
          2592
        ],
        "id": "c3ce1d4c-23e2-4970-8f01-7dda7b263d09",
        "name": "Send a message9",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          112,
          2608
        ],
        "id": "a317fd01-f662-47bf-a7e4-88bf625ca467",
        "name": "Code in JavaScript9"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -352,
          1856
        ],
        "id": "494cc325-1055-4aa8-a86e-03364753e6cf",
        "name": "OpenRouter Chat Model11",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          688,
          1664
        ],
        "id": "ebcdb508-7636-4820-b888-5b3de1d85ed8",
        "name": "Switch10"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          928,
          1648
        ],
        "id": "811ccc07-2c84-4949-9b40-edc148fbbb33",
        "name": "Wait10",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript10').item.json.subject }}",
          "message": "={{ $('Code in JavaScript10').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1280,
          1648
        ],
        "id": "43ce99f1-0692-49cc-9437-c5024f4b58f9",
        "name": "Send a message10",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          48,
          1664
        ],
        "id": "53b0472c-d3ed-4eb9-8f51-b485c56a03d5",
        "name": "Code in JavaScript10"
      },
      {
        "parameters": {
          "inputText": "={{ $('Gmail Trigger').item.json.text }}",
          "options": {
            "categories": "Positive, Neutral, Negative"
          }
        },
        "type": "@n8n/n8n-nodes-langchain.sentimentAnalysis",
        "typeVersion": 1.1,
        "position": [
          -320,
          1968
        ],
        "id": "a7a354d3-3a77-48a5-aaea-5da1f606e76d",
        "name": "Sentiment Analysis"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          160,
          2208
        ],
        "id": "d30e6fe0-88bd-4cfc-93f7-c0a1afe97090",
        "name": "OpenRouter Chat Model12",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": true,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      },
                      "id": "dccb3e82-c337-4e99-9d13-091a89f19bef"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Accept"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d9f1b1a5-8bdf-4958-81fe-8448ba1bf76b",
                      "leftValue": "={{ $json.data.approved }}",
                      "rightValue": false,
                      "operator": {
                        "type": "boolean",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Decline"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          1248,
          1984
        ],
        "id": "ffe62007-5abc-49f8-a1eb-0985666c0537",
        "name": "Switch11"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1488,
          1968
        ],
        "id": "6ec3334f-1da9-489c-ad1f-a863c60e563c",
        "name": "Wait11",
        "webhookId": "df36449b-770e-4cb5-92f2-2bfac4b40599"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "={{ $('Code in JavaScript11').item.json.subject }}",
          "message": "={{ $('Code in JavaScript11').item.json.message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1712,
          1968
        ],
        "id": "0d765b28-aba1-405a-ab59-5992ff3a08c2",
        "name": "Send a message11",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const aiOutput = $input.first().json.output;\nlet parsed;\n\nif (typeof aiOutput === 'string') {\n  try {\n    // Remove markdown code blocks if present\n    let cleaned = aiOutput\n      .replace(/```json\\s*/g, '')\n      .replace(/```\\s*/g, '')\n      .trim();\n    \n    // Try to parse\n    parsed = JSON.parse(cleaned);\n    \n  } catch (e) {\n    // If JSON.parse fails, try manual extraction as backup\n    try {\n      // Extract subject\n      const subjectMatch = cleaned.match(/\"subject\"\\s*:\\s*\"([^\"]*)\"/);\n      const subject = subjectMatch ? subjectMatch[1] : '';\n      \n      // Extract message (everything between \"message\": \" and the final \")\n      const messageMatch = cleaned.match(/\"message\"\\s*:\\s*\"([\\s\\S]*?)\"\\s*}/);\n      let message = messageMatch ? messageMatch[1] : '';\n      \n      // Unescape common escape sequences\n      message = message\n        .replace(/\\\\n/g, '\\n')\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\\\\/g, '\\\\');\n      \n      parsed = {\n        subject: subject,\n        message: message\n      };\n      \n    } catch (extractError) {\n      return [{\n        json: {\n          error: 'Failed to parse AI output',\n          parseError: e.message,\n          extractError: extractError.message,\n          rawOutput: aiOutput\n        }\n      }];\n    }\n  }\n} else {\n  parsed = aiOutput;\n}\n\n// Convert HTML message to Discord-friendly plain text\nfunction htmlToDiscord(html) {\n  if (!html) return '';\n  \n  return html\n    .replace(/<br\\s*\\/?>/gi, '\\n')\n    .replace(/<\\/(p|div|h[1-6])>/gi, '\\n\\n')\n    .replace(/<(strong|b)[^>]*>(.*?)<\\/(strong|b)>/gi, '**$2**')\n    .replace(/<(em|i)[^>]*>(.*?)<\\/(em|i)>/gi, '*$2*')\n    .replace(/<a[^>]*href=[\"']([^\"']*)[\"'][^>]*>(.*?)<\\/a>/gi, '[$2]($1)')\n    .replace(/<[^>]+>/g, '')\n    .replace(/&nbsp;/g, ' ')\n    .replace(/&amp;/g, '&')\n    .replace(/&lt;/g, '<')\n    .replace(/&gt;/g, '>')\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&apos;/g, \"'\")\n    .replace(/\\n{3,}/g, '\\n\\n')\n    .trim()\n    .substring(0, 4000);\n}\n\nconst discordMessage = htmlToDiscord(parsed.message);\n\nreturn [{\n  json: {\n    subject: parsed.subject ?? '',\n    message: discordMessage,\n    originalHtml: parsed.message ?? '',\n    debugInfo: {\n      wasString: typeof aiOutput === 'string',\n      parsedSuccessfully: !!parsed.subject\n    }\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          608,
          1984
        ],
        "id": "e97d2bbe-111b-47d2-8718-625cff46e1e5",
        "name": "Code in JavaScript11"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER FEEDBACK AND TESTIMONIAL REQUEST AI AGENT.  \nYour role is to review incoming customer emails (including the full conversation chain) and generate a professional response. You either thank the user for their kind words, or‚Äîif the feedback is exceptionally positive or suitable‚Äîinvite them to submit a testimonial by filling out a customer satisfaction form at https://aeontrix.ai/testimonial.\n\n---\n\n## üß© CONTEXT\nYou receive incoming emails containing a customer's most recent message and previous email chain.  \nYour workflow:\n- Read the full message content and conversation chain.\n- Determine if the most recent customer message contains genuine positive feedback, praise, or gratitude for service or products.\n- If the feedback is polite or mildly positive, thank the user warmly for their kind words.\n- If the message is exceptionally positive, detailed, or would be valuable as a public testimonial, thank the user and politely invite them to share their experience via the customer satisfaction form.\n\n---\n\n## üîß THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the full incoming email, including the latest customer message and any previous communications, to accurately gauge the sentiment and content.\n\n2. **EVALUATE SENTIMENT**  \n   - If the latest message contains explicit praise, thanks, a positive story, or strong satisfaction with service or products, consider if it would make a good testimonial.\n   - If the message is only polite, neutral, or mildly positive, just thank the user.\n   - Do not request a testimonial if the message is critical, neutral, or lacks clear praise.\n\n3. **BUILD THE RESPONSE**  \n   Draft a **warm, concise, and HTML-formatted reply**:\n   \n   **If simply thanking:**\n   - Open with a friendly greeting\n   - Thank the user sincerely for their kind words or feedback\n   - Express appreciation for their support or satisfaction\n   - Close with a positive sign-off\n   \n   **If requesting a testimonial:**\n   - Thank the user warmly\n   - Express that their experience means a lot to the team\n   - Invite them to share their story by filling out the customer satisfaction form\n   - Make the invitation friendly, optional, and appreciative\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n4. **CRAFT THE SUBJECT LINE**  \n   Generate an appropriate subject line:\n   - For thank you: \"Thank you for your feedback\" or \"Re: Thank you\"\n   - For testimonial request: \"Thank you for your wonderful feedback\" or \"Re: We appreciate your support\"\n   - Keep it warm and professional\n\n5. **EDGE CASES**  \n   - If the sentiment is mixed, negative, or ambiguous, do not request a testimonial; just thank the user for sharing feedback\n   - Never include or reference any previous issues or sensitive information\n   - For neutral feedback, provide a simple, warm thank you\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the reply:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<a href='https://example.com'>` NOT `<a href=\"https://example.com\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Simple Thank You):**\n```\n{\"subject\":\"Thank you for your feedback\",\"message\":\"<p>Hello,</p><p>Thank you so much for your kind words! We're truly grateful for your feedback and are delighted to know you had a great experience. If you have any other comments or need assistance in the future, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Testimonial Request):**\n```\n{\"subject\":\"Thank you for your wonderful feedback\",\"message\":\"<p>Hello,</p><p>Thank you for your wonderful feedback! It means so much to our team to hear how satisfied you are. If you'd be willing, we'd love for you to share your story by filling out our customer satisfaction form at <a href='https://aeontrix.ai/testimonial'>this link</a>. Your testimonial could help others choose us with confidence!</p><p>Thank you again for your support.<br>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Mixed Sentiment):**\n```\n{\"subject\":\"Thank you for your feedback\",\"message\":\"<p>Hello,</p><p>Thank you for sharing your feedback with us. We truly appreciate your comments and the opportunity to serve you. If there's anything else we can do, please let us know.</p><p>Best regards,<br>Customer Service Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the testimonial request:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nHello,\n</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (uses double quotes in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<a href=\\\"https://example.com\\\">link</a>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is warm and appropriate\n- [ ] Message matches sentiment level appropriately\n- [ ] Testimonial form link is correct if included\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Mildly Positive Feedback:**\n- Express sincere gratitude\n- Keep response warm but brief\n- Don't request testimonial\n- Encourage future communication\n- Maintain friendly tone\n\n**For Exceptionally Positive Feedback:**\n- Express strong appreciation\n- Acknowledge specific praise\n- Invite testimonial submission\n- Make invitation optional and friendly\n- Provide clear link to form\n- Emphasize how it helps others\n\n**For Mixed Sentiment:**\n- Thank them for feedback\n- Acknowledge their experience\n- Don't request testimonial\n- Offer continued support\n- Keep tone professional and caring\n\n**For Neutral Feedback:**\n- Provide simple thank you\n- Appreciate their time\n- Keep brief and professional\n- No testimonial request\n\n---\n\n## üö´ CONSTRAINTS\n\n- üö´ NEVER include markdown or plain text in the message body‚ÄîHTML only\n- üö´ NEVER request a testimonial unless the feedback is genuinely positive and suitable\n- üö´ NEVER reference or restate prior issues or problems\n- üö´ NEVER include commentary, meta-analysis, or chain summaries\n- üö´ NEVER use double quotes (\") in HTML attributes\n- üö´ NEVER include actual line breaks in the JSON\n- ‚úÖ ALWAYS be warm, grateful, and professional\n- ‚úÖ ALWAYS use a friendly and appreciative tone\n- ‚úÖ ALWAYS return valid single-line JSON\n- ‚úÖ ALWAYS use single quotes (') in HTML attributes\n- ‚úÖ ALWAYS tailor response to the level of positivity\n- ‚úÖ ALWAYS make testimonial invitations optional and friendly\n\n---\n\n## üß† FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- Testimonial form URL: https://aeontrix.ai/testimonial\n- Always tailor your response to the level of positivity in the feedback\n- Never request a testimonial if the sentiment is mixed, negative, or unclear\n- Read the full conversation chain to understand context\n- Make invitations warm, optional, and customer-focused",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          -336,
          1664
        ],
        "id": "79433e4f-bb7d-42ce-9272-2ac60be18523",
        "name": "Positive"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current User Message:{{ $('Gmail Trigger').item.json.text }} ",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## üìå IDENTITY\nYOU ARE A CUSTOMER FEEDBACK EMAIL RESPONSE AI AGENT.  \nYour job is to read emails from customers providing neutral feedback, detect any underlying questions or concerns, and respond thoughtfully. You act as an attentive, helpful executive assistant, ensuring every customer feels heard and receives clear, well-formatted information.\n\n---\n\n## üß© CONTEXT\nYou respond to emails from customers giving neutral feedback‚Äîthese might be comments, suggestions, reviews, or general impressions.  \nYour workflow:\n- Read the email carefully and identify any direct or indirect questions, concerns, or requests for information.\n- Search the Supabase Vector Store tool (`customer_service_knowledge_base`) for relevant and accurate answers.\n- Draft a positive, helpful, and professional email reply in **HTML format**, even if the feedback does not request action.\n- Do **not** escalate issues; you always provide an informative, self-contained response.\n- Acknowledge feedback, address all questions or concerns, and offer to help further if needed.\n\n---\n\n## üîß THE PROCESS\n\n### STEP-BY-STEP INSTRUCTIONS\n\n1. **UNDERSTAND**  \n   Read the customer's feedback email in full. Identify any explicit or implicit questions, concerns, or topics that may require information or clarification.\n\n2. **ANALYZE**  \n   If the email only provides feedback with no actionable points, reply with gratitude and a brief summary.  \n   If any questions or issues are detected (even subtly), proceed to answer them directly.\n\n3. **BREAK DOWN**  \n   Summarize each identified question, concern, or topic into actionable search queries.\n\n4. **SEARCH KNOWLEDGE BASE**  \n   Search the `customer_service_knowledge_base` for answers, information, or explanations related to each point.\n\n5. **BUILD THE RESPONSE**  \n   Draft a **professional, friendly, and positive HTML-formatted email reply**:\n   - Open by thanking the customer for their feedback\n   - Clearly address every identified question or concern using only information found in the knowledge base\n   - If no actionable items are found, acknowledge their input and express appreciation\n   - Close with an offer to help with any further questions or feedback\n   - **KEEP HTML SIMPLE** - avoid complex nested structures\n\n6. **CRAFT THE SUBJECT LINE**  \n   Generate an appropriate subject line:\n   - Use \"Re: [original subject]\" or \"Thank you for your feedback\"\n   - Make it specific to the customer's concern when applicable\n   - Keep it professional and appreciative\n   - Examples: \"Re: Thank you for your feedback\", \"Information about shipping times\"\n\n7. **EDGE CASES**  \n   - If no questions or concerns can be found, simply thank the customer for their feedback and encourage future communication\n   - If the feedback is unclear or ambiguous, politely ask for clarification and restate your willingness to assist\n   - Never escalate or forward the email‚Äîalways reply directly with available information\n   - If knowledge base is unavailable, provide general helpful response\n\n---\n\n## üóÉÔ∏è OUTPUT FORMAT - CRITICAL RULES\n\n**YOU MUST FOLLOW THESE RULES EXACTLY OR YOUR OUTPUT WILL FAIL:**\n\n### RULE 1: JSON Structure\nYour ENTIRE response must be a SINGLE LINE of valid JSON in this exact format:\n```\n{\"subject\":\"text here\",\"message\":\"html here\"}\n```\n\n### RULE 2: What NOT to Include\n‚ùå NO ```json or ``` code block markers\n‚ùå NO explanatory text before the JSON\n‚ùå NO explanatory text after the JSON  \n‚ùå NO line breaks inside the JSON string\n‚ùå NO phrases like \"Here's the reply:\" or similar\n‚ùå NO actual newlines in the message field\n\n### RULE 3: HTML Formatting Rules\n- Keep ALL HTML on ONE CONTINUOUS LINE\n- Use SINGLE quotes (') for ALL HTML attributes, NOT double quotes (\")\n- Example: `<p style='color:blue;'>` NOT `<p style=\"color:blue;\">`\n- Keep HTML simple and minimal\n- Avoid deeply nested structures\n- Use basic tags: `<p>`, `<br>`, `<strong>`, `<a>`\n\n### RULE 4: Special Characters\n- DO NOT use line breaks in the HTML - keep it compact\n- For spacing between paragraphs, close `</p>` and open new `<p>`\n- Keep the HTML as simple as possible\n\n### EXAMPLES:\n\n‚úÖ **CORRECT OUTPUT (Checkout Feedback with Concern):**\n```\n{\"subject\":\"Thank you for your feedback on our checkout process\",\"message\":\"<p>Hello,</p><p>Thank you for sharing your experience with our checkout process. We appreciate your honesty and are always working to make the process as quick and easy as possible. If you have any specific suggestions for improvement, please let us know. We're here to help if you have any questions about your order or need further assistance.</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Account Setup Question):**\n```\n{\"subject\":\"Assistance with your account setup\",\"message\":\"<p>Hello,</p><p>Thank you for your feedback! If you'd like to confirm your account setup, you can review your account details in the profile section after logging in. If you need any help or have questions about your account, just reply to this message‚Äîwe're happy to assist you!</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (Shipping Information Request):**\n```\n{\"subject\":\"Information about shipping times\",\"message\":\"<p>Hello,</p><p>Thank you for your feedback and for letting us know about your experience. Our standard shipping times are 3‚Äì5 business days within the country. If you have any specific shipping needs or further questions, please let us know. We're always here to help.</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚úÖ **CORRECT OUTPUT (General Positive Feedback):**\n```\n{\"subject\":\"Thank you for your feedback\",\"message\":\"<p>Hello,</p><p>Thank you for sharing your feedback with us. We're glad you had a smooth experience. If you have any comments or questions in the future, feel free to reach out‚Äîwe're always here to assist you.</p><p>Best regards,<br>Customer Experience Team</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has code blocks):**\n```json\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has explanatory text):**\n```\nHere's the feedback response:\n{\"subject\":\"...\",\"message\":\"...\"}\n```\n\n‚ùå **INCORRECT OUTPUT (has line breaks in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p>\nHello,\n</p>\"}\n```\n\n‚ùå **INCORRECT OUTPUT (uses double quotes in HTML):**\n```\n{\"subject\":\"...\",\"message\":\"<p style=\\\"color:blue;\\\">Text</p>\"}\n```\n\n### FINAL CHECKLIST:\nBefore you respond, verify:\n- [ ] Response starts with { and ends with }\n- [ ] No code block markers (```)\n- [ ] No explanatory text\n- [ ] HTML uses SINGLE quotes (') not double quotes (\")\n- [ ] HTML is on ONE continuous line\n- [ ] Both \"subject\" and \"message\" fields are present\n- [ ] Subject line is appropriate and appreciative\n- [ ] Message addresses all detected concerns\n- [ ] Tone is friendly, professional, and helpful\n\n---\n\n## üìã RESPONSE GUIDELINES\n\n**For Feedback with Hidden Questions:**\n- Identify subtle concerns or questions\n- Search knowledge base for relevant information\n- Provide clear, helpful answers\n- Maintain warm, appreciative tone\n\n**For Pure Feedback (No Questions):**\n- Express sincere gratitude\n- Acknowledge their specific feedback\n- Encourage future communication\n- Keep response brief but warm\n\n**For Ambiguous Feedback:**\n- Thank them for sharing\n- Gently ask for clarification if needed\n- Offer specific ways to help\n- Keep tone inviting and open\n\n**For Multiple Concerns:**\n- Address each point systematically\n- Use clear paragraphs for each topic\n- Ensure all concerns are covered\n- Offer continued assistance\n\n---\n\n## üö´ CONSTRAINTS\n\n- üö´ NEVER include markdown or plain text in the message body‚ÄîHTML only\n- üö´ NEVER fabricate answers or provide information not found in the knowledge base\n- üö´ NEVER escalate, forward, or reference internal processes\n- üö´ NEVER copy the customer's message verbatim\n- üö´ NEVER include partial or malformed JSON\n- üö´ NEVER use double quotes (\") in HTML attributes\n- üö´ NEVER include actual line breaks in the JSON\n- ‚úÖ ALWAYS check for hidden or implied questions or concerns in the feedback\n- ‚úÖ ALWAYS answer with friendly, professional, and informative language\n- ‚úÖ ALWAYS acknowledge the feedback, even if no question is present\n- ‚úÖ ALWAYS return valid single-line JSON\n- ‚úÖ ALWAYS use single quotes (') in HTML attributes\n- ‚úÖ ALWAYS search knowledge base when questions are detected\n\n---\n\n## üß† FINAL REMINDERS\n\n- Your response must be EXACTLY: `{\"subject\":\"...\",\"message\":\"...\"}`\n- Use SINGLE quotes (') in HTML, not double quotes (\")\n- Keep HTML on ONE line - no actual line breaks\n- No markdown, no code blocks, no explanations\n- The simpler the HTML, the better\n- Test mentally: Can this JSON be parsed without errors?\n- If multiple subtle questions or concerns are found, address each clearly in the reply\n- If the knowledge base is unavailable, provide a general thank you and invite future questions\n- Always keep tone friendly, grateful, and professional\n- Never escalate or refer to internal teams‚Äîhandle all replies directly\n- Maintain privacy, accuracy, and a positive attitude in every message",
            "enableStreaming": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3.1,
        "position": [
          224,
          1984
        ],
        "id": "ad91ef23-16aa-4c28-b8e9-262930e4f702",
        "name": "Neutral"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "options": {}
        },
        "id": "2aed100a-8c5f-4205-bdaa-8bfb643f082b",
        "name": "OpenAI Chat Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          -4656,
          -1520
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_6980626158290666077"
          ]
        },
        "id": "95cf6bac-bfc7-438a-82df-da811f78a426",
        "name": "Finance/Billing",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2656,
          -3184
        ],
        "webhookId": "2f7e03f6-8190-462f-b71f-4ff23d941725",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an executive assistant. Your job is to prepare a message to our customer service team letting them know that we've received a question.\n\nHere is the email you are letting them know about:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters: \nSubject\nMessage",
                "role": "system"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "4dd1315c-fe65-452f-af8c-40e0f22a9585",
        "name": "Creating Draft",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -3456,
          -2672
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are a finance/billing assistant. Your job is to summarize incoming emails relating to finance and billing and summarize them in a short and concise way.\n\nHere is the incoming email:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters:\nSubject\nMessage"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "960dd3b1-4034-45c4-aaa2-4fdfc5ea749f",
        "name": "Summary for Finance Dept",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -2480,
          -3184
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "powerplayerbc@gmail.com",
          "subject": "={{ $json.message.content.Subject }}",
          "emailType": "text",
          "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "24e4736e-8f69-41b9-a2b5-c8057f1d2397",
        "name": "Send to Finance Dept",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2160,
          -3184
        ],
        "webhookId": "21aed2c4-93e3-40a8-b60f-f8a015842b42",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Miscellaneous & Low-Priority",
                "description": "Emails related to marketing campaigns, promotional offers, newsletters, or spam. For non-essential communications like newsletters or social updates. Typically these emails contain content aimed at engaging your audience or updating on promotions. Keywords: "
              },
              {
                "category": "Finance/Billing",
                "description": " Description: Emails related to financial matters, such as invoices, billing statements, payment reminders, or expense reports. Money-related and company operations emails. Anything involving transactions or accounting should fall under this label.  Keywords: invoice, payment, billing, receipt, financial, expense, account"
              },
              {
                "category": "Customers & Clients",
                "description": "All customer-related emails, whether new inquiries, support requests, or ongoing projects."
              },
              {
                "category": "Sales & Business Development",
                "description": "Emails related to generating revenue, partnerships, and business growth. For anything related to deals, leads, or revenue generation"
              },
              {
                "category": "Internal & Team Communications",
                "description": "Emails exchanged within the company for operations, meetings, and HR matters."
              },
              {
                "category": "External Partners & Vendors",
                "description": "For communications from vendors, affiliates, or external businesses."
              }
            ]
          },
          "options": {
            "fallback": "other",
            "systemPromptTemplate": "=Please classify the text provided by the user into one of the following categories: \"Miscellaneous & Low-Priority\", \"Finance/Billing\", \"Customers & Clients\", \"Sales & Business Development\", \"Internal & Team Communications\", and \"External Partners & Vendors\", and use the provided formatting instructions below. Don't explain, and only output the json."
          }
        },
        "id": "ab71e23a-86ec-4130-a96a-3f00a728e914",
        "name": "Text Classifier",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -4624,
          -1872
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.1,
        "position": [
          -4064,
          -2944
        ],
        "id": "d5e5f55a-5339-4baf-8c32-6216570a817f",
        "name": "OpenAI Chat Model1",
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.1,
        "position": [
          -4064,
          -2368
        ],
        "id": "124c38ea-c84d-494b-a488-5166d92521e1",
        "name": "OpenAI Chat Model2",
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Customer Support & Questions",
                "description": "Any inquiry, request, or general communication from a customer."
              },
              {
                "category": "Orders & Payments",
                "description": "Anything mentioning purchases, invoices, refunds, or payment issues."
              },
              {
                "category": "Feedback & Reviews",
                "description": "Any email containing opinions, survey responses, or complaints."
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Customer Support & Questions\", \"Orders & Payments\", or \"Feedback & Reviews\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Customer Support & Questions.\"\n\nDon't explain, and only output the json."
          }
        },
        "id": "2e75734e-a9d1-4479-9895-b1304dd160b3",
        "name": "Customers & Clients",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -4112,
          -2512
        ]
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_3423400585821225936"
          ]
        },
        "id": "2dcf3f0c-8fa7-4fd5-a156-051d2e53cfa9",
        "name": "Customer Service & Questions",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3632,
          -2672
        ],
        "webhookId": "a35cdefb-b700-491e-a05b-bca7c8039c04",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_1788200533085650839"
          ]
        },
        "id": "c14d0123-04b2-48b9-90f3-c1b5d62ebb14",
        "name": "Orders & Purchases",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3632,
          -2480
        ],
        "webhookId": "62c20c11-fd6d-480a-906f-4fbe6029374f",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "reply",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "message": "=Received.\n\nPlease give me 24-hours to review this and see what I can do.\n\nSincerely,\n[[YOUR NAME]]",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "5a91c9c7-ef7c-4dec-acfb-3f695474d563",
        "name": "Confirm Receipt",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3136,
          -2480
        ],
        "webhookId": "42516f6b-1027-4e0f-80d8-9f8d30b10bb9",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "powerplayerbc@gmail.com",
          "subject": "={{ $json.message.content.Subject }}",
          "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "3679523a-9fdd-4c27-b8b4-d8040cc08d86",
        "name": "Send to CS team",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3136,
          -2672
        ],
        "webhookId": "e565fd1c-3c20-4954-bdc2-a20abee66a5c",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_6763051605673154049"
          ]
        },
        "id": "6aa6eb4c-1f47-491e-8e0a-a76645b71cf9",
        "name": "Feedback & Reviews",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3632,
          -2320
        ],
        "webhookId": "5f48276e-bac3-4c23-9700-80b2e802cc6e",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "reply",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "message": "={{ $json.message.content.Message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "33558d6f-1c5e-488d-ae92-6a63d3264c8e",
        "name": "Ask To Use Review",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2624,
          -2432
        ],
        "webhookId": "eb1e31e8-6a87-4a02-b636-6168509c57d2",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an executive assistant. Your job is to draft an email response to the below email text, thanking the customer, and asking if we can use their feedback as a testimonial.\n\nHere is the email you are responding to:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters: \nSubject\nMessage",
                "role": "system"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "44e76bf8-f3a7-4ca8-9462-650ddd49d5e8",
        "name": "Positive Feedback",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -2944,
          -2432
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an executive assistant. Your job is to draft an email response to the below email text from a customer. Be helpful and happy.\n\nHere is the email you are responding to:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters: \nSubject\nMessage",
                "role": "system"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "24f005d3-345e-488e-868b-0ac22f27cb04",
        "name": "Neutral Feedback",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -2944,
          -2288
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "operation": "reply",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "message": "={{ $json.message.content.Message }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "a6dfe728-eb8b-4a8d-80c2-fee5d6a06473",
        "name": "Respond to customer",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2624,
          -2288
        ],
        "webhookId": "7c03c16b-b1ac-4d85-9104-fc325631605b",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Newsletters & Subscriptions",
                "description": "Blog updates, marketing emails, or email list content."
              },
              {
                "category": "Social Media & Notifications",
                "description": "Alerts from LinkedIn, Twitter, Facebook, etc."
              },
              {
                "category": "Spam & Unimportant Emails",
                "description": "Obvious junk mail or irrelevant messages."
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Newsletters & Subscriptions\", \"Social Media & Notifications\", and \"Spam & Unimportant\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Social Media & Notifications.\"\n\nDon't explain, and only output the json."
          }
        },
        "id": "119c4f00-79a7-4246-9801-6e5a23416a53",
        "name": "Miscellaneous & Low-Priority",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -4112,
          -3088
        ]
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_8512661774718813853"
          ]
        },
        "id": "77757108-ac6c-4aa9-a085-4fc37ebc8e6c",
        "name": "Newsletters & Subscriptions",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3632,
          -3248
        ],
        "webhookId": "84f93e28-a119-4478-a177-674e79b27d48",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_7872621165670262980"
          ]
        },
        "id": "a840313a-d1eb-4876-88e0-8ad42c18a835",
        "name": "Social Media & Notifications",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3632,
          -3088
        ],
        "webhookId": "6a3e8aa8-026d-40c1-90e3-409a4ec20e46",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_8356059899365221315"
          ]
        },
        "id": "25c88938-aad3-47b2-8ccb-d74e62ee924e",
        "name": "Spam & Unimportant",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3632,
          -2928
        ],
        "webhookId": "e1d52ead-d47e-4f21-ac5b-0fe1198f08ff",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.1,
        "position": [
          -3072,
          -2944
        ],
        "id": "0ff60acf-f25a-45cb-bea3-fa8b966a208b",
        "name": "OpenAI Chat Model3",
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_3704796152239188531"
          ]
        },
        "id": "a45da5a5-8230-4602-816f-90805ad3398d",
        "name": "Legal & Compliance",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2656,
          -2992
        ],
        "webhookId": "52bcdfad-3599-4dea-8661-4e8b2f21b4c4",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "powerplayerbc@gmail.com",
          "subject": "={{ $json.message.content.Subject }}",
          "emailType": "text",
          "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "f73df68d-d4ad-4835-a87a-ebb756bd784e",
        "name": "Send to Legal Department",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2160,
          -2992
        ],
        "webhookId": "30dee2b8-5d04-4bfa-afab-6920f03dcf12",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are a legal/compliance assistant. Your job is to summarize incoming emails relating to legal or compliance issues and summarize them in a short and concise way.\n\nHere is the incoming email:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters:\nSubject\nMessage"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "45d1ae25-9de4-43d6-8f85-fc0359a60ad5",
        "name": "Summary for Legal Dept",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -2480,
          -2992
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Invoices & Payment Reminders",
                "description": "Mentions of billing, receipts, payment confirmations, or accounts payable."
              },
              {
                "category": "Legal & Compliance",
                "description": "Mentions of contracts, policies, or government regulations."
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Invoices & Payment Reminders\" or \"Legal & Compliance\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Legal & Compliance\"\n\nDon't explain, and only output the json."
          }
        },
        "id": "d5b65b44-1699-4aae-aa5d-f3f635b05904",
        "name": "Finance, Billing & Legal",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -3136,
          -3088
        ]
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are a sales department assistant. Your job is to summarize incoming emails relating to sales and business development issues and summarize them in a short and concise way.\n\nHere is the incoming email:  {{ $('Gmail Trigger1').item.json.text }}\n\nPlease output the following parameters:\nSubject\nMessage"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "767a3b3f-f25e-418e-83b4-8b73912a80cc",
        "name": "Summary for Sales Dept",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -3920,
          -1840
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "powerplayerbc@gmail.com",
          "subject": "={{ $json.message.content.Subject }}",
          "emailType": "text",
          "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
          "options": {
            "appendAttribution": false
          }
        },
        "id": "8051795d-3252-4ce1-aa76-09d4a130f671",
        "name": "Send to Sales Department",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -3600,
          -1840
        ],
        "webhookId": "7455213c-1ede-4fe7-90e9-2770a91217c9",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_9191203915519784319"
          ]
        },
        "id": "9dcc8604-afc3-40f3-bb36-261e965c656e",
        "name": "Review Necessary",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2944,
          -2128
        ],
        "webhookId": "fde74a1c-1d68-4ea4-9edd-1f2f4d55f755",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.1,
        "position": [
          -3136,
          -1488
        ],
        "id": "fc3f493b-77d3-478f-a0e6-02fa1290ff55",
        "name": "OpenAI Chat Model4",
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "HR & Employee Matters",
                "description": "Mentions of payroll, time-off requests, hiring, or team management."
              },
              {
                "category": "Meetings & Scheduling",
                "description": "Calendar invites, team coordination emails, or agendas."
              },
              {
                "category": "IT & Technical Support",
                "description": "Requests for help with systems, logins, software, or security."
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"HR & Employee Matters\", \"Meetings & Scheduling\", or \"IT & Technical Support\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"HR & Employee Matters.\"\n\nDon't explain, and only output the json."
          }
        },
        "id": "e667fe39-7670-4b0e-89fa-30b4d901f745",
        "name": "Internal & Team Communications",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -3104,
          -1728
        ]
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_8302828016164209641"
          ]
        },
        "id": "d8036105-15d3-4f6e-96b0-0ce4085c8e33",
        "name": "HR & Employee Matters",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2624,
          -1888
        ],
        "webhookId": "460564e1-42a7-443c-a8bd-151f6847b7fa",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_2062758991997007864"
          ]
        },
        "id": "8546d5ff-9277-4732-a902-3c8145cc904a",
        "name": "Meetings & Scheduling",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2624,
          -1728
        ],
        "webhookId": "bd99480b-eb9a-4072-924f-80da6244745b",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_3021111801994820422"
          ]
        },
        "id": "bf83f78d-1a8c-44da-a6d9-4cda28c76081",
        "name": "IT & Technical Questions",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2624,
          -1568
        ],
        "webhookId": "d128862d-1a33-458f-9aa0-300e2fd72b76",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_7792274498208482134"
          ]
        },
        "id": "4b0107b8-6157-4502-afe0-afcc9e1b9662",
        "name": "Sales & Business Development",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -4096,
          -1840
        ],
        "webhookId": "d770c9be-dc66-46fc-a812-0b6d9cd88d0c",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_4436255029579784519"
          ]
        },
        "id": "64808834-08fa-4500-a0f5-4c5b7aed82d7",
        "name": "External Partners & Vendors",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -4080,
          -1072
        ],
        "webhookId": "ff63a0bf-db73-43b4-af9b-77d260d74aaa",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.1,
        "position": [
          -3072,
          -928
        ],
        "id": "063a3b52-fc4d-42f1-9b3d-ba5593dafd15",
        "name": "OpenAI Chat Model5",
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "inputText": "=Email Subject:\n{{ $('Gmail Trigger1').item.json.headers.subject }}\n\nEmail Body:\n{{ $('Gmail Trigger1').item.json.text }}",
          "categories": {
            "categories": [
              {
                "category": "Unsorted Business Messages",
                "description": "Emails that don‚Äôt provide enough details for classification."
              },
              {
                "category": "Follow-Ups Without Context",
                "description": "Messages like ‚ÄúJust checking in‚Äù or ‚ÄúDid you see my last email?‚Äù"
              },
              {
                "category": "General Discussions",
                "description": "Messages that don‚Äôt indicate sales, finance, or customer-related topics."
              }
            ]
          },
          "options": {
            "systemPromptTemplate": "Please review the subject of the email and the email text and classify the text provided by the user into one of the following categories: \"Unsorted Business Messages\", \"Follow-Ups Without Context\" or \"General Discussions\", and use the provided formatting instructions below. \n\nIf you are unsure which category to place it in, default to \"Unsorted Business Messages.\"\n\nDon't explain, and only output the json."
          }
        },
        "id": "d86b44c4-b206-40ee-ae08-cd71628c84a5",
        "name": "General Business Communication",
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          -3136,
          -1072
        ]
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_4478038924648464926"
          ]
        },
        "id": "b9751584-2f4e-4949-b7a2-ca0b42a83fd3",
        "name": "Unsorted",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2656,
          -1232
        ],
        "webhookId": "05316cec-1b8f-47cd-8bb0-5f807fd20b4a",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "getAll",
          "limit": 5,
          "filters": {
            "sender": "={{ $('Gmail Trigger1').item.json.from.value[0].address }}"
          }
        },
        "id": "6dc1c40a-6e56-4da0-bb40-217b9419e00d",
        "name": "Get Messages",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2656,
          -1072
        ],
        "webhookId": "184d5d1a-2520-4e91-90e1-6475fdfae626",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "messages": {
            "values": [
              {
                "content": "=You are an executive assistant. Your job is to take the below information from the message sender and provide a summary of what is going on so that I can review the past dealings with this individual and know how to respond to the current message.\n\n**Here is the email you are responding to:**  {{ $('Gmail Trigger1').item.json.text }}\n\n**Here are our past conversations:** {{ $json.output }}\n\n**Please output the following parameters:** \nSubject\nMessage",
                "role": "system"
              }
            ]
          },
          "jsonOutput": true,
          "options": {}
        },
        "id": "0d130ce2-6afd-4c62-be5d-9aeac13cc74d",
        "name": "Summarize Communications",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.5,
        "position": [
          -2496,
          -1072
        ],
        "credentials": {
          "openAiApi": {
            "id": "l6mhMk10h2SRZNoi",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "powerplayerbc@gmail.com",
          "subject": "={{ $json.message.content.Subject }}",
          "message": "={{ $json.message.content.Message }}\n\nHere is the original message:\nFROM: {{ $('Gmail Trigger1').item.json.from.value[0].address }}\nSUBJECT: {{ $('Gmail Trigger1').item.json.subject }}\nMESSAGE: {{ $('Gmail Trigger1').item.json.text }}",
          "options": {}
        },
        "id": "bbf12ba5-8c7e-4e27-a075-5e221b5a9386",
        "name": "Send to Self",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2176,
          -1072
        ],
        "webhookId": "3fb18b48-bf44-4eb6-b67f-d8b68fca7db8",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger1').item.json.id }}",
          "labelIds": [
            "Label_1634408200967776207"
          ]
        },
        "id": "43464b86-099b-45ba-a2f5-1ad02524910c",
        "name": "General Discussion",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          -2656,
          -912
        ],
        "webhookId": "b6b55fb3-5a58-4514-8a08-c2a87f40e7e2",
        "credentials": {
          "gmailOAuth2": {
            "id": "oKELf5OtuS9854VS",
            "name": "CSO gmail"
          }
        }
      },
      {
        "parameters": {
          "content": "# Miscellaneous & Low-Priority",
          "height": 520,
          "width": 820
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4224,
          -3312
        ],
        "typeVersion": 1,
        "id": "0c8be8e6-394c-4405-a378-1e5025b19acb",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "# Finance Billing & Legal",
          "height": 520,
          "width": 1280,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3184,
          -3312
        ],
        "typeVersion": 1,
        "id": "201ac50c-b4e8-435e-baf7-b5acab6317b1",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "# Customers & Clients",
          "height": 760,
          "width": 1860,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4224,
          -2704
        ],
        "typeVersion": 1,
        "id": "783218c3-edc8-4b4b-8675-cd26351c7db2",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "# Sales & Business Development",
          "height": 540,
          "width": 840,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4224,
          -1904
        ],
        "typeVersion": 1,
        "id": "1770725a-ce1c-4f54-b96f-fda158434dbb",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "content": "# Internal & Team Communications",
          "height": 540,
          "width": 840,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3200,
          -1904
        ],
        "typeVersion": 1,
        "id": "6a05e137-e867-4052-98fd-90f6ea4d0805",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "content": "# General Business Communications",
          "height": 540,
          "width": 1260,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -3200,
          -1280
        ],
        "typeVersion": 1,
        "id": "686dac34-0eae-42fa-91ae-eabf7de37761",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "content": "# External Partners & Vendors",
          "height": 540,
          "width": 660,
          "color": 7
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4224,
          -1280
        ],
        "typeVersion": 1,
        "id": "7e9255eb-0542-4949-9343-8c08e76e243b",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "content": "# Email Inbox Triage Agent\n\n## Automate Business AI\n### By Bradford Carlton",
          "height": 220,
          "width": 540
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -4896,
          -2240
        ],
        "typeVersion": 1,
        "id": "3eb24b00-ab7f-46b7-882e-d7da3b92e7ac",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "inputText": "={{ $('Gmail Trigger1').item.json.text }}",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.sentimentAnalysis",
        "typeVersion": 1,
        "position": [
          -3440,
          -2320
        ],
        "id": "9363d26c-8943-4ec9-9aed-6a8921d2a746",
        "name": "Sentiment Analysis1"
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          352,
          -1728
        ],
        "id": "873b07b6-404e-4c37-8aa5-9b12d6804f7b",
        "name": "Create a channel",
        "webhookId": "68fb604e-2e59-47bf-af5d-e8afca62d049",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          400,
          -2160
        ],
        "id": "bc858800-cd84-4fb8-9b79-e6f52927d8ae",
        "name": "Create a channel1",
        "webhookId": "68fb604e-2e59-47bf-af5d-e8afca62d049",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          272,
          -1280
        ],
        "id": "8290d5f0-51d3-4d95-96b0-a3199df36ec0",
        "name": "Create a channel2",
        "webhookId": "68437948-d95f-494d-b045-b9dd5e100fbf",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          432,
          288
        ],
        "id": "0d985a99-603a-4ce5-a0e3-eea1b2af9e34",
        "name": "Human in the Loop2",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          432,
          800
        ],
        "id": "2df7452d-ac97-447c-a6ec-1a38d75736b4",
        "name": "Human in the Loop3",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          432,
          1264
        ],
        "id": "9f9078fb-7834-4f92-a0fd-f0a538b7ec70",
        "name": "Human in the Loop4",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          384,
          1664
        ],
        "id": "c63d643c-25e1-432b-9c66-883e6c1db092",
        "name": "Human in the Loop5",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          928,
          1984
        ],
        "id": "5a482e73-f64b-45a9-bee1-9e80330b82d7",
        "name": "Human in the Loop6",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "={{ $json.message }}",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          224,
          2416
        ],
        "id": "f2ed9982-ebda-4c4f-a9e8-97e0392ce9cc",
        "name": "Human in the Loop7",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "sendAndWait",
          "guildId": {
            "__rl": true,
            "value": "1462678297724059752",
            "mode": "list",
            "cachedResultName": "Aeontrix Command Centre",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752"
          },
          "channelId": {
            "__rl": true,
            "value": "1462678299170963497",
            "mode": "list",
            "cachedResultName": "email-approvals-aeontrix",
            "cachedResultUrl": "https://discord.com/channels/1462678297724059752/1462678299170963497"
          },
          "message": "=**User Message:**  \n{{ $('Gmail Trigger').item.json.text }}\n\n---------------------------------------------------------------------------------------\n\n**AI Response:**  \n{{ $json.message }}\n",
          "approvalOptions": {
            "values": {
              "approvalType": "double"
            }
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          448,
          2608
        ],
        "id": "38f720a5-8f51-47ff-ad08-131244b50fb7",
        "name": "Human in the Loop8",
        "webhookId": "233af3dd-fe5b-474a-82fd-acd8c906bc81",
        "credentials": {
          "discordBotApi": {
            "id": "s3y0kedjtiaPdg17",
            "name": "Discord Bot account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "Label_1212059649648038821"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -336,
          -544
        ],
        "id": "57029049-f7d9-4d99-9c0e-a17d81d0fb81",
        "name": "Add label to Newsletter",
        "webhookId": "fb2432db-babe-4155-8567-307eedd44f54",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "CATEGORY_PROMOTIONS"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -384,
          -800
        ],
        "id": "941eb23d-13bc-4c83-85e2-60d7004b3ec9",
        "name": "Promotion Label",
        "webhookId": "91dadd89-cd0c-4a48-aa59-63b7d864294e",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $('Classify Email').item.json.from.value[0].address }}",
          "subject": "=Careers at Pasovit ‚Äì Apply Here",
          "message": "=<!DOCTYPE html>\n<html>\n  <body style=\"font-family: Arial, sans-serif; color: #333; line-height: 1.5;\">\n    <p>Hi,</p>\n\n    <p>\n      Thanks for reaching out and for your interest in working with <strong>Pasovit</strong>.\n    </p>\n\n    <p>\n      We don‚Äôt process applications over email. Please visit the careers page below to see current openings and apply through the official process:\n    </p>\n\n    <p>\n      <a href=\"https://pasovit.com/jobs\" target=\"_blank\" style=\"color: #1a73e8; text-decoration: none;\">https://pasovit.com/jobs</a>\n    </p>\n\n    <p>\n      If your profile is a good fit, someone from our team will get in touch.\n    </p>\n\n    <p>Best regards,<br>\n    <strong>Team Pasovit</strong></p>\n  </body>\n</html>\n",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -384,
          -64
        ],
        "id": "bfaf3156-ca8f-478e-a0e9-8fcf4a3e6efb",
        "name": "Job Related",
        "webhookId": "5b9051c0-92a4-4f99-9978-67a3d9597f0a",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "Label_4221645633223889453"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -816,
          96
        ],
        "id": "60045a73-008a-42cb-9e57-2e64bfe8e457",
        "name": "Add Job label",
        "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "Label_6262690671964489895"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -784,
          -2160
        ],
        "id": "aa4e3bf7-bd1b-42c6-ac66-efbdd71b3e75",
        "name": "Add Job label1",
        "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "Label_4379104522768960571"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -800,
          1968
        ],
        "id": "dd76de0d-f32f-4654-bef3-c1a46bf5e901",
        "name": "Add label to message",
        "webhookId": "7a7313f6-038b-4b7b-9128-d4dc442a1990",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -400,
          2176
        ],
        "id": "34c23352-0918-4978-9cb6-0ec6da5d67b9",
        "name": "OpenRouter Chat Model4",
        "credentials": {
          "openRouterApi": {
            "id": "x7c6iG8TPTQxaZm2",
            "name": "OpenRouter account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "Label_3060241741019036244"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -704,
          448
        ],
        "id": "465eb4a0-8bdc-41ef-9664-631953a25c32",
        "name": "Add Job label2",
        "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      },
      {
        "parameters": {
          "operation": "addLabels",
          "messageId": "={{ $('Gmail Trigger').item.json.id }}",
          "labelIds": [
            "Label_5394070831985162407"
          ]
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -704,
          288
        ],
        "id": "52a0225b-98fd-49cb-a360-6d9f7e66e99b",
        "name": "Internal",
        "webhookId": "dd5a3e6f-660d-41b4-be67-5c01b5a5ff8f",
        "credentials": {
          "gmailOAuth2": {
            "id": "CMvdCVqtWOQejQqx",
            "name": "Chrono Nexus Testing Account"
          }
        }
      }
    ],
    "connections": {
      "Classify Email": {
        "main": [
          [
            {
              "node": "Add Job label1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Promotion Label",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add label to Newsletter",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add Job label",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Internal",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add Job label2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Add label to message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent9",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Gmail Trigger": {
        "main": [
          [
            {
              "node": "Classify Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "Classify Email",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent1": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "Create a channel1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "Send a message1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "Create a channel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent2": {
        "main": [
          [
            {
              "node": "Code in JavaScript2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model3": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch2": {
        "main": [
          [
            {
              "node": "Wait2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait2": {
        "main": [
          [
            {
              "node": "Send a message2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript2": {
        "main": [
          [
            {
              "node": "Create a channel2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent6": {
        "main": [
          [
            {
              "node": "Code in JavaScript6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model7": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent6",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch6": {
        "main": [
          [
            {
              "node": "Wait6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait6": {
        "main": [
          [
            {
              "node": "Send a message6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript6": {
        "main": [
          [
            {
              "node": "Human in the Loop2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent7": {
        "main": [
          [
            {
              "node": "Code in JavaScript7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model8": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent7",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch7": {
        "main": [
          [
            {
              "node": "Wait7",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait7": {
        "main": [
          [
            {
              "node": "Send a message7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript7": {
        "main": [
          [
            {
              "node": "Human in the Loop3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent8": {
        "main": [
          [
            {
              "node": "Code in JavaScript8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model9": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent8",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch8": {
        "main": [
          [
            {
              "node": "Wait8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait8": {
        "main": [
          [
            {
              "node": "Send a message8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript8": {
        "main": [
          [
            {
              "node": "Human in the Loop4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent9": {
        "main": [
          [
            {
              "node": "Code in JavaScript9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model10": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent9",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch9": {
        "main": [
          [
            {
              "node": "Wait9",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait9": {
        "main": [
          [
            {
              "node": "Send a message9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript9": {
        "main": [
          [
            {
              "node": "Human in the Loop8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model11": {
        "ai_languageModel": [
          [
            {
              "node": "Positive",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch10": {
        "main": [
          [
            {
              "node": "Wait10",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Positive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait10": {
        "main": [
          [
            {
              "node": "Send a message10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript10": {
        "main": [
          [
            {
              "node": "Human in the Loop5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sentiment Analysis": {
        "main": [
          [
            {
              "node": "Positive",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Neutral",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Human in the Loop7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model12": {
        "ai_languageModel": [
          [
            {
              "node": "Neutral",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch11": {
        "main": [
          [
            {
              "node": "Wait11",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Neutral",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait11": {
        "main": [
          [
            {
              "node": "Send a message11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript11": {
        "main": [
          [
            {
              "node": "Human in the Loop6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Positive": {
        "main": [
          [
            {
              "node": "Code in JavaScript10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Neutral": {
        "main": [
          [
            {
              "node": "Code in JavaScript11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Text Classifier",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Finance/Billing": {
        "main": [
          [
            {
              "node": "Summary for Finance Dept",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Creating Draft": {
        "main": [
          [
            {
              "node": "Send to CS team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summary for Finance Dept": {
        "main": [
          [
            {
              "node": "Send to Finance Dept",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Classifier": {
        "main": [
          [
            {
              "node": "Miscellaneous & Low-Priority",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Finance, Billing & Legal",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Customers & Clients",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sales & Business Development",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Internal & Team Communications",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "External Partners & Vendors",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "General Business Communication",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Miscellaneous & Low-Priority",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "Customers & Clients",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Sentiment Analysis1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Customers & Clients": {
        "main": [
          [
            {
              "node": "Customer Service & Questions",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Orders & Purchases",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Feedback & Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Customer Service & Questions": {
        "main": [
          [
            {
              "node": "Creating Draft",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Orders & Purchases": {
        "main": [
          [
            {
              "node": "Confirm Receipt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Feedback & Reviews": {
        "main": [
          [
            {
              "node": "Sentiment Analysis1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Positive Feedback": {
        "main": [
          [
            {
              "node": "Ask To Use Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Neutral Feedback": {
        "main": [
          [
            {
              "node": "Respond to customer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Miscellaneous & Low-Priority": {
        "main": [
          [
            {
              "node": "Newsletters & Subscriptions",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Social Media & Notifications",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Spam & Unimportant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model3": {
        "ai_languageModel": [
          [
            {
              "node": "Finance, Billing & Legal",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Legal & Compliance": {
        "main": [
          [
            {
              "node": "Summary for Legal Dept",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summary for Legal Dept": {
        "main": [
          [
            {
              "node": "Send to Legal Department",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Finance, Billing & Legal": {
        "main": [
          [
            {
              "node": "Finance/Billing",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Legal & Compliance",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summary for Sales Dept": {
        "main": [
          [
            {
              "node": "Send to Sales Department",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model4": {
        "ai_languageModel": [
          [
            {
              "node": "Internal & Team Communications",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Internal & Team Communications": {
        "main": [
          [
            {
              "node": "HR & Employee Matters",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Meetings & Scheduling",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "IT & Technical Questions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sales & Business Development": {
        "main": [
          [
            {
              "node": "Summary for Sales Dept",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model5": {
        "ai_languageModel": [
          [
            {
              "node": "General Business Communication",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "General Business Communication": {
        "main": [
          [
            {
              "node": "Unsorted",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Messages",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "General Discussion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Messages": {
        "main": [
          [
            {
              "node": "Summarize Communications",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize Communications": {
        "main": [
          [
            {
              "node": "Send to Self",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sentiment Analysis1": {
        "main": [
          [
            {
              "node": "Positive Feedback",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Neutral Feedback",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Review Necessary",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a channel": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a channel1": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create a channel2": {
        "main": [
          [
            {
              "node": "Switch2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human in the Loop2": {
        "main": [
          [
            {
              "node": "Switch6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human in the Loop3": {
        "main": [
          [
            {
              "node": "Switch7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human in the Loop4": {
        "main": [
          [
            {
              "node": "Switch8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human in the Loop5": {
        "main": [
          [
            {
              "node": "Switch10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human in the Loop6": {
        "main": [
          [
            {
              "node": "Switch11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Human in the Loop8": {
        "main": [
          [
            {
              "node": "Switch9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add label to Newsletter": {
        "main": [
          []
        ]
      },
      "Add Job label": {
        "main": [
          [
            {
              "node": "Job Related",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Job label1": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add label to message": {
        "main": [
          [
            {
              "node": "Sentiment Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model4": {
        "ai_languageModel": [
          [
            {
              "node": "Sentiment Analysis",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Add Job label2": {
        "main": [
          [
            {
              "node": "AI Agent7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Internal": {
        "main": [
          [
            {
              "node": "AI Agent6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Aeontrix AI",
    "name": "Version ae066d50",
    "description": "Lable added",
    "autosaved": true
  },
  "tags": []
}